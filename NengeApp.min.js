let Fileurl=document.currentScript.src.split("/").slice(0,-1),NengeApp=new class{dir=Fileurl.join("/")+"/";version=1;config={gameId:122,onloadstate:void 0,onloadstate:void 0,OptionSet:{screenRecord:{label:"Start Screen Recording",options:{}},NengePanel:{label:"Nenge's Panel",options:{downloadsrm:"DownLoad SRM",uploadsrm:"Upload SRM",downloadstate:"DownLoad State",uploadstate:"Upload State",downloadsrm:"DownLoad SRM",reload:"Reload Page",fastforward:"Fast Forward",Cache2Manage:"Cache Manage",NDSScreenOver:"NDS Screen Over",HomePage:"Home Page",tosavesrm:"Saved SRM",toloadsrm:"Loaded SRM"}}},onsavestate:async function(){EJS.STATE_SAVE(this).then((e=>{}))},onloadstate:async function(){EJS.STATE_LOAD(this).then((e=>{}))},OptionCall:{HomePage:function(){let e=this.config.HomePage||this.config.runpage||location.origin;location.href==e?location.reload():location.href=e},NDSScreenOver:function(e){e.Module.canvas.classList.toggle("ejs--ndsscreen")},Cache2Manage:function(){this.MENU_SET("ContextMenuItem").CacheManage.call(this)},QuickSave:function(){EJS.STATE_SAVE(this).then((e=>{}))},QuickLoad:function(){EJS.STATE_LOAD(this).then((e=>{}))},tosavesrm:function(e){EJS.SRM_SAVE(this).then((e=>{}))},toloadsrm:function(e){EJS.SRM_LOAD(this).then((e=>{}))},reload:()=>{location.reload()},downloadsrm:function(e){EJS.SRM_SAVE(this,!0).then((e=>{}))},downloadstate:function(e){EJS.STATE_SAVE(this,!0).then((e=>{}))},uploadsrm:function(e){NengeApp.upload((e=>{EJS.SRM_LOAD(this,e)}))},uploadstate:function(e){NengeApp.upload((e=>{EJS.STATE_LOAD(this,e).then((e=>{}))}))},fastforward:function(e,t){let a=e.Module;if(a._fast_forward){let e=t.target,o=this.config,s=this.translate(o.OptionSet.NengePanel.options.fastforward),n=this.translate("Stop Forward"),r=0;e.textContent==s?(e.innerHTML=n,r=1):e.innerHTML=s,a._fast_forward(r)}},screenRecord:function(e,t){let a=t.target,o=this.config.OptionSet.screenRecord.label,s=this.translate[o]||o,n="Stop Screen Recording",r=this.translate[n]||n;e.recorder||(e.recorder=NengeApp.setRecord(e)),e.recorder||a.parentNode.remove(),a.textContent==r?(a.innerHTML=s,e.recorder.gamename=this.startName,e.recorder.stop()):(a.innerHTML=r,e.recorder.start())}},translate:{"Nenge's Panel":"能哥面板","DownLoad SRM":"下载电子存档","Upload SRM":"上传电子存档","DownLoad State":"下载即时状态","Upload State":"上传即时状态","Fast Forward":"加速","Stop Forward":"停止加速","Start Screen Recording":"开始录像","Stop Screen Recording":"停止录像","Reload Page":"刷新页面",SELECT:"选择",START:"开始",MENU:"菜单","NDS Screen Over":"让NDS屏幕占满","Loading...":"载入中","OpenGBA RTC":"开启GBARTC","Network Error":"网络错误！","Download Game Core":"载入运行核心","Decompress Game Core":"解压核心进度","Game Core ready":"核心加载完毕！","Download Game Data":"载入游戏数据","Decompress Game Data":"解压游戏数据","Game Data ready":"游戏数据准备完毕！","Take Screenshot":"截图","Home Page":"主页","Cache Manager":"游戏缓存管理","Cache Manage":"游戏缓存列表","Quick Save (F2)":"保存状态","Quick Load (F4)":"读取状态","All Clear":"全部清除","Room Name":"房间名","Password:":"密码",Player:"玩家",Name:"名称","Set Player Name":"设置玩家名","Create a Room":"建房","Password (Optional)":"密码(可选)",Password:"密码",Rooms:"房间列表",Players:"玩家数量","Player Name":"玩家名称","Max Players":"最大玩家数量",OK:"好",Clear:"清除",Remove:"移除","Load this Game":"载入这个游戏","on start":"准备开始","on ready":"准备完毕",COMBOKEY:"连发",Enabled:"启用",enabled:"开启",disabled:"关闭",Disabled:"关闭","2xScaleHQ":"2倍柔化","4xScaleHQ":"4倍柔化","4xScaleHQ.glslp":"启用4倍柔化","CRT easymode":"液晶简易","CRT aperture":"液晶模糊","CRT geom":"液晶管道",Shader:"屏幕滤镜","Virtual Gamepad":"虚拟按键","Enable Turbo Buttons":"开启加速选项","Turbo Delay in frames":"加速帧延迟","Solar sensor level":"光感等级",Frameskip:"跳帧","Screen layout":"屏幕布局","top/bottom":"上/下","bottom/top":"下/上","left/right":"左/右","right/left":"右/左","top only":"只有上","bottom only":"只有下","quick switch":"快速切换","hybrid/top":"放大上","hybrid/bottom":"放大下","Screen Rotation":"旋转屏幕",none:"空的","Player 1 Pak":"玩家1 Pak","Player 2 Pak":"玩家2 Pak","Player 3 Pak":"玩家3 Pak","Player 4 Pak":"玩家4 Pak",memory:"内存",rumble:"噪音","Aspect Ratio (Need to refresh page)":"宽高比（需要刷新页面）","16:9 Resolution":"16:9 分辨率","4:3 Resolution":"4:3 分辨率","Enable second memory card":"开启第二内存卡","Pad 1 Type":"Pad 1类型","Pad 2 Type":"Pad 2类型","Pad 3 Type":"Pad 3类型","Pad 4 Type":"Pad 4类型",default:"默认",standard:"标准",analog:"摇杆",negcon:"NeGcon","Enable Vibration":"启动震动","Enable interlacing mode(s)":"启用隔行扫描模式(*)","Enhanced resolution (slow)":"增强分辨率（慢）","Enhanced resolution speed hack":"增强的分辨率速度破解","INSERT COIN":"投币","Aspect ratio":"宽高比",DAR:"窄屏",PAR:"宽屏","CPU overclock":"CPU超频","Diagnostic Input":"诊断输入",None:"",None:"空的","Hold Start":"按住开始","Start + A + B":"开始+A+B","Hold Start + A + B":"按住开始+A+B","Start + L + R":"开始+L+R","Hold Start + L + R":"按住开始+L+R","Hold Select":"按住选择","Select + A + B":"选择+A+B","Hold Select + A + B":"按住选择+A+B","Select + L + R":"选择+L+R","Hold Select + L + R":"按住选择+L+R","Force Neo Geo mode":"强制NeoGeo模式",MVS:"街机",AES:"家用",UNIBIOS:"反作弊",DIPSWITCH:"DIP开关",Voice:"声音","Test mode":"测试模式","Stop mode":"暂停模式",Off:"关闭",On:"开启","Bios select (Fake)":"Bios 选择(虚拟)",Newer:"较新",Older:"较旧",Music:"音乐","Free play":"免费开始","Newer (no intro, calendar)":"较新(无介绍,日历)","Newer (no intro)":"较新(无介绍)","Region (Fake)":"地区(虚拟)",World:"世界",China:"中国",Taiwan:"台湾",Japan:"日本",Korea:"韩国","Hong Kong":"香港",World:"世界",Restart:"",Play:"开始",Pause:"暂停",Played:"已开始",Volume:"音量","Mute (F9)":"静音(F9)","Unmute (F9)":"取消静音(F9)","Enter fullscreen":"进入全屏","Exit fullscreen":"取消全屏",Settings:"设置","Save State (Shift + F2)":"存储状态(Shift + F2)","Load State (Shift + F4)":"读取状态(Shift + F4)",Netplay:"联机","Controls Settings":"控制设置",Cheats:"金手指","Go back to previous menu":"返回上层菜单",Normal:"普通",All:"全部",Reset:"重设","Play Now":"开始游戏",Restart:"重启","Add Cheat":"添加金手指",Close:"关闭","Add Cheat Code":"添加金手指代码",Code:"代码",Description:"描述",Submit:"提交","Player 1":"玩家1","Player 2":"玩家2","Player 3":"玩家3","Player 4":"玩家4",Update:"更新",Cancel:"取消","Press keyboard or gamepad":"按下任意键","Connected gamepad":"连接的手柄",Gamepad:"手柄",Keyboard:"键盘",Set:"设置",Default:"默认",Low:"低",High:"高","Very High":"很高","4 Players Support":"支持4玩家","Color Palette":"彩电调色板",asqrealc:"","nintendo-vc":"任天堂VC",rgb:"红绿蓝","yuv-v3":"YUV版本3",Auto:"自动",NTSC:"NTSC美国制",PAL:"PAL帕尔制",pal:"PAL帕尔制","Sound Quality":"声音质量",NES:"红白机",Famicom:"家庭用机","Turbo Enable":"启用涡轮",Both:"两者",Region:"地区",Dendy:"山寨FC","bmf-final2":"BMF2","bmf-final3":"BMF3","smooth-fbx":"FBX","composite-direct-fbx":"FBX2","pvm-style-d93-fbx":"FBX3",nescap:"nescap","ntsc-hardware-fbx":"ntsc-hardware-fbx","nes-classic-fbx-fs":"nes-classic-fbx-fs",wavebeam:"波动枪","No Sprite Limit":"无限制",asqrealc:"asqrealc","unsaturated-final":"unsaturated-final","sony-cxa2025as-us":"sony-cxa2025as-us","Saved SRM":"保存SRM","Loaded SRM":"读取SRM","GB Colorization":"GB着色",internal:"内置",auto:"自动","Internal Palette":"内置调色板","GBC - Blue":"GBC蓝","GBC - Brown":"GBC褐色","GBC - Dark Blue":"GBC深蓝","GBC - Dark Brown":"GBC深褐色","GBC - Dark Green":"GBC深绿","GBC - Grayscale":"GBC灰色","GBC - Green":"GBC绿色","GBC - Inverted":"GBC底片","GBC - Orange":"GBC橙色","GBC - Pastel Mix":"GBC混合","GBC - Red":"GBC红色","GBC - Yellow":"GBC黄色"}};coreSupport={psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],"3do":["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],"32x":["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],"fba0.2.97.29":["zip"],mame2003:["zip"],mame:["zip"]};setRecord(e){let t;if(["video/webm; codecs=h264","video/webm; codecs=vp9","video/webm; codecs=vp8","video/webm; codecs=vp9.0","video/webm; codecs=vp8.0","video/webm; codecs=avc1"].forEach((e=>{!t&&MediaRecorder.isTypeSupported(e)&&(t=e)})),!t)return!1;let a=e.Module.canvas.captureStream(30);if(!a)return!1;let o=new MediaRecorder(a,{mimeType:t});return o?(o.BLOBdata=[],o.ondataavailable=e=>{o.BLOBdata.push(e.data)},o.onstop=()=>{if(o.BLOBdata.length<1)return;let e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob(o.BLOBdata,{type:t})),e.download=(o.gamename||"record")+"."+t.split("/")[1].split(";")[0],e.click(),o.BLOBdata=[]},window.recorder=o,o):(a=null,!1)}getName(e,t){let a=(e=e.split("/").pop().split(".")).slice(0,e.length-1),o=e.pop();return a+"."+(t||o)}download(e,t,a){let o=document.createElement("a"),s={};a&&(s.type=a),o.href=window.URL.createObjectURL(new Blob(e instanceof Blob?e:[e],s)),o.download=t,o.click()}upload(e){let t=document.createElement("input");t.type="file",t.onchange=a=>{let o=a.target,s=o.files[0];if(!s)return;o.value="";let n=new FileReader;n.onload=t=>e(new Uint8Array(t.target.result),s.name),n.readAsArrayBuffer(s),t.onchange=null,t.remove()},t.click()}_elm="#nenge-game";get elm(){return this._elm}set elm(e){if("string"==typeof e&&e==this._elm)return;if("string"!=typeof e){e[0]&&(e=e[0]);let t="";if(e.id&&(t=e.id),e.className&&(t=e.classList[0]),t==this._elm)return;e=t}let t=document.querySelector(this._elm);t&&t.parentNode.remove(),this._elm=e}getbios(e){let t;switch(e){case"msx":case"sega":case"psx":t=e+".7z";break;case"mame":case"mame2003":case"fba0.2.97.29":case"arcade":t="arcade.7z";break;default:break}return t?this.dir+"bios/"+t:""}cacheName="nenge-emu-config";SETCONFIG(){if(document.getElementsByName("system")[0])this.config.system=document.getElementsByName("system")[0].value,this.translate=Number(document.getElementsByName("translate")[0].value),this.config.stopMusic=Number(document.getElementsByName("music")[0].value),this.config.Arrow=document.getElementsByName("arrow")[0].value,this.bios=Number(document.getElementsByName("bios")[0].value),this.config.system||alert("核心设置不能留空 Core settings cannot be left blank"),localStorage.setItem(this.cacheName,JSON.stringify({system:this.config.system,translate:this.translate,music:this.config.stopMusic,arrow:this.config.Arrow,bios:this.bios}));else{let e=localStorage.getItem(this.cacheName);e&&(e=JSON.parse(e),this.translate=Number(e.translate),this.config.stopMusic=Number(e.music),this.config.Arrow=e.arrow,this.bios=Number(e.bios))}}RUN(e,t){if(this.ELM(),e&&(this.config.gameUrl=e),t&&(this.config.gameBuf=t),this.SETCONFIG(),!this.config.system)return;this.translate&&0!=this.translate||(this.config.translate={},delete this.config.translate),this.bios&&(this.config.biosUrl=this.getbios(this.config.system));let a=setInterval((()=>{this.ready&&(clearInterval(a),window.emu=new EJS(this.elm,this.config))}),500)}constructor(){"undefined"==typeof EJS?this.addjs(this.dir+"localforage.min.js",(()=>this.downEJS())):this.ready=!0}async todownload(e,t){let a=await fetch("https://www.emulatorjs.com/cores/"+e+"?v="+t);if(404==a.status)return;let o=await a.arrayBuffer();if("404"!=a.status&&0!=o.byteLength){let t=new Uint8Array(o.slice(12));t.set([55,122,188,175,39,28,0,3],0),this.download(t,e.replace(".data",".7z"))}}async downloadCore(e){for(let t in e)if("fba0.2.97.29"!=t&&"pceCD"!=t)if("mame"!=t)"atari2600"!=t&&"atari7800"!=t&&"segaGG"!=t&&"segaMD"!=t&&"segaMS"!=t&&"segaCD"!=t&&"segaSaturn"!=t&&"sega32x"!=t&&(e[t].asmjs&&await this.todownload(t+"-asmjs.data",e[t].version),"n64"==t&&e[t].asmjs&&await this.todownload(t+"-legacy-asmjs.data",e[t].version),e[t].wasm&&await this.todownload(t+"-wasm.data",e[t].version));else for(let a=1;a<7;a++)await this.todownload(t+"-"+a+"-wasm.data",e[t].version);return e}SET(e){for(var t in e=e||{})this.config[t]=e[t]}CALL(e){if(this.ready)e.call(this);else{let t=setInterval((()=>{this.ready&&(clearInterval(t),e.call(this))}),500)}}ReadFile(e){for(let t in e){let a=t.split(".")[0];"libunrar.js.mem"==t&&(a="libunrarmem"),"v.json"==t&&(a="vjson"),this.config[a]=window.URL.createObjectURL(new Blob([e[t]])),delete e[t]}e=null,this.addjs(this.config.emulator,(()=>{window.URL.revokeObjectURL(this.config.emulator),delete this.config.emulator,this.ready=!0}))}addjs(e,t){let a=document.createElement("script");a.src=e,a.onload=()=>t(),document.body.appendChild(a)}ELM(){let e;return document.querySelector(this.elm)||(e=document.createElement("div"),document.body.appendChild(e),e.style.cssText="width: 100%;height:100%;position:absolute;left: 0px;top: 0px;right:0px;z-index: 11;",e.innerHTML=`<div  id="${this.elm.replace("#","")}" ></div>`),document.querySelector(this.elm)}async downEJS(){let e=await localforage.getItem("EJS");if(e&&e.version==this.version)this.ReadFile(e);else{let e=await fetch(this.dir+"EJS.7z"),t=this.ELM(),a=0,o=e.headers.get("Content-Length")||1024;const s=e.body.getReader(),n=new ReadableStream({start(e){let n=()=>{s.read().then((({done:s,value:r})=>{if(s)return e.close(),void(n=null);a+=r.length,t.innerHTML="EJS.7z complete "+Math.floor(a/o*100)+"%speed "+Math.floor(a/1024)+"KB",e.enqueue(r),n()}))};n()}});let r=await new Response(n).arrayBuffer(),i=new Worker(window.URL.createObjectURL(new Blob([`importScripts("${this.dir}extract7z.min.js");`],{type:"application/javascript"}))),l={version:this.version};i.onmessage=e=>{e.data.data?l[e.data.file]=e.data.data:1==e.data.t&&localforage.setItem("EJS",l).then((()=>this.ReadFile(l)))},i.postMessage(new Uint8Array(r))}}};