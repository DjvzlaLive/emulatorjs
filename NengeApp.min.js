let Fileurl=document.currentScript.src.split("/").slice(0,-1),NengeApp=new class{dir=Fileurl.join("/")+"/";version=1.2;config={gameId:122,OptionSet:{screenRecord:{label:"Start Screen Recording",options:{}},NengePanel:{label:"Nenge's Panel",options:{downloadsrm:"DownLoad SRM",uploadsrm:"Upload SRM",downloadstate:"DownLoad State",uploadstate:"Upload State",downloadsrm:"DownLoad SRM",reload:"Reload Page",fastforward:"Fast Forward",Cache2Manage:"Cache Manage",NDSScreenOver:"NDS Screen Over",HomePage:"Home Page",tosavesrm:"Saved SRM",toloadsrm:"Loaded SRM"}}},onsavestate:async function(){EJS.STATE_SAVE(this).then((e=>{}))},onloadstate:async function(){EJS.STATE_LOAD(this).then((e=>{}))},OptionCall:{HomePage:function(){let e=this.config.HomePage||this.config.runpage||location.origin;location.href==e?location.reload():location.href=e},NDSScreenOver:function(e){e.Module.canvas.classList.toggle("ejs--screen-"+this.system)},Cache2Manage:function(){this.MENU_SET("ContextMenuItem").CacheManage.call(this)},QuickSave:function(){EJS.STATE_SAVE(this).then((e=>{}))},QuickLoad:function(){EJS.STATE_LOAD(this).then((e=>{}))},tosavesrm:function(e){EJS.SRM_SAVE(this).then((e=>{}))},toloadsrm:function(e){EJS.SRM_LOAD(this).then((e=>{}))},reload:()=>{location.reload()},downloadsrm:function(e){EJS.SRM_SAVE(this,!0).then((e=>{}))},downloadstate:function(e){EJS.STATE_SAVE(this,!0).then((e=>{}))},uploadsrm:function(e){NengeApp.upload((e=>{EJS.SRM_LOAD(this,e)}))},uploadstate:function(e){NengeApp.upload((e=>{EJS.STATE_LOAD(this,e).then((e=>{}))}))},fastforward:function(e,a){let t=e.Module;if(t._fast_forward){let e=a.target,s=this.config,o=this.translate(s.OptionSet.NengePanel.options.fastforward),n=this.translate("Stop Forward"),r=0;e.textContent==o?(e.innerHTML=n,r=1):e.innerHTML=o,t._fast_forward(r)}},screenRecord:function(e,a){let t=a.target,s=this.config.OptionSet.screenRecord.label,o=this.translate[s]||s,n="Stop Screen Recording",r=this.translate[n]||n;e.recorder||(e.recorder=NengeApp.setRecord(e)),e.recorder||t.parentNode.remove(),t.textContent==r?(t.innerHTML=o,e.recorder.gamename=this.startName,e.recorder.stop()):(t.innerHTML=r,e.recorder.start())}},translate:{"Nenge's Panel":"能哥面板","DownLoad SRM":"下载电子存档","Upload SRM":"上传电子存档","DownLoad State":"下载即时状态","Upload State":"上传即时状态","Fast Forward":"加速","Stop Forward":"停止加速","Start Screen Recording":"开始录像","Stop Screen Recording":"停止录像","Reload Page":"刷新页面",SELECT:"选择",START:"开始",MENU:"菜单","NDS Screen Over":"让NDS屏幕占满","Loading...":"载入中","OpenGBA RTC":"开启GBARTC","Network Error":"网络错误！","Download Game Core":"载入运行核心","Decompress Game Core":"解压核心进度","Game Core ready":"核心加载完毕！","Download Game Data":"载入游戏数据","Decompress Game Data":"解压游戏数据","Game Data ready":"游戏数据准备完毕！","Take Screenshot":"截图","Home Page":"主页","Cache Manager":"游戏缓存管理","Cache Manage":"游戏缓存列表","Quick Save (F2)":"保存状态","Quick Load (F4)":"读取状态","All Clear":"全部清除","Room Name":"房间名","Password:":"密码",Player:"玩家",Name:"名称","Set Player Name":"设置玩家名","Create a Room":"建房","Password (Optional)":"密码(可选)",Password:"密码",Rooms:"房间列表",Players:"玩家数量","Player Name":"玩家名称","Max Players":"最大玩家数量",OK:"好",Clear:"清除",Remove:"移除","Load this Game":"载入这个游戏","on start":"准备开始","on ready":"准备完毕",COMBOKEY:"连发",Enabled:"启用",enabled:"开启",disabled:"关闭",Disabled:"关闭","2xScaleHQ":"2倍柔化","4xScaleHQ":"4倍柔化","4xScaleHQ.glslp":"启用4倍柔化","CRT easymode":"液晶简易","CRT aperture":"液晶模糊","CRT geom":"液晶管道",Shader:"屏幕滤镜","Virtual Gamepad":"虚拟按键","Enable Turbo Buttons":"开启加速选项","Turbo Delay in frames":"加速帧延迟","Solar sensor level":"光感等级",Frameskip:"跳帧","Screen layout":"屏幕布局","top/bottom":"上/下","bottom/top":"下/上","left/right":"左/右","right/left":"右/左","top only":"只有上","bottom only":"只有下","quick switch":"快速切换","hybrid/top":"放大上","hybrid/bottom":"放大下","Screen Rotation":"旋转屏幕",none:"空的","Player 1 Pak":"玩家1 Pak","Player 2 Pak":"玩家2 Pak","Player 3 Pak":"玩家3 Pak","Player 4 Pak":"玩家4 Pak",memory:"内存",rumble:"噪音","Aspect Ratio (Need to refresh page)":"宽高比（需要刷新页面）","16:9 Resolution":"16:9 分辨率","4:3 Resolution":"4:3 分辨率","Enable second memory card":"开启第二内存卡","Pad 1 Type":"Pad 1类型","Pad 2 Type":"Pad 2类型","Pad 3 Type":"Pad 3类型","Pad 4 Type":"Pad 4类型",default:"默认",standard:"标准",analog:"摇杆",negcon:"NeGcon","Enable Vibration":"启动震动","Enable interlacing mode(s)":"启用隔行扫描模式(*)","Enhanced resolution (slow)":"增强分辨率（慢）","Enhanced resolution speed hack":"增强的分辨率速度破解","INSERT COIN":"投币","Aspect ratio":"宽高比",DAR:"窄屏",PAR:"宽屏","CPU overclock":"CPU超频","Diagnostic Input":"诊断输入",None:"",None:"空的","Hold Start":"按住开始","Start + A + B":"开始+A+B","Hold Start + A + B":"按住开始+A+B","Start + L + R":"开始+L+R","Hold Start + L + R":"按住开始+L+R","Hold Select":"按住选择","Select + A + B":"选择+A+B","Hold Select + A + B":"按住选择+A+B","Select + L + R":"选择+L+R","Hold Select + L + R":"按住选择+L+R","Force Neo Geo mode":"强制NeoGeo模式",MVS:"街机",AES:"家用",UNIBIOS:"反作弊",DIPSWITCH:"DIP开关",Voice:"声音","Test mode":"测试模式","Stop mode":"暂停模式",Off:"关闭",On:"开启","Bios select (Fake)":"Bios 选择(虚拟)",Newer:"较新",Older:"较旧",Music:"音乐","Free play":"免费开始","Newer (no intro, calendar)":"较新(无介绍,日历)","Newer (no intro)":"较新(无介绍)","Region (Fake)":"地区(虚拟)",World:"世界",China:"中国",Taiwan:"台湾",Japan:"日本",Korea:"韩国","Hong Kong":"香港",World:"世界",Restart:"",Play:"开始",Pause:"暂停",Played:"已开始",Volume:"音量","Mute (F9)":"静音(F9)","Unmute (F9)":"取消静音(F9)","Enter fullscreen":"进入全屏","Exit fullscreen":"取消全屏",Settings:"设置","Save State (Shift + F2)":"存储状态(Shift + F2)","Load State (Shift + F4)":"读取状态(Shift + F4)",Netplay:"联机","Controls Settings":"控制设置",Cheats:"金手指","Go back to previous menu":"返回上层菜单",Normal:"普通",All:"全部",Reset:"重设","Play Now":"开始游戏",Restart:"重启","Add Cheat":"添加金手指",Close:"关闭","Add Cheat Code":"添加金手指代码",Code:"代码",Description:"描述",Submit:"提交","Player 1":"玩家1","Player 2":"玩家2","Player 3":"玩家3","Player 4":"玩家4",Update:"更新",Cancel:"取消","Press keyboard or gamepad":"按下任意键","Connected gamepad":"连接的手柄",Gamepad:"手柄",Keyboard:"键盘",Set:"设置",Default:"默认",Low:"低",High:"高","Very High":"很高","4 Players Support":"支持4玩家","Color Palette":"彩电调色板",asqrealc:"","nintendo-vc":"任天堂VC",rgb:"红绿蓝","yuv-v3":"YUV版本3",Auto:"自动",NTSC:"NTSC美国制",PAL:"PAL帕尔制",pal:"PAL帕尔制","Sound Quality":"声音质量",NES:"红白机",Famicom:"家庭用机","Turbo Enable":"启用涡轮",Both:"两者",Region:"地区",Dendy:"山寨FC","bmf-final2":"BMF2","bmf-final3":"BMF3","smooth-fbx":"FBX","composite-direct-fbx":"FBX2","pvm-style-d93-fbx":"FBX3",nescap:"nescap","ntsc-hardware-fbx":"ntsc-hardware-fbx","nes-classic-fbx-fs":"nes-classic-fbx-fs",wavebeam:"波动枪","No Sprite Limit":"无限制",asqrealc:"asqrealc","unsaturated-final":"unsaturated-final","sony-cxa2025as-us":"sony-cxa2025as-us","Saved SRM":"保存SRM","Loaded SRM":"读取SRM","GB Colorization":"GB着色",internal:"内置",auto:"自动","Internal Palette":"内置调色板","GBC - Blue":"GBC蓝","GBC - Brown":"GBC褐色","GBC - Dark Blue":"GBC深蓝","GBC - Dark Brown":"GBC深褐色","GBC - Dark Green":"GBC深绿","GBC - Grayscale":"GBC灰色","GBC - Green":"GBC绿色","GBC - Inverted":"GBC底片","GBC - Orange":"GBC橙色","GBC - Pastel Mix":"GBC混合","GBC - Red":"GBC红色","GBC - Yellow":"GBC黄色","Download BIOS":"下载BIOS","BIOS ready":"BIOS 完成"}};coreSupport={psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],"3do":["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],"32x":["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],"fba0.2.97.29":["zip"],mame2003:["zip"],mame:["zip"]};coreSystem={psx:"psx",nds:"nds",nes:"nes",fc:"nes",sfc:"snes",snes:"snes",snes2002:"snes2002",snes2005:"snes2005",snes2010:"snes2010",gb:"gb",gbc:"gb",gba:"gba",vbanext:"vbanext",vb:"vb",n64:"n64","3do":"3do",segaMS:"sega",segaGG:"sega",segaMD:"sega",segaCD:"segacd",sega32x:"32x",segaSaturn:"saturn",ngp:"ngp",pce:"pce",msx:"bluemsx",atari2600:"a2600",atari7800:"a7800",lynx:"lynx",ws:"ws",arcade:"arcade","fba0.2.97.29":"fba0.2.97.29",jaguar:"jaguar",mame2003:"mame2003"};setRecord(e){let a;if(["video/webm; codecs=h264","video/webm; codecs=vp9","video/webm; codecs=vp8","video/webm; codecs=vp9.0","video/webm; codecs=vp8.0","video/webm; codecs=avc1"].forEach((e=>{!a&&MediaRecorder.isTypeSupported(e)&&(a=e)})),!a)return!1;let t=e.Module.canvas.captureStream(30);if(!t)return!1;let s=new MediaRecorder(t,{mimeType:a});return s?(s.BLOBdata=[],s.ondataavailable=e=>{s.BLOBdata.push(e.data)},s.onstop=()=>{if(s.BLOBdata.length<1)return;let e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob(s.BLOBdata,{type:a})),e.download=(s.gamename||"record")+"."+a.split("/")[1].split(";")[0],e.click(),s.BLOBdata=[]},window.recorder=s,s):(t=null,!1)}getName(e,a){let t=(e=e.split("/").pop().split(".")).slice(0,e.length-1),s=e.pop();return t+"."+(a||s)}download(e,a,t){let s=document.createElement("a"),o={};t&&(o.type=t),s.href=window.URL.createObjectURL(new Blob(e instanceof Blob?e:[e],o)),s.download=a,s.click()}upload(e){let a=document.createElement("input");a.type="file",a.onchange=t=>{let s=t.target,o=s.files[0];if(!o)return;s.value="";let n=new FileReader;n.onload=a=>e(new Uint8Array(a.target.result),o.name),n.readAsArrayBuffer(o),a.onchange=null,a.remove()},a.click()}_elm="#nenge-game";get elm(){return this._elm}set elm(e){if("string"==typeof e&&e==this._elm)return;if("string"!=typeof e){e[0]&&(e=e[0]);let a="";if(e.id&&(a=e.id),e.className&&(a=e.classList[0]),a==this._elm)return;e=a}let a=document.querySelector(this._elm);a&&a.parentNode.remove(),this._elm=e}getbios(e){let a;switch(e){case"msx":case"sega":case"segaCD":case"psx":a=e+".7z";break;case"gb":case"gbc":case"gba":case"vbanext":a="gba.7z";break;case"mame":case"mame2003":case"fba0.2.97.29":case"arcade":a="arcade.7z";break;case"segaGG":a="bios.gg";case"bluemsx":a="msx.gg";break;default:break}return a?this.dir+"bios/"+a:""}cacheName="nenge-emu-config";SETCONFIG(){if(document.getElementsByName("system")[0])this.config.system=document.getElementsByName("system")[0].value,this.translate=Number(document.getElementsByName("translate")[0].value),this.config.stopMusic=Number(document.getElementsByName("music")[0].value),this.config.Arrow=document.getElementsByName("arrow")[0].value,this.bios=Number(document.getElementsByName("bios")[0].value),this.config.system||alert("核心设置不能留空 Core settings cannot be left blank"),localStorage.setItem(this.cacheName,JSON.stringify({system:this.config.system,translate:this.translate,music:this.config.stopMusic,arrow:this.config.Arrow,bios:this.bios}));else{let e=localStorage.getItem(this.cacheName);e&&(e=JSON.parse(e),this.translate=Number(e.translate),this.config.stopMusic=Number(e.music),this.config.Arrow=e.arrow,this.bios=Number(e.bios))}}RUN(e,a,t){if(this.ELM(),this.SETCONFIG(),e&&(this.config.gameUrl=e),a&&(this.config.system=a),t&&(this.config.gameBuf=t),!this.config.system)return;null==this.translate||0!=this.translate&&0!=this.translate||(this.config.translate={},delete this.config.translate),"fc"==this.config.system&&(this.config.system="nes"),"sfc"==this.config.system&&(this.config.system="snes"),this.bios&&(this.config.biosUrl=this.getbios(this.coreSystem[this.config.system]));let s=setInterval((()=>{this.ready&&(clearInterval(s),window.emu=new EJS(this.elm,this.config))}),500)}constructor(){"undefined"==typeof EJS?this.addjs(this.dir+"localforage.min.js",(()=>this.downEJS())):this.ready=!0}ReadFile(e){for(let a in e){if("version"==a)continue;let t=a.split(".")[0];"libunrar.js.mem"==a&&(t="libunrarmem"),"v.json"==a&&(t="vjson"),this.config[t]=window.URL.createObjectURL(new Blob([e[a]])),delete e[a]}e=null,this.addjs(this.config.emulator,(()=>{window.URL.revokeObjectURL(this.config.emulator),delete this.config.emulator,this.ready=!0}))}async todownload(e,a){let t=await fetch("https://www.emulatorjs.com/cores/"+e+"?v="+a);if(404==t.status)return;let s=await t.arrayBuffer();if("404"!=t.status&&0!=s.byteLength){let a=new Uint8Array(s);55!=a[0]&&122!=a[1]&&(a=a.slice(12),a.set([55,122,188,175,39,28,0,3],0)),this.download(a,e.replace(".data",".7z"))}}async downloadCore(e){for(let a in e)if("fba0.2.97.29"!=a&&"pceCD"!=a)if("mame"!=a)"atari2600"!=a&&"atari7800"!=a&&"segaGG"!=a&&"segaMD"!=a&&"segaMS"!=a&&"segaCD"!=a&&"segaSaturn"!=a&&"sega32x"!=a&&(e[a].asmjs&&await this.todownload(a+"-asmjs.data",e[a].version),"n64"==a&&e[a].asmjs&&await this.todownload(a+"-legacy-asmjs.data",e[a].version),e[a].wasm&&await this.todownload(a+"-wasm.data",e[a].version));else for(let t=1;t<7;t++)await this.todownload(a+"-"+t+"-wasm.data",e[a].version);return e}SET(e){for(var a in e=e||{})this.config[a]=e[a]}CALL(e){if(this.ready)e.call(this);else{let a=setInterval((()=>{this.ready&&(clearInterval(a),e.call(this))}),500)}}addjs(e,a){let t=document.createElement("script");t.src=e,t.onload=()=>a(),document.body.appendChild(t)}ELM(){let e;return document.querySelector(this.elm)||(e=document.createElement("div"),document.body.appendChild(e),e.style.cssText="width: 100%;height:100%;position:absolute;left: 0px;top: 0px;right:0px;z-index: 11;",e.innerHTML=`<div  id="${this.elm.replace("#","")}" ></div>`),document.querySelector(this.elm)}async downEJS(){let e=await localforage.getItem("EJS");if(e&&e.version==this.version)this.ReadFile(e);else{let e=await fetch(this.dir+"EJS.7z"),a=this.ELM(),t=0,s=e.headers.get("Content-Length")||1024;const o=e.body.getReader(),n=new ReadableStream({start(e){let n=()=>{o.read().then((({done:o,value:r})=>{if(o)return e.close(),void(n=null);t+=r.length,a.innerHTML="EJS.7z complete "+Math.floor(t/s*100)+"%speed "+Math.floor(t/1024)+"KB",e.enqueue(r),n()}))};n()}});let r=await new Response(n).arrayBuffer(),i=new Worker(window.URL.createObjectURL(new Blob([`importScripts("${this.dir}extract7z.min.js");`],{type:"application/javascript"}))),l={version:this.version};i.onmessage=e=>{e.data.data?l[e.data.file]=e.data.data:1==e.data.t&&localforage.setItem("EJS",l).then((()=>this.ReadFile(l)))},i.postMessage(new Uint8Array(r))}}};