const Nenge=new class{version=1;DB_NAME="XBBS";DB_STORE_MAP={"data-js":{timestamp:!1},"data-file":{},avatar:{timestamp:!1},forumsicon:{timestamp:!1},document:{timestamp:!1}};constructor(){const e=this,t=e.I;e.language=navigator.language;let s=e.language.split("-");s="zh"==s[0]?"TW"==s[1]?"zh-hant":"zh-hans":s[0],e.i18nName=s,e.on(window,"error",(e=>{t.mobile&&alert(e.message)})),e.triger(document,"NengeStart",e),e.docload((t=>e.triger(document,"NengeReady",e)))}LibStore="data-js";maxsize=104857600;part="-part-";lang={};action={};StoreTable={};JSpath=document.currentScript&&document.currentScript.src.split("/").slice(0,-1).join("/")+"/";get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return this.I.int(this.rand.toString().slice(2))}async getItem(e,t,s,r={}){if(!t)return await this.getAllData(e,1,r);let n=this,a=n.F,i=n.I,o=n.maxsize,l=n.part,c=await a.dbGetItem(i.assign({store:e,name:t},r)),d=t.split(l)[0];if(c){if(s&&c.version&&c.version!=s)c=void 0;else if(c.contents&&c.filesize&&c.filesize>o){let s=i.u8(c.filesize);await i.Async(i.arr(Math.ceil(c.filesize/o)).fill(d).map((async(d,u)=>{let h=d;if(u>0&&(h+=l+u),h==t)s.set(c.contents,u*o);else{let t=await a.dbGetItem(i.assign(r,{store:e,name:h}));t?s.set(t.contents,u*o):n.Err("lost file")}}))),c.contents=s}c&&c.contents&&i.u8buf(c.contents)&&("unpack"==c.type?(c.password&&(r.password=c.password),c.contents=await a.unFile(c.contents,r)):"File"==c.type?c.contents=new File([c.contents],c.filename||d,{type:c.filetype||a.gettype(c.filename||d)}):"String"==c.type&&(c.contents=i.decode(c.contents)))}return c}async setItem(e,t,s,r){let n=this,a=n.F,i=n.I,o=n.maxsize,l=n.part;if((s=await a.dbCheckSize(s,o)).contents&&s.contents.byteLength>o){let n=s.contents.byteLength,c={};return i.toArr(s,(e=>{"contents"!=e[0]&&(c[e[0]]=e[1])})),await i.Async(i.arr(Math.ceil(n/o)).fill(t).map((async(t,d)=>{let u=t,h=d*o;return d>0&&(u+=l+d),await a.dbPutItem({store:e,data:i.assign({contents:i.u8(s.contents.subarray(h,n-h>=o?h+o:n))},c),name:u,dbName:r})})))}return await a.dbPutItem({store:e,data:s,name:t,dbName:r})}async removeItem(e,t,s){let{clear:r,dbName:n}=s||{},a=this,i=a.I,o=a.F;if(r){let r=await o.dbGetItem(i.assign({store:e,name:t},s));if(r&&r.filesize)return await i.Async(i.arr(Math.ceil(r.filesize/a.maxsize)).fill(t.split(a.part)[0]).map((async(t,s)=>{let r=t;return s>0&&(r+=a.part+s),await o.dbRemoveItem({store:e,name:r})+"\n"})))}return await o.dbRemoveItem({store:e,name:t,dbName:n})}async getAllData(e,t,s){return e?await this.F.dbGetAll(this.I.assign({store:e,only:t},s)):{}}async getContent(e,t,s,r){let n=await this.getItem(e,t,s,r);return n&&n.contents||n}async setContent(e,t,s,r,n){let a=this.I.assign(r||{},{contents:s,timestamp:this.date});return await this.setItem(e,t,a,n)}async getAllKeys(e,t,s){return await this.F.dbGetKeys(this.I.assign({store:e,dbName:t},s||{}))}async getAllCursor(e,t,s,r){return await this.F.dbGetCursor(this.I.assign({store:e,index:t,only:s},r))}async clearDB(e,t){let s=this.F;if(e)return s.I.str(e)&&(e=[e]),await s.dbRemoveTable(e,t)}async deleteDB(e,t){let s=this.F;return s.I.str(e)&&(e=[e]),await s.deleteDatabase(e,t)}getStore(e,t){if(!e)return;let s=this;if(e instanceof s.F.StoreDatabase)return e;t=t||s.DB_NAME,s.StoreTable[t]||(s.StoreTable[t]={});let r=s.F,n=s.StoreTable[t];return n[e]||(n[e]=new r.StoreDatabase(s,e,t)),n[e]}async FetchItem(e){let t=this,s=t.F,r=t.I;e&&!r.str(e)||(e={url:e||"/"});let n,a,i="arrayBuffer",o=s.getname(e.url),l=e.key||o||"index.php",c=e.key==s.LibKey?l+o:l,d=e.version,u={},h=e.store&&t.getStore(e.store),p=(t,n)=>s.unFile(t,r.assign(e,{password:n})),m=async e=>(e&&e.contents&&("unpack"==e.type?(e=await p(e.contents,e.password)).password&&delete e.password:e=e.contents),b(e),e),b=t=>t&&e.success&&e.success(t,u);if(e.filename||(e.filename=o),e.onLine&&(e.unset=navigator.onLine),h&&(n=await h.get(c,d,e),n&&!e.unset&&!e.checksize))return m(n);if(a=await s.FetchStart(e).catch((t=>e.error&&e.error(t.message))),!a)return m(n);u=s.FetchHeader(a,e),r.exends(u,a,["url","status","statusText"]);let g=u.password||e.password||void 0;if(200!=a.status)return a.body&&(a.body.cancel(),e.error&&e.error(a.statusText,u)),"head"==e.type&&b(u),m(n);if(n&&n.filesize&&u.byteLength>0){if(n.filesize==u.byteLength)return a.body.cancel(),m(n);n=null}else if("head"==e.type)return a.body.cancel(),b(u);let y=r.func(e.process)?await s.StreamResponse(a,e,u):a;e.unpack&&(e.type=i),e.type=e.type||i;let f=await y[e.type](),w=u.type,v=u.byteLength||0,j=u["content-type"];if(e.type==i&&r.buf(f)&&(f=r.u8(f),e.Filter&&(f=e.Filter(f)),w=r.N(11),v=f.byteLength,e.autounpack&&v<.3*t.maxsize&&(e.unpack=!0)),e.dataOption=e.dataOption||{},h&&e.unpack&&l===c&&v>t.maxsize&&(w="unpack",await h.put(c,r.assign({contents:f,timestamp:new Date,filesize:v,filetype:j,version:d,type:w,password:g},e.dataOption)),h=null),e.unpack&&r.u8buf(f)&&(f=await p(f,g),f.byteLength||(f.password&&(g=f.password,delete f.password),w="datalist")),h&&l!==c){if(r.u8buf(f))f=s.getFileText(f,e.decode,e.mime||u["content-type"]||s.gettype(""),o),w="File";else if(r.str(f))w=u["content-type"]||"String";else if("datalist"==w){let n;await r.Async(r.toArr(f).map((async a=>{let[i,o]=a,l=s.getname(i),c=s.gettype(l),d=s.getFileText(o,e.decode,c,l);return h.put(e.key+l,r.assign({contents:d,timestamp:t.date,filesize:o.byteLength,version:t.version,filetype:c,type:r.blob(d)?"File":"String"},e.dataOption)),e.filename==l&&(n=d),!0}))),n&&(f=n),n=null,h=null}}else e.decode&&(f=s.getFileText(f,e.decode,w),r.str(f)&&(w="String"));return h&&await h.put(c,r.assign({contents:f,filesize:v,filetype:j,version:d,type:w,password:g,timestamp:t.date},e.dataOption)),e.success&&e.success(f,u),f}ajax(e){let t=this,s=t.I;t.F;return s.str(e)&&(e={url:e}),s.Async((r=>{const n=new XMLHttpRequest(e.paramsDictionary);t.on(n,"error",(t=>{e.error&&e.error("net::ERR_FAILED"),r(null)})),t.on(n,"readystatechange",(t=>{switch(n.readyState){case n.LOADING:case n.OPENED:case n.UNSENT:break;case n.HEADERS_RECEIVED:if(s.defines(n,{headers:s.toObj((n.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",n.status],["statusText",n.statusText],["url",o]]))},1,1),"head"==e.type)return n.abort(),e.success&&e.success(n.headers),void r(n.headers);break;case n.DONE:200==n.status?(e.success&&e.success(n.response,n.headers,n),r(n.response)):n.status>0&&(e.error&&e.error(n.statusText,n.headers,n),r(null));break}})),e.process&&t.on(n,"progress",(t=>e.process(Math.ceil(100*t.loaded/t.total).toFixed(2)+"%",t.total,t.loaded,0,n))),e.postProcess&&t.on(n.upload,"progress",(t=>e.postProcess(Math.ceil(100*t.loaded/t.total)+"%",t.total,t.loaded,t)));let a=["abort","load","loadend","loadstart","progress","readystatechange","timeout"];a.forEach((s=>e[s]&&t.on(n,s,(t=>e[s](t,n))))),n.upload&&e.upload&&a.forEach((s=>e.upload[s]&&t.on(n.upload,s,(t=>e.upload[s](t,n)))));let i,o,l=e.type||"";e.get={},o=s.get(e.url,e.get),e.json?(i=JSON.stringify(e.json),e.headers=Object.assign({accept:"application/json, text/plain, */*"},e.headers)):e.post&&(i=s.post(e.post)),e.overType&&n.overrideMimeType(e.overType),"head"!=l&&(n.responseType=l),n.open(i?"POST":"GET",o),e.headers&&s.toArr(e.headers,(e=>n.setRequestHeader(e[0],e[1]))),n.send(i)}))}runaction(e,t){let s=this;if(s.action)return Nenge.I.func(s.action[e])?void 0===t||null==t?s.action[e].call(s):"string"!=typeof t&&t.length?s.action[e].apply(s,t||[]):s.action[e].call(s,t):void 0}callaction(e){let t=this;if(!t.action||!e)return;let s=Array.from(arguments),r=t.action[s.shift()];return r?r.apply(t,s):void 0}bindaction(e){let t=this;if(t.action&&e&&t.action[e])return t.action[e].bind(t)}addJS(e,t,s,r){let n=this,a=n.F,i=n.I;if(i.blob(e)&&(r=a.getKeyName(e.name),"text/css"==e.type&&(s=!0)),r&&n.$("#link_"+r))return;let o=!1,l=n.$ce(s?"link":"script"),c=t=>{/^(blob:)?https?:\/\//.test(e)||/(\.js$|\.css$)/.test(e)||(o=!0,e=a.URL(e,a.gettype(s?"css":"js"))),s?(l.type=a.gettype("css"),l.href=e,l.rel="stylesheet"):(l.type=a.gettype("js"),l.src=e),r&&l.setAttribute("id","link_"+r),l.onload=r=>{t&&t(r),o&&a.removeURL(e),e=null,s||l.remove()},document[s?"head":"body"].appendChild(l)};return t?(c(t),l):i.Async(((e,t)=>c(e)))}async loadScript(e,t,s,r){t=t||{};let n=this,a=n.F;t.url=a.getpath(e),s?t.type="text":(t.store||(t.store=n.LibStore),t.key||(t.key=a.LibKey)),t.version=t.version||n.version;let i=await n.FetchItem(t);return s?i:await n.addJS(i)}async getScript(e,t){return this.loadScript(e,t,!0)}async addScript(e,t){return await T.addJS(await T.getScript(e,t))}async loadLibjs(e,t){let s=this.F;return await this.addJS(await s.getLibjs(e,t),null,"css"==s.getExt(e))}unFile(e,t,s){return this.F.unFile(e,this.I.assign({process:t},s||{}))}async toZip(e,t,s){let r=this;r.F;return r.I.Async((async n=>{let a=new Worker(r.JSpath+"zip.js?"+r.time);r.on(a,"message",(e=>{let s=e.data;1==s.t?(n(s.contents),e.target.terminate()):2==s.t&&t&&t(Math.ceil(100*s.current/s.total)+"%")})),r.on(a,"error",(e=>{n(null),a.terminate()})),a.postMessage(Object({contents:e},s||{})),e=null}))}on(e,t,s,r,n){this.$(e).addEventListener(t,s,!1===r?{passive:!1}:r,n)}un(e,t,s,r,n){this.$(e).removeEventListener(t,s,!1===r?{passive:!1}:r,n)}once(e,t,s,r){return this.on(e,t,s,{passive:!1,once:!0},r)}docload(e){let t=this,s=document;return t.I.Async((r=>{let n=()=>{e&&e.call(t),r(t)};"loading"==s.readyState?t.once(s,"DOMContentLoaded",n):n()}))}$(e,t){let s=this.I;return e?s.str(e)?(t||document).querySelector(e):s.func(e)?this.docload(e):e:void 0}$$(e,t){return(t||document).querySelectorAll(e)}$ce(e){return document.createElement(e)}$ct(e,t){let s=this.$ce(e);return s.innerHTML=t,s}$ca(e,t){let s=this.$ce(e);return this.I.toArr(t,(e=>s.setAttribute(e[0],e[1]))),s}$append(e,t){return e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}customElement(e){let t=this;window.customElements.define(e,class extends HTMLElement{constructor(){super(),t.callaction("TAG-"+this.tagName,this,"init")}connectedCallback(){t.callaction("TAG-"+this.tagName,this,"connect")}attributeChangedCallback(e,s,r){t.callaction("TAG-"+this.tagName,this,"attribute",{name:e,oldValue:s,newValue:r})}disconnectedCallback(){t.callaction("TAG-"+this.tagName,this,"disconnect")}})}attr(e,t){return this.$(e).getAttribute(t)}docElm(e,t){return(new DOMParser).parseFromString(e,t||"text/html")}HTMLToTxt(e,t){let s=this.I;return s.str(e)&&(e=this.docElm(e)),s.doc(e)?e.body[t?"innerHTML":"textContent"]:""}fragment(){return new DocumentFragment}Err(e){return new Error(e)}down(e,t,s){return this.F.download(e,t,s)}getLang(e,t){let s=this.lang&&this.lang[e]||e;return this.lang[e],t&&s&&T.I.toArr(t,(e=>{s=s.replace(new RegExp("/{"+e[0]+"}/","g"),e[1])})),s}triger(e,t,s){let r=this,n=r.I;return n.str(e)&&(e=r.$(e)),r.dispatch(e,new n.O[22](t,{detail:s})),e}dispatch(e,t){return e.dispatchEvent(t),e}stopGesture(e){let t=this;return t.I.toArr(["gesturestart","gesturechange","gestureend"],(s=>t.on(e,s,(e=>t.stopEvent(e))))),e}stopEvent(e){e.preventDefault()}stopProp(e){e.preventDefault(),e.stopPropagation()}I=new class{O=[Array,Object,Element,HTMLFormElement,FormData,URLSearchParams,NamedNodeMap,DOMStringMap,CSSStyleDeclaration,Document,ArrayBuffer,Uint8Array,Promise,Blob,File,String,void 0,null,Reflect,Function,Boolean,Headers,CustomEvent,HTMLCollection,FileList,TextDecoder,TextEncoder,NodeList,Number];constructor(e){let t=this,s=t.O,r="",n="return ",a=n+"o",i=n+"this.",o=e=>n+t.N(e)+".",l=e=>"return new "+t.N(e)+"(o)",c=e=>"new "+t.N(e),d=(e,s)=>u(e,n+"this.C(o) === "+t.N(s)),u=(e,t)=>t?`I.define(I,'${e}',{value(o){var arg=arguments;${t}}});`:"",h=(e,s,r)=>s?u(t.N(e)+(r?"2obj":"2arr"),s):"",p=e=>i+t.N(e)+"2obj(o)",m=e=>i+t.N(e)+"2arr(o)",b=e=>i+"entries(this."+t.N(e)+"2obj(o))",g=e=>`return this.arrFrom(${e})`,y=g("o");t.define(t,"T",{get:()=>e}),Object.entries({2:"elm",3:"elmform",4:"urlpost",5:"urlget",6:"nodemap",7:"DOMmap",8:"elmCss",12:"await",13:"blob",14:"file",18:"ref",19:"func",21:"header",27:"nodelist"}).forEach((e=>{return r+=(s=e[1],a=e[0],u(s,n+"o instanceof "+t.N(a)));var s,a})),Object.entries({0:"array",1:"obj",9:"doc",10:"buf",11:["u8obj","u8buf"],15:"str",20:"bool",28:"Num"}).forEach((e=>r+=e[1]instanceof s[0]?e[1].map((t=>d(t,e[0]))).join(""):d(e[1],e[0]))),Object.entries({null:a+"===null",none:a+"===undefined",has:n+"arg[1]&&o.hasOwnProperty(arg[1])||false",arr:l(0),arrFrom:o(0)+"from(o)",entries:o(1)+"entries(o);",fromEntries:o(1)+"fromEntries(o);",u8:i+"u8buf(o)?o:"+c(11)+"(o.buffer||o)",buf16str:i+'toArr(o).map(v => v.toString(16).padStart(2,0).toLocaleUpperCase()).join("")',arrTest:i+"toArr(o).filter(entry => entry[1].test(arg[1]))[0]",decode:n+c(25)+"(arg[1]).decode(o)",encode:n+c(26)+"().encode(o)",formpost:l(4),formget:l(5),int:l(28),PER:i+'num(100*o/arg[1]).toFixed(0)+"%"',Async:a+"?(this.array(o) ? "+t.N(12)+".all(o):new "+t.N(12)+"(o,arg[1])):null;"}).forEach((e=>r+=u(e[0],e[1]))),Object.entries({4:["var s = {};o.forEach((t, e) => {s[e] ? (this.array(s[e]) || (s[e] = [s[e]]), s[e].push(t)) : s[e] = t});return s",b(4)],5:[p(4),m(4)],6:[b(6),y+".map(v=>[v.name,v.value])"],7:[o(1)+"assign({}, o)",b(7)],8:[b(8),y+".map(v=>[v,o[v]])"],10:[a,g("this.u8(o)")],11:[a,y],21:[p(4),m(4)],23:[a,y],24:[a,y],27:[a,y],28:[a,l(0)]}).forEach((e=>r+=h(e[0],e[1][0],1)+h(e[0],e[1][1]))),new s[19]("I",r)(t)}N(e){return isNaN(e)?this.X(e):this.O[e].name}C(e){return null!=e&&null!=e&&e.constructor}X(e){return this.C(e)&&this.C(e).name||""}assign(){return this.O[1].assign.apply(null,arguments)}exends(e,t,s){return s?this.toArr(s,(s=>e[s]=t[s])):e=this.assign(e,t),e}get mobile(){return"ontouchend"in document}post(e){let t=this,s=t.T,r=t.urlpost(e)?e:t.formpost(t.elmform(e)?e:t.str(e)?s.$(e):void 0);return t.obj(e)&&t.toArr(e,(e=>r.append(e[0],e[1]))),r}get(e,t){let s=this,r="",n="",a=e.split("?");a[1]&&(r=s.formget(a[1])),t&&(n=s.formget(t));let i=s.formget(r+"&"+n).toString().replace(/^(.+?)=&/,"$1&");return a[0]+(i?"?"+i:"")}toObj(e){if(!e)return{};let t=this,s=t.X(e);return t[s+"2obj"]?t[s+"2obj"](e):t.obj(e)?e:t.array(e)?t.fromEntries(e):e}toArr(e,t){if(!e)return[];let s=[],r=this,n=r.X(e);return r[n+"2arr"]?s=r[n+"2arr"](e):r.array(e)?s=e:e.byteLength||e.length?s=r.arrFrom(e):r.obj(e)&&(s=r.entries(e)),r.func(t)?s.forEach(t):s}define(e,t,s,r,n){let a=!!n;return this.O[1].defineProperty(e,t,r?{get:()=>s,configurable:a}:s),e}defines(e,t,s,r){return s?this.toArr(t,(t=>this.define(e,t[0],t[1],1,r))):this.O[1].defineProperties(e,t),e}Json(e){let t=this,s=t.O;return t.u8buf(e)&&(e=t.decode(e)),"string"==typeof e?new s[19]("return "+e)():e}toJson(e){return JSON.stringify(this.Json(e))}empty(e){return!e||(this.str(e)||!!this.array(e))&&0==e.length}}(this);F=new class{Libjs={};LibKey="script-";zipsrc="zip.min.js";extpreg={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};exttype={"text/javascript":["js"],"text/css":["css","style"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml","svg"],image:["jpg","jpeg","png","gif","webp"],application:["pdf"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};action={textext(e){let t=this.I,s=t.buf16str(e),r=t.arrTest(this.extpreg,s);return r&&r[0]?r[0]:""},async rar(e,t,s){let r,n=this,a=n.I;a.blob(e)&&(!t.filename&&e.name&&(t.filename=e.name),e=a.u8(await e.arrayBuffer())),s=s||"libunrar.min.zip",n.Libjs[s]||await n.getLibjs(s,r);let i,o=n.Libjs[s];return t.process&&(i=t.filename?n.T.getLang("Decompress:")+t.filename+"=&gt;":n.T.getLang("Decompress:"),r=e=>t.process(i+(e.file?n.getname(e.file):"")+" "+a.PER(e.current,e.total),e.total,e.current)),a.Async((s=>{let a,i=new Worker(o);i.onmessage=o=>{let l=o.data,c=l.t;if(1===c)s(a||e),o.target.terminate();else if(2===c)a||(a={}),a[l.file]=l.data;else if(4===c&&l.total>0&&l.total>=l.current)r&&r(l);else if(-1==c){let r=prompt(n.T.getLang(l.message),t.password||"");if(!r)return s(e),o.target.terminate();t.unpack&&(a.password=r),t.password=r,i.postMessage({password:r})}},i.onerror=async t=>{s(e),i.terminate()},i.postMessage({contents:e,password:t.password})}))},"7z":function(e,t){return this.callaction("rar",e,t,"extract7z.zip")},async zip(e,t={}){return this.T.Libzip==this.zipsrc?this.callaction("zipjs",e,t):this.callaction("rar",e,t,this.T.Libzip)},async zipjs(e,t){t=t||{};let s=this.T;window.zip||await s.loadLibjs(s.JSpath+this.zipsrc);var r=new zip.ZipReader(new(zip[s.I.u8buf(e)?"Uint8ArrayReader":"BlobReader"])(e)),n={},a=void 0,i=async e=>{n[e.filename]=await e.getData(new zip.Uint8ArrayWriter,{onprogress:(r,n)=>t.process&&t.process(e.filename+" "+s.I.PER(r,n)),password:a})},o=async e=>{try{null==a&&(a=t.password),await i(e)}catch(t){a=window.prompt(s.getLang("Invalid password"),a),await o(e)}},l=await r.getEntries(),c=0;if(l)for(;l[c];){let e=l[c];c++,e.directory||(e.encrypted&&!a?await o(e):await i(e))}return n}};async StreamResponse(e,t,s){let r=this.I,n=s["content-length"]||0,a=t.downtext?t.downtext:"",i=0,o={done:!1,value:!1},l=e.body.getReader();return new Response(new ReadableStream({async start(e){for(;!o.done;){let s=0,c="";o.value&&(s=o.value.length,i+=s,e.enqueue(o.value)),c=n&&i<n?a+r.PER(i,n):a+Math.floor(10*i/1024)/10+"KB",t.process((t.filename?t.filename+" ":"")+c,n,i,s),o=await l.read()}e.close()}}))}FetchHeader(e,t){let s=this.I,r=s.toObj(e.headers)||{};return(r["content-type"]||this.gettype(t.url.split("/").pop()||"html")).split(";").forEach(((e,t)=>{if(e=e.trim().toLowerCase(),0==t)r["content-type"]=e;else if(-1!=e.search(/=/)){let t=e.split("=");r[t[0].trim()]=t[1].trim()}})),s.assign(r,{byteLength:s.int(r["content-length"])||0,password:r.password||r["content-password"],type:r.type||r["content-type"].split("/")[1].split("+")[0]})}async FetchStart(e){let t=this.I,{url:s,get:r,post:n}=e||{},a={};if(s=t.get(e.url,r),a.headers={},["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"].forEach((t=>{null!=e[t]&&(a[t]=e[t])})),e.json)a.body=JSON.stringify(e.json),delete e.json,a.headers.Accept="application/json",a.method="POST";else if(n){a.method="POST";let s=(a.headers.accept||a.headers.Accept||"").toLowerCase();/(\+|\/)json/.test(s)?a.body=t.toJson(n):e.accept?(a.headers.Accept=e.accept,a.body=n):a.body=t.post(n)}return fetch(s,a)}CheckExt(e){let t=this.I,s=e.slice(0,16),r=this.bindaction("textext"),n=t.blob(s)?s.arrayBuffer():t.str(s)?t.encode(s):s;return t.await(n)?t.Async((async e=>e(r(await n)))):r(n)}async unFile(e,t={}){let s=this,r=s.I;r.await(e)&&(e=await e),r.array(e)&&(e=r.u8(e));let n=await s.CheckExt(e);return!s.action[n]||t.PassExt&&t.PassExt.includes(zip)?(r.blob(e)&&(e=r.u8(await e.arrayBuffer())),e):await s.callaction(n,e,t)}async getLibjs(e,t){let s=this,r=s.T,n=s.I,a=s.getname(e),i=a.replace(/\.zip$/,".js");if(s.Libjs[a])return s.Libjs[a];if(s.Libjs[i])return s.Libjs[i];let o=await r.getStore(r.LibStore).data(s.LibKey+i,r.version);return o||(/\.zip$/.test(a)&&await s.getLibjs(r.Libzip,t),o=await r.FetchItem({url:s.getpath(e)+"?"+r.time,store:r.LibStore,key:s.LibKey,unpack:!0,filename:i,version:r.version,process:t})),o&&(n.obj(o)?s.I.toArr(o,(e=>s.Libjs[e[0]]=e[1]&&s.URL(e[1]))):s.Libjs[a]=s.URL(o)),o=null,s.Libjs[a]}getname(e){return(e||"").split("/").pop().split("?")[0].split("#")[0]}getpath(e){let t=this.T;t.I;return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:)/.test(e)?e:t.JSpath+e}getFileText(e,t,s,r){let n=this,a=n.T.I;return r&&s&&!t?new File([e],r,{type:s}):t?a.u8buf(e)?t(e):(a.toArr(e,(s=>{/(text|javascript)/.test(n.gettype(s[0]))&&(e[s[0]]=t(s[1]))})),e):e}getExt(e){return this.getname(e).split(".").pop().toLowerCase()}getKeyName(e){let t=this.getname(e).split(".");return t.pop(),t.join(".")}gettype(e){let t=this;return(e=t.getExt(e))&&!t.mime_list&&(t.mime_list={},t.I.toArr(t.exttype,(e=>e[1].forEach((s=>t.mime_list[s]=e[0]+(e[0].includes("/")?"":"/"+s)))))),t.mime_list[e]||"application/octet-stream"}URL(e,t){let s=this,r=s.I;if(r.u8buf(e))t||(t=s.gettype(s.CheckExt(e)));else if(r.str(e)){if(/^(blob|http)/.test(e)||/^\/?[\w\-_\u4e00-\u9FA5:\/\.\?\^\+ =%&@#~]+$/.test(e))return e;t||(t=s.gettype("js"))}return window.URL.createObjectURL(r.blob(e)?e:new Blob([e],{type:t}))}removeURL(e){return window.URL.revokeObjectURL(e)}download(e,t,s){let r;this.I.blob(e)?(r=this.URL(e),e=e.name||"unknowfile"):r=this.URL(t,s);let n=document.createElement("a");n.href=r,n.download=e,n.click(),n.remove()}DataBase={};get idb(){return window.indexedDB||window.webkitindexedDB}dbSetMap(e){let t=this,s=t.I,r=t.T,n=t.dbMap||{};n&&!n[t.dbname]&&(n[t.dbname]=r.DB_STORE_MAP);let a=e.store;if(a){let r=e.dbName||t.dbname;if(r&&!n[r]&&(n[r]={}),a&&!n[r][a]){n[r][a]={};let t=e.dbIndex;t&&(s.str(t)?n[r][a][t]=!1:s.assign(n[r][a],t))}}return t.dbMap||(t.dbMap=n),n}async dbLoad(e){let t=this,s=(e=e||{}).dbName||t.dbname,r=e.store,n=t.DataBase[s];return r&&t.dbCheckTable(r,n)||!r&&n?n:(e.dbName=s,await t.dbInstall(t.dbSetMap(e)),t.DataBase[s])}async dbInstall(e){let t=this,s=t.I;return await s.Async(s.toArr(e).map((async e=>{let r,[n,a]=e,i=t.DataBase[n];if(i){if(!s.toArr(a).filter((e=>!t.dbCheckTable(e[0],i))).length)return"ok";r=i.version+1,i.close(),delete t.DataBase[n]}let o=Object.keys(a);return t.DataBase[n]=await t.dbOpen(n,a,r,{success:async(e,s)=>t.dbCheckTable(o,e)!=o.length?(r=t.dbClose(e),s(await t.dbOpen(n,a,r))):s(e)}),n})))}async dbOpen(e,t,s,r){let n=this,a=n.T;return n.I.Async(((i,o)=>{let l=n.idb.open(e,s);a.on(l,"error",(async e=>{o(e)})),a.on(l,"upgradeneeded",(async e=>{let s=l.result;r&&r.upgradeneeded?await r.upgradeneeded.apply(l,[s]):t&&await n.dbCreateObject(t,s)})),a.on(l,"success",(async e=>{let t=l.result;if(r&&r.success)return await r.success(t,i);i(t)}))}))}async dbCreateObject(e,t){if(!e||!t)return;let s=this,r=s.I;await r.Async(r.toArr(e).map((async e=>{let[n,a]=e;if(!s.dbCheckTable(n,t)){let e=await t.createObjectStore(n);a&&r.toArr(a,(t=>e.createIndex(t[0],t[1]&&t[1].key||t[0],t[1]&&t[1].options||t[1]||{unique:!1})))}})))}dbCheckTable(e,t,s){return t?(this.I.str(e)&&(e=[e]),e=e?e.filter((e=>t.objectStoreNames.contains(e))):[],s?e:e.length):0}async dbCheckSize(e,t){let s=this.I;s.await(e)&&(e=await e);let r=e.contents||e,n={};return s.str(r)&&r.length>t?(r=s.encode(r),s.assign(n,{contents:r,filesize:r.byteLength,type:"String"})):s.blob(r)&&r.size>t?s.assign(n,{contents:s.u8(await r.arrayBuffer()),filetype:r.type,filesize:r.size,filename:r.name,type:"File"}):r.byteLength&&r.byteLength>t&&(r=s.u8(r),s.assign(n,{contents:r,filesize:r.byteLength,type:s.N(11)})),n.contents&&(e.type||n.type||(n.type=s.N(11)),e.contents?(delete e.contents,s.assign(e,n)):e=n),e.contents&&["version","password"].forEach((t=>!e[t]&&delete e[t])),e}async dbSelect(e,t){let s=this;s.T;s.I.str(e)&&(e={store:e}),e.store instanceof s.StoreDatabase&&(e.store=e.store.table);let r=e.store,n=await s.dbLoad(e);t=t?"readonly":"readwrite",r||(r=n.objectStoreNames[0]);let a=n.transaction([r],t);return a.onerror=e=>{throw e.preventDefault(),a.error},a.objectStore(r)}async dbGetItem(e){let t=this.I;t.str(e)&&(e={name:e});let s=e.name,r=await this.dbSelect(e,!0);if(s)return t.Async((e=>{r.get(s).onsuccess=t=>e(t.target.result)}))}async dbPutItem(e){let t=this.I,{data:s,name:r}=e||{},n=await this.dbSelect(e);return t.Async((e=>{n.put(s,r).onsuccess=t=>e(t.target.result)}))}async dbRemoveItem(e){let t=this.I;t.str(e)&&(e={name:e});let s=e.name,r=await this.dbSelect(e);if(s)return t.Async(((e,t)=>{r.delete(s).onsuccess=t=>e(`delete:${s}`)}))}async dbGetAll(e){let t=this,s=t.I,r=t.T,n=await t.dbSelect(e,!0);return s.Async((a=>{let i={};e.index&&(n=n.index(e.index)),n.openCursor(e.Range).onsuccess=n=>{let o=n.target.result;if(o){if(e.only&&r.part&&r.maxsize&&s.u8buf(o.value.contents)&&o.value.filesize>r.maxsize){let e=o.primaryKey.split(r.part),n=e[0],a=e[1]||0;if(i[n])i[n].contents.set(o.value.contents,a*r.maxsize);else{let e=s.u8(o.value.filesize);e.set(o.value.contents,a*r.maxsize),delete o.value.contents,i[n]=t.assign(o.value,{contents:e})}}else i[o.primaryKey]=o.value;o.continue()}else a(i)}}))}async dbGetKeys(e){let t=this,s=t.I;s.str(e)&&(e={dbName:e});let r=await t.dbSelect(e,!0);return s.Async((n=>e.index&&r.indexNames.contains(e.index)?r.index(e.index).getAllKeys(e.Range).onsuccess=r=>{n(e.only?s.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}:r.getAllKeys().onsuccess=r=>{n(e.only?s.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}))}async dbGetCursor(e){let t=this,s=t.I;s.str(e)&&(e={index:e});let r=e.index,n=t.T,a=await t.dbSelect(e,!0),i=a.indexNames.length;if(i&&!r)r=a.indexNames[0];else if(!i)return t.dbGetKeys(e);return s.Async((t=>{let s={};a.index(r).openKeyCursor(e.Range).onsuccess=a=>{let i=a.target.result;i?((!e.only||n.part&&!i.primaryKey.includes(n.part))&&(s[i.primaryKey]=Object.fromEntries([[r,i.key]])),i.continue()):t(s)}}))}async dbRemoveTable(e,t){let s=this,r=s.I;return r.str(e)&&(e=[e]),await r.Async(e.map((async e=>{(await s.dbSelect({store:e,dbName:t})).clear()})))}dbClose(e){let t=this,s=t.I.str(e),r=s?t.DataBase[e]:e;if(r){let n=r.version+1;return r.close(),s&&delete t.DataBase[e],n}}async deleteDatabase(e,t){let s=this;if(t=t||s.dbname,!e)return s.idb.deleteDatabase(t||s.dbname);let r=s.DataBase[t]||await s.dbOpen(t);if(r&&!s.dbCheckTable(e,r))return"ok";let n=s.dbClose(r);return delete s.DataBase[t],await s.dbOpen(t,null,n,{upgradeneeded(t){t.deleteObjectStore(e)},success(e,t){s.close(e),t("ok")}})}get dbname(){return this.T.DB_NAME}constructor(e){let t=this,s=e.I;e.Libzip||(e.Libzip=t.zipsrc),s.defines(t,{I:s,T:e},1),t.callaction=e.callaction,t.bindaction=e.bindaction}StoreDatabase=class{constructor(e,t,s){s=s||e.DB_NAME;let r=e.I,n=`var I = T.I;I.defines(S, { T,I,table:'${t}',dbName:'${s}' }, 1,1);`;r.toArr(["getItem","setItem","removeItem","getAllData","getContent","setContent","getAllKeys","getAllCursor","clearDB","deleteDB"],(e=>{n+=`I.define(S, '${e}', {value(){let arr = ['${t}'].concat(I.toArr(arguments));return T.${e}.apply(T, arr);}});`})),new Function("S","T",n)(this,e)}setName(e){let t=this.I;return e&&"boolean"!=typeof e?t.str(e)&&(e={dbName:e}):e={dbName:this.dbName},e}get(e,t,s){return s=this.setName(s),this.getItem(e,t,s)}put(e,t){return this.setItem(e,t,this.dbName)}remove(e,t){return t=this.setName(t),this.removeItem(e,t)}data(e,t,s){return this.getData(e,t,s)}getData(e,t,s){return s=this.setName(s),this.getContent(e,t,s)}setData(e,t,s){return this.setContent(e,t,s,this.dbName)}keys(e){return this.getAllKeys(this.dbName,e||{})}cursor(e,t,s){return s=this.setName(s),this.getAllCursor(e,t,s)}all(e,t){return t=this.setName(t),this.getAllData(e,t)}clear(){return this.clearDB(this.dbName)}delete(){return this.deleteDB(this.dbName)}async getBatch(e,t){let s=await this.I.Async(e.map((async e=>await this.get(e))));return t?t(s):s}};Nttr=class{constructor(e,t){let s=(t=t||Nenge).I;if(s.defines(this,{T:t,I:s},1,1),s.str(e)&&(e=t.$(e)),s.elm(e)?(this.obj=e,e.Nttr?this.resetNttr(e.Nttr):this.obj=e):this.resetNttr(e),!this.obj)throw"Nttr error";s.defines(this.obj,{Nttr:this},1,!0)}resetNttr(e){let t=this,s=t.I;e instanceof this.constructor&&(t.eventList=s.assign({},e.eventList),t.obj=e.obj,O[18].deleteProperty(e.obj,"Nttr"))}eventList={};get cList(){return this.obj.classList}get active(){return this.contains("active")}set active(e){this.cList[e?"add":"remove"]("active")}get show(){return this.contains("show")}set show(e){this.cList[e?"add":"remove"]("show")}get hidden(){return this.obj.hidden}set hidden(e){return this.obj.hidden=e,this}get css(){return this.obj.style.cssText}set css(e){this.obj.style.cssText=e}get style(){return this.I.toObj(this.obj.style)}set style(e){if(this.I.str(e))return this.css=e;this.I.assign(this.obj.style,e)}html(e){return null!=e?(this.obj.innerHTML=e,this):this.obj.innerHTML}$(e){return this.obj.querySelector(e)}$$(e){return this.obj.querySelectorAll(e)}contains(e){return this.cList.contains(e)}get attrs(){return this.T.I.toObj(this.obj.attributes)}set attrs(e){this.T.I.toArr(e,(e=>this.setAttr(e[0],e[1])))}attr(e,t){return void 0===t?this.obj.getAttribute(e):null==t?this.obj.removeAttribute(e):(this.obj.setAttribute(e,t),this)}getAttrs(e){return e?this.attr(e):this.attrs}setAttrs(e,t){return t||"string"==typeof e?(this.attr(e,t),this):this.attrs=e}addClass(e){return this.cList.add(e),this}removeClass(e){return this.cList.remove(e),this}addChild(e){return this.obj.appendChild(e),this}appendTo(e){return(e=e||document.body).appendChild(this.obj),this}on(e,t,s){let r=this;return r.eventList[e]||(r.eventList[e]=[]),r.eventList[e].push({func:t,opt:s}),r.T.on(r.obj,e,t,s),r}un(e,t){let s=this;if(s.eventList[e]){let r=[];s.eventList[e].forEach((n=>{let{func:a,opt:i}=n;t&&t!=a?r.push(n):s.removeEvent(e,a,i)})),s.eventList[e]=[],r.length>0&&(s.eventList[e]=r)}else e||s.I.toArr(s.eventList,(e=>{e[1].forEach((t=>{let{func:r,opt:n}=t;s.removeEvent(e[0],r,n)})),delete s.eventList[e[0]]}));return s}once(e,t,s){return this.T.once(this.obj,e,t,s),N}removeEvent(e,t,s){return this.T.un(this.obj,e,t,s)}triger(e,t){let s=this,r=s.T;r.I;s.eventList[e]?s.eventList[e].forEach((e=>e.func.call(s.obj,t))):r.triger(s.obj,e,t)}bind(e,t){let s=this,r=s.T,n=s.I;t||(t=s.I.mobile?"touchend":"click"),n.toArr(e,(e=>r.on(s.$(e[0],this.obj),t,e[1])))}click(e,t,s){let r=this,n=r.I;return t||(t=n.mobile?"touchend":"click"),n.func(e)?(r.un(t),r.on(t,e,s||!1)):r.triger(t,e),r}getBoundingClientRect(){return this.obj.getBoundingClientRect()}remove(){this.un(),this.obj.remove()}get children(){return this.I.toArr(this.obj.children)}get parentNode(){return this.obj.parentNode}get rect(){return this.getBoundingClientRect()}};nWindow=class extends this.Nttr{action={close(){this.hidden=!0},show(){this.hidden=!1},installWindow(){this.addClass("ajaxWindow"),this.html('<div class="container">\n                    <div class="a-header">\n                        <div class="title"><span class="loading">&#61712;</span></div>\n                        <div class="menu">\n                            <button type="button" class="close" data-naction="close">&#61453;</button>\n                        </div>\n                    </div>\n                    <div class="a-body">\n                        <p class="loading">&#61473;</p>\n                    </div>\n                    <div class="a-footer" hidden></div>\n                </div>')},installHeaderEvent(){let e,t=this,s=t.T;e=s.I.mobile?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup","mouseout"],e.forEach((e=>s.on(t.$(".a-header"),e,(e=>{if(("mousedown"==e.type||"touchstart"==e.type)&&e){let{clientX:s,clientY:r}="mousedown"==e.type?e:e.touches[0];t.HeaderPointPos={clientX:s,clientY:r}}if("mouseup"!=e.type&&"mouseout"!=e.type&&"touchend"!=e.type||(t.HeaderPointPos=!1),("mousemove"==e.type||"touchmove"==e.type)&&t.HeaderPointPos){let{clientX:s,clientY:r}="mousemove"==e.type?e:e.touches[0],n=t.$(".container"),a=n.getBoundingClientRect(),i="",o="",l=t.HeaderPointPos.clientX-s,c=t.HeaderPointPos.clientY-r;o=a.top-c,o="top:"+o+"px;bottom:unset;",l=l||0,i=a.left-l,(i<10||i&&a.width+i+15>window.innerWidth)&&(i=parseFloat(n.style.left),i<=10?i=10:i+10>window.innerWidth&&(i-=10)),i="left:"+i+"px;right:unset;width:"+a.width+"px;",t.$(".container").style.cssText=i+o,t.HeaderPointPos={clientX:s,clientY:r}}}))),{passive:!1})},installEvent(){let e=this,t=e.T,s=e.obj;t.on(s,"pointerup",(r=>{let n=r.target;if(n==s)return e.callaction("close",n,r);let a=n&&t.attr(n,"data-naction");return a?(t.stopEvent(r),e.callaction(a,n,r)):void 0}))},initConfig(e){let t=this,s=t.T;e&&s.I.toArr(e,(e=>{"function"==typeof t[e[0]]&&t[e[0]](e[1])}))}};constructor(e,t,s){if(super(e,t),!this.obj)return;const r=this;r.callaction=t.callaction,r.$(".container")||r.callaction("installWindow"),r.callaction("installEvent"),r.callaction("installHeaderEvent"),r.callaction("initConfig",s)}title(e){this.$(".a-header .title").innerHTML=e}body(e){this.$(".a-body").innerHTML=e}footer(e){this.$(".a-footer").innerHTML=e}hiddenFooter(){this.$(".a-footer").hidden=!0}hiddenPath(e,t){this.$(".a-"+e).hidden=t||!1}}}(this)},Nttr=e=>{let t=Nenge,s=t.$(e);return e instanceof t.F.Nttr?e:s?s.Nttr?s.Nttr:new t.F.Nttr(s,t):void 0},nWindow=(e,t)=>{let s,r=Nenge;return e?(s=r.$(e),!s||s.Nttr instanceof r.F.nWindow||new r.F.nWindow(s,r,t),s&&s.Nttr):new r.nWindow(r.$ce("div"),r,t).appendTo()};Nenge.triger(document,"NengeLoad",Nenge);