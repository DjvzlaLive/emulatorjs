const Nenge=new class{version=1;DB_NAME="XBBS";DB_STORE_MAP={"data-js":{timestamp:!1},"data-file":{},avatar:{timestamp:!1},forumsicon:{timestamp:!1},document:{timestamp:!1}};LibStore="data-js";Encoding="GBK";maxsize=104857600;part="-part-";lang={};action={};StoreData={};JSpath=document.currentScript&&document.currentScript.src.split("/").slice(0,-1).join("/")+"/";fps=59;constructor(){const e=this,t=e.I;e.language=navigator.language;let s=e.language.split("-");s="zh"==s[0]?"TW"==s[1]?"zh-hant":"zh-hans":s[0],e.i18nName=s,e.on(window,"error",(e=>{t.mobile&&alert(e.message)})),e.triger(document,"NengeStart",{detail:e}),e.docload((t=>e.triger(document,"NengeReady",{detail:e})))}get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return Number(this.rand.toString().slice(2))}async getItem(e,t,s,r={}){if(!t)return await this.getAllData(e,1,r);let n=this,a=n.F,i=n.maxsize,o=n.part,l=await a.dbGetItem(n.I.assign({store:e,name:t},r)),c=t.split(o)[0];if(l){if(s&&l.version&&l.version!=s)l=void 0;else if(l.contents&&l.filesize&&l.filesize>i){let s=new n.I.O[11](l.filesize);await n.I.Async(Array(Math.ceil(l.filesize/i)).fill(c).map((async(c,d)=>{let u=c;if(d>0&&(u+=o+d),u==t)s.set(l.contents,d*i);else{let t=await a.dbGetItem(n.I.assign(r,{store:e,name:u}));t?s.set(t.contents,d*i):n.Err("lost file")}}))),l.contents=s}l&&l.contents&&n.I.u8obj(l.contents)&&("unpack"==l.type?(l.password&&(r.password=l.password),l.contents=await a.unFile(l.contents,r)):"File"==l.type?l.contents=new File([l.contents],l.filename||c,{type:l.filetype||a.gettype(l.filename||c)}):"String"==l.type&&(l.contents=(new TextDecoder).decode(l.contents)))}return l}async setItem(e,t,s,r){let n=this,a=n.F,i=n.I,o=n.maxsize,l=n.part;if((s=await a.contentsSize(s,o)).contents&&s.contents.byteLength>o){let n=s.contents.byteLength,c={};return i.toArr(s,(e=>{"contents"!=e[0]&&(c[e[0]]=e[1])})),await i.Async(Array(Math.ceil(n/o)).fill(t).map((async(t,d)=>{let u=t,p=d*o;return d>0&&(u+=l+d),await a.dbPutItem({store:e,data:i.assign({contents:new i.O[11](s.contents.subarray(p,n-p>=o?p+o:n))},c),name:u,dbName:r})})))}return await a.dbPutItem({store:e,data:s,name:t,dbName:r})}async removeItem(e,t,s){let{clear:r,dbName:n}=s||{},a=this,i=a.I,o=a.F;if(r){let r=await o.dbGetItem(i.assign({store:e,name:t},s));if(r&&r.filesize)return await i.Async(Array(Math.ceil(r.filesize/a.maxsize)).fill(t.split(a.part)[0]).map((async(t,s)=>{let r=t;return s>0&&(r+=a.part+s),await o.dbRemoveItem({store:e,name:r})+"\n"})))}return await o.dbRemoveItem({store:e,name:t,dbName:n})}async getAllData(e,t,s){return e?await this.F.dbGetAll(this.I.assign({store:e,only:t},s)):{}}async getContent(e,t,s,r){let n=await this.getItem(e,t,s,r);return n&&n.contents||n}async setContent(e,t,s,r,n){let a=this.I.assign(r||{},{contents:s,timestamp:this.date});return await this.setItem(e,t,a,n)}async getAllKeys(e,t,s){return await this.F.dbGetKeys(this.I.assign({store:e,dbName:t},s||{}))}async getAllCursor(e,t,s,r){return await this.F.dbGetCursor(this.I.assign({store:e,index:t,only:s},r))}async clearDB(e,t){let s=this.F;if(e)return s.I.str(e)&&(e=[e]),await s.dbRemoveTable(e,t)}async deleteDB(e,t){let s=this.F;return s.I.str(e)&&(e=[e]),await s.deleteDatabase(e,t)}getStore(e,t){if(!e)return;let s=this;if(e instanceof s.F.StoreDatabase)return e;t=t||s.DB_NAME,s.StoreData[t]||(s.StoreData[t]={});let r=s.F,n=s.StoreData[t];return n[e]||(n[e]=new r.StoreDatabase(s,e,t)),n[e]}async FetchItem(e){let t=this,s=t.F,r=t.I;e&&!r.str(e)||(e={url:e||"/"});let n,a,i="arrayBuffer",o=s.getname(e.url),l=e.key||o||"index.php",c=e.key==s.LibKey?l+o:l,d=e.version,u={},p=e.store&&t.getStore(e.store),h=(t,n)=>s.unFile(t,r.assign(e,{password:n})),m=async e=>(e&&e.contents&&("unpack"==e.type?(e=await h(e.contents,e.password)).password&&delete e.password:e=e.contents),b(e),e),b=t=>t&&e.success&&e.success(t,u);if(e.filename||(e.filename=o),e.onLine&&(e.unset=navigator.onLine),p&&(n=await p.get(c,d,e),n&&!e.unset&&!e.checksize))return m(n);if(a=await s.FetchStart(e).catch((t=>e.error&&e.error(t.message))),!a)return m(n);u=s.FetchHeader(a,e),r.exends(u,a,["url","status","statusText"]);let g=u.password||e.password||void 0;if(200!=a.status)return a.body&&(a.body.cancel(),e.error&&e.error(a.statusText,u)),"head"==e.type&&b(u),m(n);if(n&&n.filesize&&u.byteLength>0){if(n.filesize==u.byteLength)return a.body.cancel(),m(n);n=null}else if("head"==e.type)return a.body.cancel(),b(u);let y=r.func(e.process)?await s.StreamResponse(a,e,u):a;e.unpack&&(e.type=i),e.type=e.type||i;let f=await y[e.type](),w=u.type,v=u.byteLength||0,L=u["content-type"];if(e.type==i&&r.arrBuff(f)&&(f=new r.O[11](f),e.Filter&&(f=e.Filter(f)),w=r.N(11),v=f.byteLength,e.autounpack&&v<.3*t.maxsize&&(e.unpack=!0)),e.dataOption=e.dataOption||{},p&&e.unpack&&l===c&&v>t.maxsize&&(w="unpack",await p.put(c,t.I.assign({contents:f,timestamp:new Date,filesize:v,filetype:L,version:d,type:w,password:g},e.dataOption)),p=null),e.unpack&&r.u8obj(f)&&(f=await h(f,g),f.byteLength||(f.password&&(g=f.password,delete f.password),w="datalist")),p&&l!==c){if(r.u8obj(f))f=s.getFileText(f,e.decode,e.mime||u["content-type"]||s.gettype(""),o),w="File";else if(r.str(f))w=u["content-type"]||"String";else if("datalist"==w){let n;await r.Async(r.toArr(f).map((async a=>{let[i,o]=a,l=s.getname(i),c=s.gettype(l),d=s.getFileText(o,e.decode,c,l);return p.put(e.key+l,r.assign({contents:d,timestamp:t.date,filesize:o.byteLength,version:t.version,filetype:c,type:r.blob(d)?"File":"String"},e.dataOption)),e.filename==l&&(n=d),!0}))),n&&(f=n),n=null,p=null}}else e.decode&&(f=s.getFileText(f,e.decode,w),r.str(f)&&(w="String"));return p&&await p.put(c,r.assign({contents:f,filesize:v,filetype:L,version:d,type:w,password:g,timestamp:t.date},e.dataOption)),e.success&&e.success(f,u),f}ajax(e){let t=this,s=t.I;t.F;return s.str(e)&&(e={url:e}),s.Async((r=>{const n=new XMLHttpRequest(e.paramsDictionary);t.on(n,"error",(t=>{e.error&&e.error("net::ERR_FAILED"),r(null)})),t.on(n,"readystatechange",(t=>{switch(n.readyState){case n.LOADING:case n.OPENED:case n.UNSENT:break;case n.HEADERS_RECEIVED:if(s.defines(n,{headers:s.toObj((n.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",n.status],["statusText",n.statusText],["url",o]]))},1,1),"head"==e.type)return n.abort(),e.success&&e.success(n.headers),void r(n.headers);break;case n.DONE:200==n.status?(e.success&&e.success(n.response,n.headers,n),r(n.response)):n.status>0&&(e.error&&e.error(n.statusText,n.headers,n),r(null));break}})),e.process&&t.on(n,"progress",(t=>e.process(Math.ceil(100*t.loaded/t.total)+"%",t.total,t.loaded,0,n))),e.postProcess&&t.on(n.upload,"progress",(t=>e.postProcess(Math.ceil(100*t.loaded/t.total)+"%",t.total,t.loaded,t)));let a=["abort","load","loadend","loadstart","progress","readystatechange","timeout"];a.forEach((s=>e[s]&&t.on(n,s,(t=>e[s](t,n))))),n.upload&&e.upload&&a.forEach((s=>e.upload[s]&&t.on(n.upload,s,(t=>e.upload[s](t,n)))));let i,o,l=e.type||"";e.get=s.assign({inajax:t.time},e.get||{}),o=s.get(e.url,e.get),e.post&&(i=s.post(e.post)),e.overType&&n.overrideMimeType(e.overType),"head"!=l&&(n.responseType=l),n.open(i?"POST":"GET",o),n.send(i)}))}runaction(e,t){let s=this;if(s.action)return s.action[e]instanceof Function?void 0===t||null==t?s.action[e].call(s):"string"!=typeof t&&t.length?s.action[e].apply(s,t||[]):s.action[e].call(s,t):void 0}callaction(e){let t=this;if(!t.action||!e)return;let s=Array.from(arguments),r=t.action[s.shift()];return r&&r instanceof Function?r.apply(t,s):void 0}bindaction(e){let t=this;if(t.action&&e&&t.action[e])return t.action[e].bind(t)}addJS(e,t,s,r){let n=this,a=n.F;if(n.I.blob(e)&&(r=a.getKeyName(e.name),"text/css"==e.type&&(s=!0)),r&&n.$("#link_"+r))return;let i=!1,o=n.$ce(s?"link":"script"),l=t=>{/^(blob:)?https?:\/\//.test(e)||/(\.js$|\.css$)/.test(e)||(i=!0,e=a.URL(e,a.gettype(s?"css":"js"))),s?(o.type=a.gettype("css"),o.href=e,o.rel="stylesheet"):(o.type=a.gettype("js"),o.src=e),r&&o.setAttribute("id","link_"+r),o.onload=r=>{t&&t(r),i&&a.removeURL(e),e=null,s||o.remove()},document[s?"head":"body"].appendChild(o)};return t?(l(t),o):n.I.Async(((e,t)=>l(e)))}async loadScript(e,t,s,r){t=t||{};let n=this,a=n.F;t.url=a.getpath(e),s?t.type="text":(t.store||(t.store=n.LibStore),t.key||(t.key=a.LibKey)),t.version=t.version||n.version;let i=await n.FetchItem(t);return s?i:await n.addJS(i)}async getScript(e,t){return this.loadScript(e,t,!0)}async addScript(e,t){return await T.addJS(await T.getScript(e,t))}async loadLibjs(e,t){let s=this.F;return await this.addJS(await s.getLibjs(e,t),null,"css"==s.getExt(e))}unFile(e,t,s){return this.F.unFile(e,this.I.assign({process:t},s||{}))}I=new class{O=[Array,Object,HTMLFormElement,DOMStringMap,FormData,NamedNodeMap,Function,Blob,File,Promise,URLSearchParams,Uint8Array,HTMLFormElement,Element,CSSStyleDeclaration,String,void 0,null,Reflect,ArrayBuffer,Boolean,Headers];N(e){return this.O[e].name}assign(){return this.O[1].assign.apply(null,arguments)}exends(e,t,s){return s?this.toArr(s,(s=>e[s]=t[s])):e=this.assign(e,t),e}Async(e,t){return this.array(e)?this.O[9].all(e):new this.O[9](e,t)}formdata=e=>new this.O[4](e||void 0);formget(e){return new this.O[10](e)}get mobile(){return"ontouchend"in document}post(e){let t=this,s=t.T,r=t.postobj(e)?e:t.formdata(t.formelm(e)?e:t.str(e)?s.$(e):void 0);return t.objArr(e)&&t.toArr(e,(e=>r.append(e[0],e[1]))),r}get(e,t){let s=this,r="",n="",a=e.split("?");a[1]&&(r=s.formget(a[1])),t&&(n=s.formget(t));let i=s.formget(r+"&"+n).toString().replace(/^(.+?)=&/,"$1&");return a[0]+(i?"?"+i:"")}toObj(e){let t=this,s=t.O;return t.objArr(e)?e:s[1].fromEntries(t.toArr(e))}toArr(e,t){if(!e)return[];let s,r=this,n=r.O;return r.DOMmap(e)&&(e=n[1].assign({},e)),(r.postobj(e)||r.header(e))&&(s={},e.forEach(((e,t)=>{s[t]?(r.array(s[t])||(s[t]=[s[t]]),s[t].push(e)):s[t]=e})),e=n[1].entries(s)),r.nodemap(e)&&(e=n[0].from(e).map((e=>[e.nodeName,e.nodeValue]))),s=r.array(e)?e:e.length?n[0].from(e):n[1].entries(e),r.func(t)?s.forEach(t):s}define(e,t,s,r,n){let a=!!n;return this.O[1].defineProperty(e,t,r?{get:()=>s,configurable:a}:s),e}defines(e,t,s,r){return s?this.toArr(t,(t=>this.define(e,t[0],t[1],1,r))):this.O[1].defineProperties(e,t),e}textdecode(e,t){return new TextDecoder(t||"utf8").decode(e)}Json(e){let t=this,s=t.O;return t.u8obj(e)&&(e=t.textdecode(e)),"string"==typeof e?new s[6]("return "+e)():e}toJson(e){return JSON.stringify(this.Json(e))}constructor(e){let t=this,s=t.O,r="var O = I.O;";t.define(t,"T",{get:()=>e}),s[1].entries({array:0,obj:1,objArr:1,DOMmap:3,postobj:4,nodemap:5,blob:7,file:8,await:9,getobj:10,elm:13,func:6,u8obj:11,formelm:12,styleobj:14,str:15,undefined:17,arrBuff:19,bool:20,header:21}).forEach((e=>{r+=`I.define(I,'${e[0]}',{value(obj){`+(17==e[1]?`return obj ==  O[${e[1]}];`:["objArr","str"].includes(e[0])?`return obj!=O[16]&&obj!=O[17]&&obj.constructor.name == I.N(${e[1]});`:`return obj instanceof O[${e[1]}];`)+"}});"})),new s[6]("I",r)(t)}}(this);F=new class{Libjs={};LibKey="script-";async StreamResponse(e,t,s){let r=e=>Number(e),n=r(s["content-length"]||0),a=t.downtext?t.downtext:"",i=0,o={done:!1,value:!1},l=e.body.getReader();return new Response(new ReadableStream({async start(e){for(;!o.done;){let s=0,c="";o.value&&(s=r(o.value.length),i+=s,e.enqueue(o.value)),c=n&&i<n?a+Math.floor(i/n*100)+"%":a+Math.floor(10*i/1024)/10+"KB",t.process((t.filename?t.filename+" ":"")+c,n,i,s),o=await l.read()}e.close()}}))}FetchHeader(e,t){let s=this.I,r=s.toObj(e.headers)||{};return(r["content-type"]||this.gettype(t.url.split("/").pop()||"html")).split(";").forEach(((e,t)=>{if(e=e.trim().toLowerCase(),0==t)r["content-type"]=e;else if(-1!=e.search(/=/)){let t=e.split("=");r[t[0].trim()]=t[1].trim()}})),s.assign(r,{byteLength:Number(r["content-length"])||0,password:r.password||r["content-password"],type:r.type||r["content-type"].split("/")[1].split("+")[0]})}async FetchStart(e){let t=this.I,{url:s,get:r,post:n}=e||{},a={};if(s=t.get(e.url,r),a.headers={},["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"].forEach((t=>{null!=e[t]&&(a[t]=e[t])})),e.json)a.body=JSON.stringify(e.json),delete e.json,a.headers.Accept="application/json",a.method="POST";else if(n){a.method="POST";let s=(a.headers.accept||a.headers.Accept||"").toLowerCase();/(\+|\/)json/.test(s)?a.body=t.toJson(n):e.accept?(a.headers.Accept=e.accept,a.body=n):a.body=t.post(n)}return fetch(s,a)}THEN=e=>this.I.Async(e);zipJs="zip.min.js";async ZipCreate(e,t){let s=this.T;return window.zip||await s.loadScript(this.zipJs,{process:t}),new zip.ZipWriter(new zip.Uint8ArrayWriter,{password:e})}async ZipAddFile(e,t,s,r,n){let a=this.I;return s||(s=await this.ZipCreate(t)),a.file(e)?await s.add(e.name,new zip.BlobReader(e),r):await a.Async(a.toArr(e).map((async e=>await s.add(e.name,new zip.BlobReader(e),r)))),await s.close(n)}mime_preg={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};CheckExt(e){let t=this.I,s=e.slice(0,16),r=this.bindaction("textext"),n=t.blob(s)?s.arrayBuffer():t.str(s)?(new TextEncoder).encode(s):s;return t.await(n)?t.Async((async e=>e(r(await n)))):r(n)}action={textext(e){let t=this.I,s=t.toArr(t.arrBuff(e)?new t.O[11](e):e).map((e=>e.toString(16).padStart(2,0).toLocaleUpperCase())).join(""),r=t.toArr(this.mime_preg).filter((e=>e[1].test(s)));return r[0]?r[0][0]:""},async rar(e,t,s){let r,n=this,a=n.I;a.blob(e)&&(!t.filename&&e.name&&(t.filename=e.name),e=new a.O[11](await e.arrayBuffer())),s=s||"libunrar.min.zip",n.Libjs[s]||await n.getLibjs(s,r);let i,o=n.Libjs[s],l=new Worker(o);return t.process&&(i=t.filename?n.T.getLang("Decompress:"):n.T.getLang("Decompress:")+i+"=&gt;",r=e=>t.process(i+(e.file?n.getname(e.file):t.filename||"")+" "+Math.floor(Number(e.current)/Number(e.total)*100)+"%",e.total,e.current)),a.Async((s=>{let a={};l.onmessage=e=>{let i=e.data,o=i.t;if(1===o)s(a),e.target.terminate();else if(2===o)a[i.file]=i.data;else if(4===o&&i.total>0&&i.total>=i.current)r&&r(i);else if(-1==o){let r=prompt(n.T.getLang(i.message),t.password||"");if(!r)return s(a),e.target.terminate();t.unpack&&(a.password=r),t.password=r,l.postMessage({password:r})}},l.onerror=t=>{s(e),l.terminate()},l.postMessage({contents:e,password:"password"})}))},"7z":async function(e,t){return this.callaction("rar",e,t,"extract7z.zip")},async zip(e,t={}){let s=this,r=s.T;if(r.Libzip!=s.zipJs)return this.callaction("rar",e,t,r.Libzip);await s.callaction("loadZip",t.process);let{process:n,password:a,filename:i}=t,o=s.I,l=new zip.ZipReader(o.blob(e)?new zip.BlobReader(e):new zip.Uint8ArrayReader(e)),c=await l.getEntries({filenameEncoding:r.Encoding}),d=!1;if(c.length>0){let e,t={},r={};return e=i?s.T.getLang("Decompress:")+e+"=&gt;":s.T.getLang("Decompress:"),n&&(r.onprogress=(t,s)=>t&&s&&t<=s&&n(e+entry.filename+":"+Math.ceil(100*t/s)+"%")),await o.Async(c.map((async e=>{if(!e.directory){if(e.encrypted)if(r.password=a,d)t[e.filename]=await e.getData(new zip.Uint8ArrayWriter,r);else for(;d;){r.password||(r.password=window.prompt("need a password",r.password||""));try{t[e.filename]=await e.getData(new zip.Uint8ArrayWriter,r),t.password=r.password,d=!0}catch(e){r.password=""}}else t[e.filename]=await e.getData(new zip.Uint8ArrayWriter,r);return!0}}))),l.close(),delete s.ZipPassword,t}return o.blob(e)?new o.O[11](e.arrayBuffer()):e},loadZip(e){let t=this,s=t.T;if(!window.zip&&!t.Libjs[s.Libzip])return window.zip||s.Libzip!=t.zipJs?t.Libjs[s.Libzip]?void 0:t.getLibjs(s.Libzip,e):s.loadScript(t.zipJs,{process:e})}};async unFile(e,t={}){let s=this,r=s.I;r.await(e)&&(e=await e),r.array(e)&&(e=new r.O[11](e));let n=await s.CheckExt(e);return!s.action[n]||t.PassExt&&t.PassExt.includes(zip)?(r.blob(e)&&(e=new r.O[11](await e.arrayBuffer())),e):await s.callaction(n,e,t)}async getLibjs(e,t){let s=this,r=s.T,n=s.I,a=s.getname(e),i=a.replace(/\.zip$/,".js");if(s.Libjs[a])return s.Libjs[a];if(s.Libjs[i])return s.Libjs[i];let o=await r.getStore(r.LibStore).data(s.LibKey+i,r.version);return o||(/\.zip$/.test(a)&&await s.callaction("loadZip",t),o=await r.FetchItem({url:s.getpath(e)+"?"+r.time,store:r.LibStore,key:s.LibKey,unpack:!0,filename:i,process:t})),o&&(n.objArr(o)?s.I.toArr(o,(e=>s.Libjs[e[0]]=e[1]&&s.URL(e[1]))):s.Libjs[a]=s.URL(o)),o=null,s.Libjs[a]}getname(e){return(e||"").split("/").pop().split("?")[0].split("#")[0]}getpath(e){let t=this.T;t.I;return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:)/.test(e)?e:t.JSpath+e}getFileText(e,t,s,r){let n=this,a=n.T.I;if(r&&!t||!/(text|javascript)/.test(s))return new File([e],r,{type:s});if(!t)return e;if("datalist"==s)a.toArr(e,(s=>{/(text|javascript)/.test(n.gettype(s[0]))&&(e[s[0]]=t(s[1]))}));else if(a.u8obj(e))return t(e);return e}getExt(e){return this.getname(e).split(".").pop().toLowerCase()}getKeyName(e){let t=this.getname(e).split(".");return t.pop(),t.join(".")}gettype(e){let t=this;return(e=t.getExt(e))&&!t.mime_list&&(t.mime_list={},t.I.toArr(t.mime_map,(e=>e[1].forEach((s=>t.mime_list[s]=e[0]+(e[0].includes("/")?"":"/"+s)))))),t.mime_list[e]||"application/octet-stream"}mime_map={"text/javascript":["js"],"text/css":["css","style"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml","svg"],image:["jpg","jpeg","png","gif","webp"],application:["pdf"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};checkBuffer(e,t){let s=this.I.toArr(e.slice(0,8)).map((e=>e.toString(16).padStart(2,0).toLocaleUpperCase())).join("");if(s){let e=this.I.toArr(this.mime_preg).filter((e=>e[1].test(s)))[0];if(e)return e[0]}return t||!1}URL(e,t){let s=this,r=s.I;if(r.u8obj(e))t||(t=s.gettype(s.CheckExt(e)));else if(r.str(e)){if(/^(blob|http)/.test(e)||/^\/?[\w\-_\u4e00-\u9FA5:\/\.\?\^\+ =%&@#~]+$/.test(e))return e;t||(t=s.gettype("js"))}return window.URL.createObjectURL(r.blob(e)?e:new Blob([e],{type:t}))}removeURL(e){return window.URL.revokeObjectURL(e)}download(e,t,s){let r;this.I.blob(e)?(r=this.URL(e),e=e.name||"unknowfile"):r=this.URL(t,s);let n=document.createElement("a");n.href=r,n.download=e,n.click(),n.remove()}StoreList={};get idb(){return window.indexedDB||window.webkitindexedDB}dbSetMap(e){let t=this,s=t.I,r=t.T,n=t.dbMap||{};n&&!n[t.dbname]&&(n[t.dbname]=r.DB_STORE_MAP);let a=e.store;if(a){let r=e.dbName||t.dbname;if(r&&!n[r]&&(n[r]={}),a&&!n[r][a]){n[r][a]={};let t=e.dbIndex;t&&(s.str(t)?n[r][a][t]=!1:s.assign(n[r][a],t))}}return t.dbMap||(t.dbMap=n),n}async dbLoad(e){let t=this,s=(e=e||{}).dbName||t.dbname,r=e.store,n=t.StoreList[s];return r&&t.dbCheckTable(r,n)||!r&&n?n:(e.dbName=s,await t.dbInstall(t.dbSetMap(e)),t.StoreList[s])}async dbInstall(e){let t=this,s=t.I;return await s.Async(s.toArr(e).map((async e=>{let r,[n,a]=e,i=t.StoreList[n];if(i){if(!s.toArr(a).filter((e=>!t.dbCheckTable(e[0],i))).length)return"ok";r=i.version+1,i.close(),delete t.StoreList[n]}let o=Object.keys(a);return t.StoreList[n]=await t.dbOpen(n,a,r,{success:async(e,s)=>t.dbCheckTable(o,e)!=o.length?(r=t.dbClose(e),s(await t.dbOpen(n,a,r))):s(e)}),n})))}async dbOpen(e,t,s,r){let n=this;return n.I.Async(((a,i)=>{let o=n.idb.open(e,s);o.addEventListener("error",(async e=>{i(e)})),o.addEventListener("upgradeneeded",(async e=>{let s=o.result;r&&r.upgradeneeded?await r.upgradeneeded.apply(o,[s]):t&&await n.dbCreateObject(t,s)})),o.addEventListener("success",(async e=>{let t=o.result;if(r&&r.success)return await r.success(t,a);a(t)}))}))}async dbCreateObject(e,t){if(!e||!t)return;let s=this,r=s.I;await r.Async(r.toArr(e).map((async e=>{let[n,a]=e;if(!s.dbCheckTable(n,t)){let e=await t.createObjectStore(n);a&&r.toArr(a,(t=>e.createIndex(t[0],t[1]&&t[1].key||t[0],t[1]&&t[1].options||t[1]||{unique:!1})))}})))}dbCheckTable(e,t,s){return t?(this.I.str(e)&&(e=[e]),e=e?e.filter((e=>t.objectStoreNames.contains(e))):[],s?e:e.length):0}async contentsSize(e,t){let s=this.I;s.await(e)&&(e=await e);let r=e.contents||e,n={};return s.str(r)&&r.length>t?(r=(new TextEncoder).encode(r),s.assign(n,{contents:r,filesize:r.byteLength,type:"String"})):s.blob(r)&&r.size>t?s.assign(n,{contents:new s.O[11](await r.arrayBuffer()),filetype:r.type,filesize:r.size,filename:r.name,type:"File"}):r.byteLength&&r.byteLength>t&&(r.__proto__.constructor!=s.O[11]&&(r=new s.O[11](r.buffer||r)),s.assign(n,{contents:r,filesize:r.byteLength,type:s.N(11)})),n.contents&&(e.type||n.type||(n.type=s.N(11)),e.contents?(delete e.contents,s.assign(e,n)):e=n),e.contents&&["version","password"].forEach((t=>!e[t]&&delete e[t])),e}async dbSelect(e,t){let s=this;s.T;s.I.str(e)&&(e={store:e}),e.store instanceof s.StoreDatabase&&(e.store=e.store.table);let r=e.store,n=await s.dbLoad(e);t=t?"readonly":"readwrite",r||(r=n.objectStoreNames[0]);let a=n.transaction([r],t);return a.onerror=e=>{throw e.preventDefault(),a.error},a.objectStore(r)}async dbGetItem(e){let t=this.I;t.str(e)&&(e={name:e});let s=e.name,r=await this.dbSelect(e,!0);if(s)return t.Async((e=>{r.get(s).onsuccess=t=>e(t.target.result)}))}async dbPutItem(e){let t=this.I,{data:s,name:r}=e||{},n=await this.dbSelect(e);return t.Async((e=>{n.put(s,r).onsuccess=t=>e(t.target.result)}))}async dbRemoveItem(e){let t=this.I;t.str(e)&&(e={name:e});let s=e.name,r=await this.dbSelect(e);if(s)return t.Async(((e,t)=>{r.delete(s).onsuccess=t=>e(`delete:${s}`)}))}async dbGetAll(e){let t=this,s=t.I,r=t.T,n=await t.dbSelect(e,!0);return s.Async((a=>{let i={};e.index&&(n=n.index(e.index)),n.openCursor(e.Range).onsuccess=n=>{let o=n.target.result;if(o){if(e.only&&r.part&&r.maxsize&&s.u8obj(o.value.contents)&&o.value.filesize>r.maxsize){let e=o.primaryKey.split(r.part),n=e[0],a=e[1]||0;if(i[n])i[n].contents.set(o.value.contents,a*r.maxsize);else{let e=new s.O[11](o.value.filesize);e.set(o.value.contents,a*r.maxsize),delete o.value.contents,i[n]=t.assign(o.value,{contents:e})}}else i[o.primaryKey]=o.value;o.continue()}else a(i)}}))}async dbGetKeys(e){let t=this,s=t.I;s.str(e)&&(e={dbName:e});let r=await t.dbSelect(e,!0);return s.Async((n=>e.index&&r.indexNames.contains(e.index)?r.index(e.index).getAllKeys(e.Range).onsuccess=r=>{n(e.only?s.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}:r.getAllKeys().onsuccess=r=>{n(e.only?s.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}))}async dbGetCursor(e){let t=this,s=t.I;s.str(e)&&(e={index:e});let r=e.index,n=t.T,a=await t.dbSelect(e,!0),i=a.indexNames.length;if(i&&!r)r=a.indexNames[0];else if(!i)return t.dbGetKeys(e);return s.Async((t=>{let s={};a.index(r).openKeyCursor(e.Range).onsuccess=a=>{let i=a.target.result;i?((!e.only||n.part&&!i.primaryKey.includes(n.part))&&(s[i.primaryKey]=Object.fromEntries([[r,i.key]])),i.continue()):t(s)}}))}async dbRemoveTable(e,t){let s=this,r=s.I;return r.str(e)&&(e=[e]),await r.Async(e.map((async e=>{(await s.dbSelect({store:e,dbName:t})).clear()})))}dbClose(e){let t=this,s=t.I.str(e),r=s?t.StoreList[e]:e;if(r){let n=r.version+1;return r.close(),s&&delete t.StoreList[e],n}}async deleteDatabase(e,t){let s=this;if(t=t||s.dbname,!e)return s.idb.deleteDatabase(t||s.dbname);let r=s.StoreList[t]||await s.dbOpen(t);if(r&&!s.dbCheckTable(e,r))return"ok";let n=s.dbClose(r);return delete s.StoreList[t],await s.dbOpen(t,null,n,{upgradeneeded(t){t.deleteObjectStore(e)},success(e,t){s.close(e),t("ok")}})}StoreDatabase=class{constructor(e,t,s){s=s||e.DB_NAME;let r=e.I,n=`var I = T.I;I.defines(S, { T,I,table:'${t}',dbName:'${s}' }, 1,1);`;r.toArr(["getItem","setItem","removeItem","getAllData","getContent","setContent","getAllKeys","getAllCursor","clearDB","deleteDB"],(e=>{n+=`I.define(S, '${e}', {value:function(){let arr = ['${t}'].concat(I.toArr(arguments));return T.${e}.apply(T, arr);}});`})),new Function("S","T",n)(this,e)}setName(e){let t=this.I;return e&&"boolean"!=typeof e?t.str(e)&&(e={dbName:e}):e={dbName:this.dbName},e}get(e,t,s){return s=this.setName(s),this.getItem(e,t,s)}put(e,t){return this.setItem(e,t,this.dbName)}remove(e,t){return t=this.setName(t),this.removeItem(e,t)}data(e,t,s){return this.getData(e,t,s)}getData(e,t,s){return s=this.setName(s),this.getContent(e,t,s)}setData(e,t,s){return this.setContent(e,t,s,this.dbName)}keys(e){return this.getAllKeys(this.dbName,e||{})}cursor(e,t,s){return s=this.setName(s),this.getAllCursor(e,t,s)}all(e,t){return t=this.setName(t),this.getAllData(e,t)}clear(){return this.clearDB(this.dbName)}delete(){return this.deleteDB(this.dbName)}async getBatch(e,t){let s=await this.I.Async(e.map((async e=>await this.get(e))));return t?t(s):s}};get dbname(){return this.T.DB_NAME}constructor(e){let t=this,s=e.I;e.Libzip||(e.Libzip=t.zipJs),s.defines(t,{I:s,T:e},1),t.callaction=e.callaction,t.bindaction=e.bindaction}}(this);on(e,t,s,r,n){(e=this.$(e))&&e.addEventListener(t,s,!1===r?{passive:!1}:r,n)}un(e,t,s,r,n){this.$(e).removeEventListener(t,s,!1===r?{passive:!1}:r,n)}once(e,t,s,r){return this.on(e,t,s,{passive:!1,once:!0},r)}docload(e){let t=document;return this.I.Async((s=>{if("loading"==t.readyState)return this.once(t,"DOMContentLoaded",(()=>{e&&e.call(this),s(!0)}));e&&e.call(this),s(!0)}))}$(e,t){let s=this.I,r=t||document;return e?s.str(e)?r.querySelector(e):s.func(e)?this.docload(e):e:void 0}$$(e,t){return(t||document).querySelectorAll(e)}$ce(e){return document.createElement(e)}$ct(e,t){let s=this.$ce(e);return s.innerHTML=t,s}$ca(e,t){let s=this.I,r=this.$ce(e);return t&&s.toArr(t,(e=>{r.setAttribute(e[0],e[1])})),r}$append(e,t){return e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}customElement(e){let t=this;window.customElements.define(e,class extends HTMLElement{constructor(){super(),t.callaction("TAG-"+this.tagName,this,"init")}connectedCallback(){t.callaction("TAG-"+this.tagName,this,"connect")}attributeChangedCallback(e,s,r){t.callaction("TAG-"+this.tagName,this,"attribute",{name:e,oldValue:s,newValue:r})}disconnectedCallback(){t.callaction("TAG-"+this.tagName,this,"disconnect")}})}attr(e,t){if(this.$(e))return this.$(e).getAttribute(t)}docElm(e,t){return(new DOMParser).parseFromString(e,t||"text/html")}HTMLToTxt(e){return this.I.str(e)&&(e=this.docElm(e)),e instanceof Document?e.body.textContent:""}fragment(){return new DocumentFragment}Err(e){return new Error(e)}triger(e,t,s){let r=this;return r.I.str(e)&&(e=r.$(e)),s?s.detail||(s.detail=e):s={},s.hasOwnProperty("cancelable")||(s.cancelable=!0),r.dispatch(e,new CustomEvent(t,s))}dispatch(e,t){return e?e.dispatchEvent(t):t}down(e,t,s){return this.F.download(e,t,s)}stopEvent=e=>{e.preventDefault()};stopProp=e=>{e.preventDefault(),e.stopPropagation()};stopGesture(e){let t=this;["gesturestart","gesturechange","gestureend"].forEach((s=>t.on(e,s,(e=>t.stopEvent(e)))))}async battery(e){const t=await navigator.getBattery();["chargingchange","levelchange","chargingtimechange","dischargingtimechange"].forEach((s=>e.val&&this.on(t,s,(s=>this.callaction(e.val,s,t)))))}getLang(e,t){let s=this.lang&&this.lang[e]||e;return this.lang[e],t&&s&&T.I.toArr(t,(e=>{s=s.replace(new RegExp("/{"+e[0]+"}/","g"),e[1])})),s}THEN(e){return this.I.Async(e)}Nttr=class{constructor(e,t){let s=(t=t||Nenge).I;if(s.defines(this,{T:t,I:s},1,1),s.str(e)&&(e=t.$(e)),s.elm(e)?(this.obj=e,e.Nttr?this.resetNttr(e.Nttr):this.obj=e):this.resetNttr(e),!this.obj)throw"Nttr error";s.defines(this.obj,{Nttr:this},1,!0)}resetNttr(e){let t=this,s=t.I;e instanceof this.constructor&&(t.eventList=s.assign({},e.eventList),t.obj=e.obj,O[18].deleteProperty(e.obj,"Nttr"))}eventList={};get cList(){return this.obj.classList}get active(){return this.contains("active")}set active(e){this.cList[e?"add":"remove"]("active")}get show(){return this.contains("show")}set show(e){this.cList[e?"add":"remove"]("show")}get hidden(){return this.obj.hidden}set hidden(e){return this.obj.hidden=e,this}get css(){return this.obj.style.cssText}set css(e){this.obj.style.cssText=e}get style(){return this.I.toObj(this.obj.style)}set style(e){if(this.I.str(e))return this.css=e;this.I.assign(this.obj.style,e)}html(e){return null!=e?(this.obj.innerHTML=e,this):this.obj.innerHTML}$(e){return this.obj.querySelector(e)}$$(e){return this.obj.querySelectorAll(e)}contains(e){return this.cList.contains(e)}get attrs(){return this.T.I.toObj(this.obj.attributes)}set attrs(e){this.T.I.toArr(e,(e=>this.setAttr(e[0],e[1])))}attr(e,t){return void 0===t?this.obj.getAttribute(e):null==t?this.obj.removeAttribute(e):(this.obj.setAttribute(e,t),this)}getAttrs(e){return e?this.attr(e):this.attrs}setAttrs(e,t){return t||"string"==typeof e?(this.attr(e,t),this):this.attrs=e}addClass(e){return this.cList.add(e),this}removeClass(e){return this.cList.remove(e),this}addChild(e){return this.obj.appendChild(e),this}appendTo(e){return(e=e||document.body).appendChild(this.obj),this}on(e,t,s){let r=this;return r.eventList[e]||(r.eventList[e]=[]),r.eventList[e].push({func:t,opt:s}),r.T.on(r.obj,e,t,s),r}un(e,t){let s=this;if(s.eventList[e]){let r=[];s.eventList[e].forEach((n=>{let{func:a,opt:i}=n;t&&t!=a?r.push(n):s.removeEvent(e,a,i)})),s.eventList[e]=[],r.length>0&&(s.eventList[e]=r)}else e||s.I.toArr(s.eventList,(e=>{e[1].forEach((t=>{let{func:r,opt:n}=t;s.removeEvent(e[0],r,n)})),delete s.eventList[e[0]]}));return s}once(e,t,s){return this.T.once(this.obj,e,t,s),N}removeEvent(e,t,s){return this.T.un(this.obj,e,t,s)}triger(e,t){let s=this,r=this.I.assign({},t||{},{target:s.obj});s.eventList[e]?s.eventList[e].forEach((e=>e.func.call(s.obj,r))):s.T.triger(s.obj,e,r)}dispatch(e){this.obj.dispatchEvent(e)}bind(e,t){let s=this,r=s.T,n=s.I;t||(t=s.I.mobile?"touchend":"click"),n.toArr(e,(e=>r.on(s.$(e[0],this.obj),t,e[1])))}click(e,t,s){let r=this;return t||(t=r.I.mobile?"touchend":"click"),r.I.func(e)?(r.un(t),r.on(t,e,s||!1)):r.triger(t,e),r}getBoundingClientRect(){return this.obj.getBoundingClientRect()}remove(){this.un(),this.obj.remove()}get children(){return this.I.toArr(this.obj.children)}get parentNode(){return this.obj.parentNode}get rect(){return this.getBoundingClientRect()}};nWindow=class extends this.Nttr{action={close(){this.hidden=!0},show(){this.hidden=!1},installWindow(){this.addClass("ajaxWindow"),this.html('<div class="container">\n                    <div class="a-header">\n                        <div class="title"><span class="loading">&#61712;</span></div>\n                        <div class="menu">\n                            <button type="button" class="close" data-naction="close">&#61453;</button>\n                        </div>\n                    </div>\n                    <div class="a-body">\n                        <p class="loading">&#61473;</p>\n                    </div>\n                    <div class="a-footer" hidden></div>\n                </div>')},installHeaderEvent(){let e,t=this,s=t.T;e=s.I.mobile?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup","mouseout"],e.forEach((e=>s.on(t.$(".a-header"),e,(e=>{if(("mousedown"==e.type||"touchstart"==e.type)&&e){let{clientX:s,clientY:r}="mousedown"==e.type?e:e.touches[0];t.HeaderPointPos={clientX:s,clientY:r}}if("mouseup"!=e.type&&"mouseout"!=e.type&&"touchend"!=e.type||(t.HeaderPointPos=!1),("mousemove"==e.type||"touchmove"==e.type)&&t.HeaderPointPos){let{clientX:s,clientY:r}="mousemove"==e.type?e:e.touches[0],n=t.$(".container"),a=n.getBoundingClientRect(),i="",o="",l=t.HeaderPointPos.clientX-s,c=t.HeaderPointPos.clientY-r;o=a.top-c,o="top:"+o+"px;bottom:unset;",l=l||0,i=a.left-l,(i<10||i&&a.width+i+15>window.innerWidth)&&(i=parseFloat(n.style.left),i<=10?i=10:i+10>window.innerWidth&&(i-=10)),i="left:"+i+"px;right:unset;width:"+a.width+"px;",t.$(".container").style.cssText=i+o,t.HeaderPointPos={clientX:s,clientY:r}}}))),{passive:!1})},installEvent(){let e=this,t=e.T,s=e.obj;t.on(s,"pointerup",(r=>{let n=r.target;if(n==s)return e.callaction("close",n,r);let a=n&&t.attr(n,"data-naction");return a?(t.stopEvent(r),e.callaction(a,n,r)):void 0}))},initConfig(e){let t=this,s=t.T;e&&s.I.toArr(e,(e=>{"function"==typeof t[e[0]]&&t[e[0]](e[1])}))}};constructor(e,t,s){if(super(e,t),!this.obj)return;const r=this;r.callaction=t.callaction,r.$(".container")||r.callaction("installWindow"),r.callaction("installEvent"),r.callaction("installHeaderEvent"),r.callaction("initConfig",s)}title(e){this.$(".a-header .title").innerHTML=e}body(e){this.$(".a-body").innerHTML=e}footer(e){this.$(".a-footer").innerHTML=e}hiddenFooter(){this.$(".a-footer").hidden=!0}hiddenPath(e,t){this.$(".a-"+e).hidden=t||!1}}},Nttr=e=>{let t=Nenge,s=t.$(e);return e instanceof t.Nttr?e:s?s.Nttr?s.Nttr:new t.Nttr(s,t):void 0},nWindow=(e,t)=>{let s,r=Nenge;return e?(s=r.$(e),!s||s.Nttr instanceof r.nWindow||new r.nWindow(s,r,t),s&&s.Nttr):new r.nWindow(r.$ce("div"),r,t).appendTo()};Nenge.triger(document,"NengeLoad",{detail:Nenge});