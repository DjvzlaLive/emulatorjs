const Nenge=new class{version=1;DB_NAME="XBBS";DB_STORE_MAP={"data-js":{timestamp:!1},"data-file":{},avatar:{timestamp:!1},forumsicon:{timestamp:!1},document:{timestamp:!1}};LibStore="data-js";Encoding="GBK";maxsize=104857600;part="-part-";lang={};action={};StoreData={};JSpath=document.currentScript&&document.currentScript.src.split("/").slice(0,-1).join("/")+"/";fps=59;constructor(){const t=this,e=t.I;t.language=navigator.language;let s=t.language.split("-");s="zh"==s[0]?"TW"==s[1]?"zh-hant":"zh-hans":s[0],t.i18nName=s,t.on(window,"error",(t=>{e.mobile&&alert(t.message)})),t.triger(document,"NengeStart",{detail:t}),t.docload((e=>t.triger(document,"NengeReady",{detail:t})))}get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return Number(this.rand.toString().slice(2))}async getItem(t,e,s,r={}){if(!e)return await this.getAllData(t,1,r);let n=this,a=n.F,i=n.maxsize,o=n.part,l=await a.dbGetItem(n.I.assign({store:t,name:e},r)),c=e.split(o)[0];if(l){if(s&&l.version&&l.version!=s)l=void 0;else if(l.contents&&l.filesize&&l.filesize>i){let s=new n.I.O[11](l.filesize);await n.I.Async(Array(Math.ceil(l.filesize/i)).fill(c).map((async(c,d)=>{let u=c;if(d>0&&(u+=o+d),u==e)s.set(l.contents,d*i);else{let e=await a.dbGetItem(n.I.assign(r,{store:t,name:u}));e?s.set(e.contents,d*i):n.Err("lost file")}}))),l.contents=s}l&&l.contents&&n.I.u8obj(l.contents)&&("unpack"==l.type?(l.password&&(r.password=l.password),l.contents=await a.unFile(l.contents,r)):"File"==l.type?l.contents=new File([l.contents],l.filename||c,{type:l.filetype||a.gettype(l.filename||c)}):"String"==l.type&&(l.contents=(new TextDecoder).decode(l.contents)))}return l}async setItem(t,e,s,r){let n=this,a=n.F,i=n.I,o=n.maxsize,l=n.part;if((s=await a.contentsSize(s,o)).contents&&s.contents.byteLength>o){let n=s.contents.byteLength,c={};return i.toArr(s,(t=>{"contents"!=t[0]&&(c[t[0]]=t[1])})),await i.Async(Array(Math.ceil(n/o)).fill(e).map((async(e,d)=>{let u=e,h=d*o;return d>0&&(u+=l+d),await a.dbPutItem({store:t,data:i.assign({contents:new i.O[11](s.contents.subarray(h,n-h>=o?h+o:n))},c),name:u,dbName:r})})))}return await a.dbPutItem({store:t,data:s,name:e,dbName:r})}async removeItem(t,e,s){let{clear:r,dbName:n}=s||{},a=this,i=a.I,o=a.F;if(r){let r=await o.dbGetItem(i.assign({store:t,name:e},s));if(r&&r.filesize)return await i.Async(Array(Math.ceil(r.filesize/a.maxsize)).fill(e.split(a.part)[0]).map((async(e,s)=>{let r=e;return s>0&&(r+=a.part+s),await o.dbRemoveItem({store:t,name:r})+"\n"})))}return await o.dbRemoveItem({store:t,name:e,dbName:n})}async getAllData(t,e,s){return t?await this.F.dbGetAll(this.I.assign({store:t,only:e},s)):{}}async getContent(t,e,s,r){let n=await this.getItem(t,e,s,r);return n&&n.contents||n}async setContent(t,e,s,r,n){let a=this.I.assign(r||{},{contents:s,timestamp:this.date});return await this.setItem(t,e,a,n)}async getAllKeys(t,e,s){return await this.F.dbGetKeys(this.I.assign({store:t,dbName:e},s||{}))}async getAllCursor(t,e,s,r){return await this.F.dbGetCursor(this.I.assign({store:t,index:e,only:s},r))}async clearDB(t,e){let s=this.F;if(t)return s.I.str(t)&&(t=[t]),await s.dbRemoveTable(t,e)}async deleteDB(t,e){let s=this.F;return s.I.str(t)&&(t=[t]),await s.deleteDatabase(t,e)}getStore(t,e){if(!t)return;let s=this;if(t instanceof s.F.StoreDatabase)return t;e=e||s.DB_NAME,s.StoreData[e]||(s.StoreData[e]={});let r=s.F,n=s.StoreData[e];return n[t]||(n[t]=new r.StoreDatabase(s,t,e)),n[t]}async FetchItem(t){let e=this,s=e.F,r=e.I;t&&!r.str(t)||(t={url:t||"/"});let n,a,i="arrayBuffer",o=s.getname(t.url),l=t.key||o||"index.php",c=t.key==s.LibKey?l+o:l,d=t.version,u={},h=t.store&&e.getStore(t.store),p=(e,n)=>s.unFile(e,r.assign(t,{password:n})),m=async t=>(t&&t.contents&&("unpack"==t.type?(t=await p(t.contents,t.password)).password&&delete t.password:t=t.contents),b(t),t),b=e=>e&&t.success&&t.success(e,u);if(t.filename||(t.filename=o),t.onLine&&(t.unset=navigator.onLine),h&&(n=await h.get(c,d,t),n&&!t.unset&&!t.checksize))return m(n);if(a=await s.FetchStart(t).catch((e=>t.error&&t.error(e.message))),!a)return m(n);u=s.FetchHeader(a,t),r.exends(u,a,["url","status","statusText"]);let g=u.password||t.password||void 0;if(200!=a.status)return a.body&&(a.body.cancel(),t.error&&t.error(a.statusText,u)),"head"==t.type&&b(u),m(n);if(n&&n.filesize&&u.byteLength>0){if(n.filesize==u.byteLength)return a.body.cancel(),m(n);n=null}else if("head"==t.type)return a.body.cancel(),b(u);let y=r.func(t.process)?await s.StreamResponse(a,t,u):a;t.unpack&&(t.type=i),t.type=t.type||i;let f=await y[t.type](),w=u.type,v=u.byteLength||0,j=u["content-type"];if(t.type==i&&r.arrBuff(f)&&(f=new r.O[11](f),t.Filter&&(f=t.Filter(f)),w=r.N(11),v=f.byteLength,t.autounpack&&v<.3*e.maxsize&&(t.unpack=!0)),t.dataOption=t.dataOption||{},h&&t.unpack&&l===c&&v>e.maxsize&&(w="unpack",await h.put(c,e.I.assign({contents:f,timestamp:new Date,filesize:v,filetype:j,version:d,type:w,password:g},t.dataOption)),h=null),t.unpack&&r.u8obj(f)&&(f=await p(f,g),f.byteLength||(f.password&&(g=f.password,delete f.password),w="datalist")),h&&l!==c){if(r.u8obj(f))f=s.getFileText(f,t.decode,t.mime||u["content-type"]||s.gettype(""),o),w="File";else if(r.str(f))w=u["content-type"]||"String";else if("datalist"==w){let n;await r.Async(r.toArr(f).map((async a=>{let[i,o]=a,l=s.getname(i),c=s.gettype(l),d=s.getFileText(o,t.decode,c,l);return h.put(t.key+l,r.assign({contents:d,timestamp:e.date,filesize:o.byteLength,version:e.version,filetype:c,type:r.blob(d)?"File":"String"},t.dataOption)),t.filename==l&&(n=d),!0}))),n&&(f=n),n=null,h=null}}else t.decode&&(f=s.getFileText(f,t.decode,w),r.str(f)&&(w="String"));return h&&await h.put(c,r.assign({contents:f,filesize:v,filetype:j,version:d,type:w,password:g,timestamp:e.date},t.dataOption)),t.success&&t.success(f,u),f}ajax(t){let e=this,s=e.I;e.F;return s.str(t)&&(t={url:t}),s.Async((r=>{const n=new XMLHttpRequest(t.paramsDictionary);e.on(n,"error",(e=>{t.error&&t.error("net::ERR_FAILED"),r(null)})),e.on(n,"readystatechange",(e=>{switch(n.readyState){case n.LOADING:case n.OPENED:case n.UNSENT:break;case n.HEADERS_RECEIVED:if(s.defines(n,{headers:s.toObj((n.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((t=>{let e=t.split(": ");return[e.shift(),e.join(": ")]})).concat([["status",n.status],["statusText",n.statusText],["url",o]]))},1,1),"head"==t.type)return n.abort(),t.success&&t.success(n.headers),void r(n.headers);break;case n.DONE:200==n.status?(t.success&&t.success(n.response,n.headers,n),r(n.response)):n.status>0&&(t.error&&t.error(n.statusText,n.headers,n),r(null));break}})),t.process&&e.on(n,"progress",(e=>t.process(Math.ceil(100*e.loaded/e.total)+"%",e.total,e.loaded,0,n))),t.postProcess&&e.on(n.upload,"progress",(e=>t.postProcess(Math.ceil(100*e.loaded/e.total)+"%",e.total,e.loaded,e)));let a=["abort","load","loadend","loadstart","progress","readystatechange","timeout"];a.forEach((s=>t[s]&&e.on(n,s,(e=>t[s](e,n))))),n.upload&&t.upload&&a.forEach((s=>t.upload[s]&&e.on(n.upload,s,(e=>t.upload[s](e,n)))));let i,o,l=t.type||"";t.get={},o=s.get(t.url,t.get),t.json?(i=JSON.stringify(t.json),t.headers=Object.assign({accept:"application/json, text/plain, */*"},t.headers)):t.post&&(i=s.post(t.post)),t.overType&&n.overrideMimeType(t.overType),"head"!=l&&(n.responseType=l),n.open(i?"POST":"GET",o),t.headers&&s.toArr(t.headers,(t=>n.setRequestHeader(t[0],t[1]))),n.send(i)}))}runaction(t,e){let s=this;if(s.action)return s.action[t]instanceof Function?void 0===e||null==e?s.action[t].call(s):"string"!=typeof e&&e.length?s.action[t].apply(s,e||[]):s.action[t].call(s,e):void 0}callaction(t){let e=this;if(!e.action||!t)return;let s=Array.from(arguments),r=e.action[s.shift()];return r&&r instanceof Function?r.apply(e,s):void 0}bindaction(t){let e=this;if(e.action&&t&&e.action[t])return e.action[t].bind(e)}addJS(t,e,s,r){let n=this,a=n.F;if(n.I.blob(t)&&(r=a.getKeyName(t.name),"text/css"==t.type&&(s=!0)),r&&n.$("#link_"+r))return;let i=!1,o=n.$ce(s?"link":"script"),l=e=>{/^(blob:)?https?:\/\//.test(t)||/(\.js$|\.css$)/.test(t)||(i=!0,t=a.URL(t,a.gettype(s?"css":"js"))),s?(o.type=a.gettype("css"),o.href=t,o.rel="stylesheet"):(o.type=a.gettype("js"),o.src=t),r&&o.setAttribute("id","link_"+r),o.onload=r=>{e&&e(r),i&&a.removeURL(t),t=null,s||o.remove()},document[s?"head":"body"].appendChild(o)};return e?(l(e),o):n.I.Async(((t,e)=>l(t)))}async loadScript(t,e,s,r){e=e||{};let n=this,a=n.F;e.url=a.getpath(t),s?e.type="text":(e.store||(e.store=n.LibStore),e.key||(e.key=a.LibKey)),e.version=e.version||n.version;let i=await n.FetchItem(e);return s?i:await n.addJS(i)}async getScript(t,e){return this.loadScript(t,e,!0)}async addScript(t,e){return await T.addJS(await T.getScript(t,e))}async loadLibjs(t,e){let s=this.F;return await this.addJS(await s.getLibjs(t,e),null,"css"==s.getExt(t))}unFile(t,e,s){return this.F.unFile(t,this.I.assign({process:e},s||{}))}async toZip(t,e,s){let r=this;r.F;return r.I.Async((async n=>{let a=new Worker(r.JSpath+"zip.js?"+r.time);r.on(a,"message",(t=>{let s=t.data;1==s.t?(n(s.contents),t.target.terminate()):2==s.t&&e&&e(Math.ceil(100*s.current/s.total)+"%")})),r.on(a,"error",(t=>{n(null),a.terminate()})),a.postMessage(Object({contents:t},s||{})),t=null}))}I=new class{O=[Array,Object,HTMLFormElement,DOMStringMap,FormData,NamedNodeMap,Function,Blob,File,Promise,URLSearchParams,Uint8Array,HTMLFormElement,Element,CSSStyleDeclaration,String,void 0,null,Reflect,ArrayBuffer,Boolean,Headers];N(t){return this.O[t].name}assign(){return this.O[1].assign.apply(null,arguments)}exends(t,e,s){return s?this.toArr(s,(s=>t[s]=e[s])):t=this.assign(t,e),t}Async(t,e){return this.array(t)?this.O[9].all(t):new this.O[9](t,e)}formdata=t=>new this.O[4](t||void 0);formget(t){return new this.O[10](t)}get mobile(){return"ontouchend"in document}post(t){let e=this,s=e.T,r=e.postobj(t)?t:e.formdata(e.formelm(t)?t:e.str(t)?s.$(t):void 0);return e.objArr(t)&&e.toArr(t,(t=>r.append(t[0],t[1]))),r}get(t,e){let s=this,r="",n="",a=t.split("?");a[1]&&(r=s.formget(a[1])),e&&(n=s.formget(e));let i=s.formget(r+"&"+n).toString().replace(/^(.+?)=&/,"$1&");return a[0]+(i?"?"+i:"")}toObj(t){let e=this,s=e.O;return e.objArr(t)?t:s[1].fromEntries(e.toArr(t))}toArr(t,e){if(!t)return[];let s,r=this,n=r.O;return r.DOMmap(t)&&(t=n[1].assign({},t)),(r.postobj(t)||r.header(t))&&(s={},t.forEach(((t,e)=>{s[e]?(r.array(s[e])||(s[e]=[s[e]]),s[e].push(t)):s[e]=t})),t=n[1].entries(s)),r.nodemap(t)&&(t=n[0].from(t).map((t=>[t.nodeName,t.nodeValue]))),s=r.array(t)?t:t.length?n[0].from(t):n[1].entries(t),r.func(e)?s.forEach(e):s}define(t,e,s,r,n){let a=!!n;return this.O[1].defineProperty(t,e,r?{get:()=>s,configurable:a}:s),t}defines(t,e,s,r){return s?this.toArr(e,(e=>this.define(t,e[0],e[1],1,r))):this.O[1].defineProperties(t,e),t}textdecode(t,e){return new TextDecoder(e||"utf8").decode(t)}Json(t){let e=this,s=e.O;return e.u8obj(t)&&(t=e.textdecode(t)),"string"==typeof t?new s[6]("return "+t)():t}toJson(t){return JSON.stringify(this.Json(t))}empty(t){return!t||!this.toArr(t).length}constructor(t){let e=this,s=e.O,r="var O = I.O;";e.define(e,"T",{get:()=>t}),s[1].entries({array:0,obj:1,objArr:1,DOMmap:3,postobj:4,nodemap:5,blob:7,file:8,await:9,getobj:10,elm:13,func:6,u8obj:11,formelm:12,styleobj:14,str:15,undefined:17,arrBuff:19,bool:20,header:21}).forEach((t=>{r+=`I.define(I,'${t[0]}',{value(obj){`+(17==t[1]?`return obj ==  O[${t[1]}];`:["objArr","str"].includes(t[0])?`return obj!=O[16]&&obj!=O[17]&&obj.constructor.name == I.N(${t[1]});`:`return obj instanceof O[${t[1]}];`)+"}});"})),new s[6]("I",r)(e)}}(this);F=new class{Libjs={};LibKey="script-";async StreamResponse(t,e,s){let r=t=>Number(t),n=r(s["content-length"]||0),a=e.downtext?e.downtext:"",i=0,o={done:!1,value:!1},l=t.body.getReader();return new Response(new ReadableStream({async start(t){for(;!o.done;){let s=0,c="";o.value&&(s=r(o.value.length),i+=s,t.enqueue(o.value)),c=n&&i<n?a+Math.floor(i/n*100)+"%":a+Math.floor(10*i/1024)/10+"KB",e.process((e.filename?e.filename+" ":"")+c,n,i,s),o=await l.read()}t.close()}}))}FetchHeader(t,e){let s=this.I,r=s.toObj(t.headers)||{};return(r["content-type"]||this.gettype(e.url.split("/").pop()||"html")).split(";").forEach(((t,e)=>{if(t=t.trim().toLowerCase(),0==e)r["content-type"]=t;else if(-1!=t.search(/=/)){let e=t.split("=");r[e[0].trim()]=e[1].trim()}})),s.assign(r,{byteLength:Number(r["content-length"])||0,password:r.password||r["content-password"],type:r.type||r["content-type"].split("/")[1].split("+")[0]})}async FetchStart(t){let e=this.I,{url:s,get:r,post:n}=t||{},a={};if(s=e.get(t.url,r),a.headers={},["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"].forEach((e=>{null!=t[e]&&(a[e]=t[e])})),t.json)a.body=JSON.stringify(t.json),delete t.json,a.headers.Accept="application/json",a.method="POST";else if(n){a.method="POST";let s=(a.headers.accept||a.headers.Accept||"").toLowerCase();/(\+|\/)json/.test(s)?a.body=e.toJson(n):t.accept?(a.headers.Accept=t.accept,a.body=n):a.body=e.post(n)}return fetch(s,a)}zipsrc="zip.min.js";mime_preg={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};CheckExt(t){let e=this.I,s=t.slice(0,16),r=this.bindaction("textext"),n=e.blob(s)?s.arrayBuffer():e.str(s)?(new TextEncoder).encode(s):s;return e.await(n)?e.Async((async t=>t(r(await n)))):r(n)}action={textext(t){let e=this.I,s=e.toArr(e.arrBuff(t)?new e.O[11](t):t).map((t=>t.toString(16).padStart(2,0).toLocaleUpperCase())).join(""),r=e.toArr(this.mime_preg).filter((t=>t[1].test(s)));return r[0]?r[0][0]:""},async rar(t,e,s){let r,n=this,a=n.I;a.blob(t)&&(!e.filename&&t.name&&(e.filename=t.name),t=new a.O[11](await t.arrayBuffer())),s=s||"libunrar.min.zip",n.Libjs[s]||await n.getLibjs(s,r);let i,o=n.Libjs[s];return e.process&&(i=e.filename?n.T.getLang("Decompress:")+e.filename+"=&gt;":n.T.getLang("Decompress:"),r=t=>e.process(i+(t.file?n.getname(t.file):"")+" "+Math.floor(Number(t.current)/Number(t.total)*100)+"%",t.total,t.current)),a.Async((s=>{let a,i=new Worker(o);i.onmessage=o=>{let l=o.data,c=l.t;if(1===c)s(a||t),o.target.terminate();else if(2===c)a||(a={}),a[l.file]=l.data;else if(4===c&&l.total>0&&l.total>=l.current)r&&r(l);else if(-1==c){let r=prompt(n.T.getLang(l.message),e.password||"");if(!r)return s(t),o.target.terminate();e.unpack&&(a.password=r),e.password=r,i.postMessage({password:r})}},i.onerror=async e=>{s(t),i.terminate()},i.postMessage({contents:t,password:e.password})}))},"7z":function(t,e){return this.callaction("rar",t,e,"extract7z.zip")},async zip(t,e={}){return this.T.Libzip==this.zipsrc?this.callaction("zipjs",t,e):this.callaction("rar",t,e,this.T.Libzip)},async zipjs(t,e){e=e||{};let s=this.T;window.zip||await s.loadLibjs(s.JSpath+this.zipsrc);var r=new zip.ZipReader(new zip[t instanceof Uint8Array?"Uint8ArrayReader":"BlobReader"](t)),n={},a=void 0,i=async t=>{n[t.filename]=await t.getData(new zip.Uint8ArrayWriter,{onprogress:(s,r)=>e.process&&e.process(t.filename,s,r),password:a})},o=async t=>{try{null==a&&(a=e.password),await i(t)}catch(e){a=window.prompt(s.getLang("Invalid password"),a),await o(t)}},l=await r.getEntries(),c=0;if(l)for(;l[c];){let t=l[c];c++,t.directory||(t.encrypted&&!a?await o(t):await i(t))}return n}};async unFile(t,e={}){let s=this,r=s.I;r.await(t)&&(t=await t),r.array(t)&&(t=new r.O[11](t));let n=await s.CheckExt(t);return!s.action[n]||e.PassExt&&e.PassExt.includes(zip)?(r.blob(t)&&(t=new r.O[11](await t.arrayBuffer())),t):await s.callaction(n,t,e)}async getLibjs(t,e){let s=this,r=s.T,n=s.I,a=s.getname(t),i=a.replace(/\.zip$/,".js");if(s.Libjs[a])return s.Libjs[a];if(s.Libjs[i])return s.Libjs[i];let o=await r.getStore(r.LibStore).data(s.LibKey+i,r.version);return o||(/\.zip$/.test(a)&&await s.getLibjs(r.Libzip,e),o=await r.FetchItem({url:s.getpath(t)+"?"+r.time,store:r.LibStore,key:s.LibKey,unpack:!0,filename:i,version:r.version,process:e})),o&&(n.objArr(o)?s.I.toArr(o,(t=>s.Libjs[t[0]]=t[1]&&s.URL(t[1]))):s.Libjs[a]=s.URL(o)),o=null,s.Libjs[a]}getname(t){return(t||"").split("/").pop().split("?")[0].split("#")[0]}getpath(t){let e=this.T;e.I;return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:)/.test(t)?t:e.JSpath+t}getFileText(t,e,s,r){let n=this,a=n.T.I;if(r&&!e||!/(text|javascript)/.test(s))return new File([t],r,{type:s});if(!e)return t;if("datalist"==s)a.toArr(t,(s=>{/(text|javascript)/.test(n.gettype(s[0]))&&(t[s[0]]=e(s[1]))}));else if(a.u8obj(t))return e(t);return t}getExt(t){return this.getname(t).split(".").pop().toLowerCase()}getKeyName(t){let e=this.getname(t).split(".");return e.pop(),e.join(".")}gettype(t){let e=this;return(t=e.getExt(t))&&!e.mime_list&&(e.mime_list={},e.I.toArr(e.mime_map,(t=>t[1].forEach((s=>e.mime_list[s]=t[0]+(t[0].includes("/")?"":"/"+s)))))),e.mime_list[t]||"application/octet-stream"}mime_map={"text/javascript":["js"],"text/css":["css","style"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml","svg"],image:["jpg","jpeg","png","gif","webp"],application:["pdf"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};checkBuffer(t,e){let s=this.I.toArr(t.slice(0,8)).map((t=>t.toString(16).padStart(2,0).toLocaleUpperCase())).join("");if(s){let t=this.I.toArr(this.mime_preg).filter((t=>t[1].test(s)))[0];if(t)return t[0]}return e||!1}URL(t,e){let s=this,r=s.I;if(r.u8obj(t))e||(e=s.gettype(s.CheckExt(t)));else if(r.str(t)){if(/^(blob|http)/.test(t)||/^\/?[\w\-_\u4e00-\u9FA5:\/\.\?\^\+ =%&@#~]+$/.test(t))return t;e||(e=s.gettype("js"))}return window.URL.createObjectURL(r.blob(t)?t:new Blob([t],{type:e}))}removeURL(t){return window.URL.revokeObjectURL(t)}download(t,e,s){let r;this.I.blob(t)?(r=this.URL(t),t=t.name||"unknowfile"):r=this.URL(e,s);let n=document.createElement("a");n.href=r,n.download=t,n.click(),n.remove()}StoreList={};get idb(){return window.indexedDB||window.webkitindexedDB}dbSetMap(t){let e=this,s=e.I,r=e.T,n=e.dbMap||{};n&&!n[e.dbname]&&(n[e.dbname]=r.DB_STORE_MAP);let a=t.store;if(a){let r=t.dbName||e.dbname;if(r&&!n[r]&&(n[r]={}),a&&!n[r][a]){n[r][a]={};let e=t.dbIndex;e&&(s.str(e)?n[r][a][e]=!1:s.assign(n[r][a],e))}}return e.dbMap||(e.dbMap=n),n}async dbLoad(t){let e=this,s=(t=t||{}).dbName||e.dbname,r=t.store,n=e.StoreList[s];return r&&e.dbCheckTable(r,n)||!r&&n?n:(t.dbName=s,await e.dbInstall(e.dbSetMap(t)),e.StoreList[s])}async dbInstall(t){let e=this,s=e.I;return await s.Async(s.toArr(t).map((async t=>{let r,[n,a]=t,i=e.StoreList[n];if(i){if(!s.toArr(a).filter((t=>!e.dbCheckTable(t[0],i))).length)return"ok";r=i.version+1,i.close(),delete e.StoreList[n]}let o=Object.keys(a);return e.StoreList[n]=await e.dbOpen(n,a,r,{success:async(t,s)=>e.dbCheckTable(o,t)!=o.length?(r=e.dbClose(t),s(await e.dbOpen(n,a,r))):s(t)}),n})))}async dbOpen(t,e,s,r){let n=this;return n.I.Async(((a,i)=>{let o=n.idb.open(t,s);o.addEventListener("error",(async t=>{i(t)})),o.addEventListener("upgradeneeded",(async t=>{let s=o.result;r&&r.upgradeneeded?await r.upgradeneeded.apply(o,[s]):e&&await n.dbCreateObject(e,s)})),o.addEventListener("success",(async t=>{let e=o.result;if(r&&r.success)return await r.success(e,a);a(e)}))}))}async dbCreateObject(t,e){if(!t||!e)return;let s=this,r=s.I;await r.Async(r.toArr(t).map((async t=>{let[n,a]=t;if(!s.dbCheckTable(n,e)){let t=await e.createObjectStore(n);a&&r.toArr(a,(e=>t.createIndex(e[0],e[1]&&e[1].key||e[0],e[1]&&e[1].options||e[1]||{unique:!1})))}})))}dbCheckTable(t,e,s){return e?(this.I.str(t)&&(t=[t]),t=t?t.filter((t=>e.objectStoreNames.contains(t))):[],s?t:t.length):0}async contentsSize(t,e){let s=this.I;s.await(t)&&(t=await t);let r=t.contents||t,n={};return s.str(r)&&r.length>e?(r=(new TextEncoder).encode(r),s.assign(n,{contents:r,filesize:r.byteLength,type:"String"})):s.blob(r)&&r.size>e?s.assign(n,{contents:new s.O[11](await r.arrayBuffer()),filetype:r.type,filesize:r.size,filename:r.name,type:"File"}):r.byteLength&&r.byteLength>e&&(r.__proto__.constructor!=s.O[11]&&(r=new s.O[11](r.buffer||r)),s.assign(n,{contents:r,filesize:r.byteLength,type:s.N(11)})),n.contents&&(t.type||n.type||(n.type=s.N(11)),t.contents?(delete t.contents,s.assign(t,n)):t=n),t.contents&&["version","password"].forEach((e=>!t[e]&&delete t[e])),t}async dbSelect(t,e){let s=this;s.T;s.I.str(t)&&(t={store:t}),t.store instanceof s.StoreDatabase&&(t.store=t.store.table);let r=t.store,n=await s.dbLoad(t);e=e?"readonly":"readwrite",r||(r=n.objectStoreNames[0]);let a=n.transaction([r],e);return a.onerror=t=>{throw t.preventDefault(),a.error},a.objectStore(r)}async dbGetItem(t){let e=this.I;e.str(t)&&(t={name:t});let s=t.name,r=await this.dbSelect(t,!0);if(s)return e.Async((t=>{r.get(s).onsuccess=e=>t(e.target.result)}))}async dbPutItem(t){let e=this.I,{data:s,name:r}=t||{},n=await this.dbSelect(t);return e.Async((t=>{n.put(s,r).onsuccess=e=>t(e.target.result)}))}async dbRemoveItem(t){let e=this.I;e.str(t)&&(t={name:t});let s=t.name,r=await this.dbSelect(t);if(s)return e.Async(((t,e)=>{r.delete(s).onsuccess=e=>t(`delete:${s}`)}))}async dbGetAll(t){let e=this,s=e.I,r=e.T,n=await e.dbSelect(t,!0);return s.Async((a=>{let i={};t.index&&(n=n.index(t.index)),n.openCursor(t.Range).onsuccess=n=>{let o=n.target.result;if(o){if(t.only&&r.part&&r.maxsize&&s.u8obj(o.value.contents)&&o.value.filesize>r.maxsize){let t=o.primaryKey.split(r.part),n=t[0],a=t[1]||0;if(i[n])i[n].contents.set(o.value.contents,a*r.maxsize);else{let t=new s.O[11](o.value.filesize);t.set(o.value.contents,a*r.maxsize),delete o.value.contents,i[n]=e.assign(o.value,{contents:t})}}else i[o.primaryKey]=o.value;o.continue()}else a(i)}}))}async dbGetKeys(t){let e=this,s=e.I;s.str(t)&&(t={dbName:t});let r=await e.dbSelect(t,!0);return s.Async((n=>t.index&&r.indexNames.contains(t.index)?r.index(t.index).getAllKeys(t.Range).onsuccess=r=>{n(t.only?s.toArr(r.target.result).filter((t=>!t.includes(e.T.part))):r.target.result)}:r.getAllKeys().onsuccess=r=>{n(t.only?s.toArr(r.target.result).filter((t=>!t.includes(e.T.part))):r.target.result)}))}async dbGetCursor(t){let e=this,s=e.I;s.str(t)&&(t={index:t});let r=t.index,n=e.T,a=await e.dbSelect(t,!0),i=a.indexNames.length;if(i&&!r)r=a.indexNames[0];else if(!i)return e.dbGetKeys(t);return s.Async((e=>{let s={};a.index(r).openKeyCursor(t.Range).onsuccess=a=>{let i=a.target.result;i?((!t.only||n.part&&!i.primaryKey.includes(n.part))&&(s[i.primaryKey]=Object.fromEntries([[r,i.key]])),i.continue()):e(s)}}))}async dbRemoveTable(t,e){let s=this,r=s.I;return r.str(t)&&(t=[t]),await r.Async(t.map((async t=>{(await s.dbSelect({store:t,dbName:e})).clear()})))}dbClose(t){let e=this,s=e.I.str(t),r=s?e.StoreList[t]:t;if(r){let n=r.version+1;return r.close(),s&&delete e.StoreList[t],n}}async deleteDatabase(t,e){let s=this;if(e=e||s.dbname,!t)return s.idb.deleteDatabase(e||s.dbname);let r=s.StoreList[e]||await s.dbOpen(e);if(r&&!s.dbCheckTable(t,r))return"ok";let n=s.dbClose(r);return delete s.StoreList[e],await s.dbOpen(e,null,n,{upgradeneeded(e){e.deleteObjectStore(t)},success(t,e){s.close(t),e("ok")}})}StoreDatabase=class{constructor(t,e,s){s=s||t.DB_NAME;let r=t.I,n=`var I = T.I;I.defines(S, { T,I,table:'${e}',dbName:'${s}' }, 1,1);`;r.toArr(["getItem","setItem","removeItem","getAllData","getContent","setContent","getAllKeys","getAllCursor","clearDB","deleteDB"],(t=>{n+=`I.define(S, '${t}', {value:function(){let arr = ['${e}'].concat(I.toArr(arguments));return T.${t}.apply(T, arr);}});`})),new Function("S","T",n)(this,t)}setName(t){let e=this.I;return t&&"boolean"!=typeof t?e.str(t)&&(t={dbName:t}):t={dbName:this.dbName},t}get(t,e,s){return s=this.setName(s),this.getItem(t,e,s)}put(t,e){return this.setItem(t,e,this.dbName)}remove(t,e){return e=this.setName(e),this.removeItem(t,e)}data(t,e,s){return this.getData(t,e,s)}getData(t,e,s){return s=this.setName(s),this.getContent(t,e,s)}setData(t,e,s){return this.setContent(t,e,s,this.dbName)}keys(t){return this.getAllKeys(this.dbName,t||{})}cursor(t,e,s){return s=this.setName(s),this.getAllCursor(t,e,s)}all(t,e){return e=this.setName(e),this.getAllData(t,e)}clear(){return this.clearDB(this.dbName)}delete(){return this.deleteDB(this.dbName)}async getBatch(t,e){let s=await this.I.Async(t.map((async t=>await this.get(t))));return e?e(s):s}};get dbname(){return this.T.DB_NAME}constructor(t){let e=this,s=t.I;t.Libzip||(t.Libzip=e.zipsrc),s.defines(e,{I:s,T:t},1),e.callaction=t.callaction,e.bindaction=t.bindaction}}(this);on(t,e,s,r,n){(t=this.$(t))&&t.addEventListener(e,s,!1===r?{passive:!1}:r,n)}un(t,e,s,r,n){this.$(t).removeEventListener(e,s,!1===r?{passive:!1}:r,n)}once(t,e,s,r){return this.on(t,e,s,{passive:!1,once:!0},r)}docload(t){let e=document;return this.I.Async((s=>{if("loading"==e.readyState)return this.once(e,"DOMContentLoaded",(()=>{t&&t.call(this),s(!0)}));t&&t.call(this),s(!0)}))}$(t,e){let s=this.I,r=e||document;return t?s.str(t)?r.querySelector(t):s.func(t)?this.docload(t):t:void 0}$$(t,e){return(e||document).querySelectorAll(t)}$ce(t){return document.createElement(t)}$ct(t,e){let s=this.$ce(t);return s.innerHTML=e,s}$ca(t,e){let s=this.I,r=this.$ce(t);return e&&s.toArr(e,(t=>{r.setAttribute(t[0],t[1])})),r}$append(t,e){return t.appendChild(e),e}$add(t,e){return t.classList.add(e),t}customElement(t){let e=this;window.customElements.define(t,class extends HTMLElement{constructor(){super(),e.callaction("TAG-"+this.tagName,this,"init")}connectedCallback(){e.callaction("TAG-"+this.tagName,this,"connect")}attributeChangedCallback(t,s,r){e.callaction("TAG-"+this.tagName,this,"attribute",{name:t,oldValue:s,newValue:r})}disconnectedCallback(){e.callaction("TAG-"+this.tagName,this,"disconnect")}})}attr(t,e){if(this.$(t))return this.$(t).getAttribute(e)}docElm(t,e){return(new DOMParser).parseFromString(t,e||"text/html")}HTMLToTxt(t){return this.I.str(t)&&(t=this.docElm(t)),t instanceof Document?t.body.textContent:""}fragment(){return new DocumentFragment}Err(t){return new Error(t)}triger(t,e,s){let r=this;return r.I.str(t)&&(t=r.$(t)),s?s.detail||(s.detail=t):s={},s.hasOwnProperty("cancelable")||(s.cancelable=!0),r.dispatch(t,new CustomEvent(e,s))}dispatch(t,e){return t?t.dispatchEvent(e):e}down(t,e,s){return this.F.download(t,e,s)}stopEvent=t=>{t.preventDefault()};stopProp=t=>{t.preventDefault(),t.stopPropagation()};stopGesture(t){let e=this;["gesturestart","gesturechange","gestureend"].forEach((s=>e.on(t,s,(t=>e.stopEvent(t)))))}async battery(t){const e=await navigator.getBattery();["chargingchange","levelchange","chargingtimechange","dischargingtimechange"].forEach((s=>t.val&&this.on(e,s,(s=>this.callaction(t.val,s,e)))))}getLang(t,e){let s=this.lang&&this.lang[t]||t;return this.lang[t],e&&s&&T.I.toArr(e,(t=>{s=s.replace(new RegExp("/{"+t[0]+"}/","g"),t[1])})),s}THEN(t){return this.I.Async(t)}Nttr=class{constructor(t,e){let s=(e=e||Nenge).I;if(s.defines(this,{T:e,I:s},1,1),s.str(t)&&(t=e.$(t)),s.elm(t)?(this.obj=t,t.Nttr?this.resetNttr(t.Nttr):this.obj=t):this.resetNttr(t),!this.obj)throw"Nttr error";s.defines(this.obj,{Nttr:this},1,!0)}resetNttr(t){let e=this,s=e.I;t instanceof this.constructor&&(e.eventList=s.assign({},t.eventList),e.obj=t.obj,O[18].deleteProperty(t.obj,"Nttr"))}eventList={};get cList(){return this.obj.classList}get active(){return this.contains("active")}set active(t){this.cList[t?"add":"remove"]("active")}get show(){return this.contains("show")}set show(t){this.cList[t?"add":"remove"]("show")}get hidden(){return this.obj.hidden}set hidden(t){return this.obj.hidden=t,this}get css(){return this.obj.style.cssText}set css(t){this.obj.style.cssText=t}get style(){return this.I.toObj(this.obj.style)}set style(t){if(this.I.str(t))return this.css=t;this.I.assign(this.obj.style,t)}html(t){return null!=t?(this.obj.innerHTML=t,this):this.obj.innerHTML}$(t){return this.obj.querySelector(t)}$$(t){return this.obj.querySelectorAll(t)}contains(t){return this.cList.contains(t)}get attrs(){return this.T.I.toObj(this.obj.attributes)}set attrs(t){this.T.I.toArr(t,(t=>this.setAttr(t[0],t[1])))}attr(t,e){return void 0===e?this.obj.getAttribute(t):null==e?this.obj.removeAttribute(t):(this.obj.setAttribute(t,e),this)}getAttrs(t){return t?this.attr(t):this.attrs}setAttrs(t,e){return e||"string"==typeof t?(this.attr(t,e),this):this.attrs=t}addClass(t){return this.cList.add(t),this}removeClass(t){return this.cList.remove(t),this}addChild(t){return this.obj.appendChild(t),this}appendTo(t){return(t=t||document.body).appendChild(this.obj),this}on(t,e,s){let r=this;return r.eventList[t]||(r.eventList[t]=[]),r.eventList[t].push({func:e,opt:s}),r.T.on(r.obj,t,e,s),r}un(t,e){let s=this;if(s.eventList[t]){let r=[];s.eventList[t].forEach((n=>{let{func:a,opt:i}=n;e&&e!=a?r.push(n):s.removeEvent(t,a,i)})),s.eventList[t]=[],r.length>0&&(s.eventList[t]=r)}else t||s.I.toArr(s.eventList,(t=>{t[1].forEach((e=>{let{func:r,opt:n}=e;s.removeEvent(t[0],r,n)})),delete s.eventList[t[0]]}));return s}once(t,e,s){return this.T.once(this.obj,t,e,s),N}removeEvent(t,e,s){return this.T.un(this.obj,t,e,s)}triger(t,e){let s=this,r=this.I.assign({},e||{},{target:s.obj});s.eventList[t]?s.eventList[t].forEach((t=>t.func.call(s.obj,r))):s.T.triger(s.obj,t,r)}dispatch(t){this.obj.dispatchEvent(t)}bind(t,e){let s=this,r=s.T,n=s.I;e||(e=s.I.mobile?"touchend":"click"),n.toArr(t,(t=>r.on(s.$(t[0],this.obj),e,t[1])))}click(t,e,s){let r=this;return e||(e=r.I.mobile?"touchend":"click"),r.I.func(t)?(r.un(e),r.on(e,t,s||!1)):r.triger(e,t),r}getBoundingClientRect(){return this.obj.getBoundingClientRect()}remove(){this.un(),this.obj.remove()}get children(){return this.I.toArr(this.obj.children)}get parentNode(){return this.obj.parentNode}get rect(){return this.getBoundingClientRect()}};nWindow=class extends this.Nttr{action={close(){this.hidden=!0},show(){this.hidden=!1},installWindow(){this.addClass("ajaxWindow"),this.html('<div class="container">\n                    <div class="a-header">\n                        <div class="title"><span class="loading">&#61712;</span></div>\n                        <div class="menu">\n                            <button type="button" class="close" data-naction="close">&#61453;</button>\n                        </div>\n                    </div>\n                    <div class="a-body">\n                        <p class="loading">&#61473;</p>\n                    </div>\n                    <div class="a-footer" hidden></div>\n                </div>')},installHeaderEvent(){let t,e=this,s=e.T;t=s.I.mobile?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup","mouseout"],t.forEach((t=>s.on(e.$(".a-header"),t,(t=>{if(("mousedown"==t.type||"touchstart"==t.type)&&t){let{clientX:s,clientY:r}="mousedown"==t.type?t:t.touches[0];e.HeaderPointPos={clientX:s,clientY:r}}if("mouseup"!=t.type&&"mouseout"!=t.type&&"touchend"!=t.type||(e.HeaderPointPos=!1),("mousemove"==t.type||"touchmove"==t.type)&&e.HeaderPointPos){let{clientX:s,clientY:r}="mousemove"==t.type?t:t.touches[0],n=e.$(".container"),a=n.getBoundingClientRect(),i="",o="",l=e.HeaderPointPos.clientX-s,c=e.HeaderPointPos.clientY-r;o=a.top-c,o="top:"+o+"px;bottom:unset;",l=l||0,i=a.left-l,(i<10||i&&a.width+i+15>window.innerWidth)&&(i=parseFloat(n.style.left),i<=10?i=10:i+10>window.innerWidth&&(i-=10)),i="left:"+i+"px;right:unset;width:"+a.width+"px;",e.$(".container").style.cssText=i+o,e.HeaderPointPos={clientX:s,clientY:r}}}))),{passive:!1})},installEvent(){let t=this,e=t.T,s=t.obj;e.on(s,"pointerup",(r=>{let n=r.target;if(n==s)return t.callaction("close",n,r);let a=n&&e.attr(n,"data-naction");return a?(e.stopEvent(r),t.callaction(a,n,r)):void 0}))},initConfig(t){let e=this,s=e.T;t&&s.I.toArr(t,(t=>{"function"==typeof e[t[0]]&&e[t[0]](t[1])}))}};constructor(t,e,s){if(super(t,e),!this.obj)return;const r=this;r.callaction=e.callaction,r.$(".container")||r.callaction("installWindow"),r.callaction("installEvent"),r.callaction("installHeaderEvent"),r.callaction("initConfig",s)}title(t){this.$(".a-header .title").innerHTML=t}body(t){this.$(".a-body").innerHTML=t}footer(t){this.$(".a-footer").innerHTML=t}hiddenFooter(){this.$(".a-footer").hidden=!0}hiddenPath(t,e){this.$(".a-"+t).hidden=e||!1}}},Nttr=t=>{let e=Nenge,s=e.$(t);return t instanceof e.Nttr?t:s?s.Nttr?s.Nttr:new e.Nttr(s,e):void 0},nWindow=(t,e)=>{let s,r=Nenge;return t?(s=r.$(t),!s||s.Nttr instanceof r.nWindow||new r.nWindow(s,r,e),s&&s.Nttr):new r.nWindow(r.$ce("div"),r,e).appendTo()};Nenge.triger(document,"NengeLoad",{detail:Nenge});