const Nenge=new class{version=1;DB_NAME="XBBS";DB_STORE_MAP={"data-js":{timestamp:!1},"data-file":{},avatar:{timestamp:!1},forumsicon:{timestamp:!1},document:{timestamp:!1}};LibStore="data-js";Encoding="GBK";maxsize=104857600;part="-part-";lang={};action={};StoreData={};JSpath=document.currentScript&&document.currentScript.src.split("/").slice(0,-1).join("/")+"/";fps=59;constructor(){const t=this,e=t.I;t.language=navigator.language;let s=t.language.split("-");s="zh"==s[0]?"TW"==s[1]?"zh-hant":"zh-hans":s[0],t.i18nName=s,t.on(window,"error",(t=>{e.mobile&&alert(t.message)})),t.triger(document,"NengeStart",{detail:t}),t.docload((e=>t.triger(document,"NengeReady",{detail:t})))}get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return Number(this.rand.toString().slice(2))}async getItem(t,e,s,n={}){if(!e)return await this.getAllData(t,1,n);let r=this,a=r.F,i=r.maxsize,o=r.part,l=await a.dbGetItem(r.I.assign({store:t,name:e},n)),c=e.split(o)[0];if(l){if(s&&l.version&&l.version!=s)l=void 0;else if(l.contents&&l.filesize&&l.filesize>i){let s=new r.I.O[11](l.filesize);await r.I.Async(Array(Math.ceil(l.filesize/i)).fill(c).map((async(c,d)=>{let u=c;if(d>0&&(u+=o+d),u==e)s.set(l.contents,d*i);else{let e=await a.dbGetItem(r.I.assign(n,{store:t,name:u}));e?s.set(e.contents,d*i):r.Err("lost file")}}))),l.contents=s}l&&l.contents&&r.I.u8obj(l.contents)&&("unpack"==l.type?(l.password&&(n.password=l.password),l.contents=await a.unFile(l.contents,n)):"File"==l.type?l.contents=new File([l.contents],l.filename||c,{type:l.filetype||a.gettype(l.filename||c)}):"String"==l.type&&(l.contents=(new TextDecoder).decode(l.contents)))}return l}async setItem(t,e,s,n){let r=this,a=r.F,i=r.I,o=r.maxsize,l=r.part;if((s=await a.contentsSize(s,o)).contents&&s.contents.byteLength>o){let r=s.contents.byteLength,c={};return i.toArr(s,(t=>{"contents"!=t[0]&&(c[t[0]]=t[1])})),await i.Async(Array(Math.ceil(r/o)).fill(e).map((async(e,d)=>{let u=e,h=d*o;return d>0&&(u+=l+d),await a.dbPutItem({store:t,data:i.assign({contents:new i.O[11](s.contents.subarray(h,r-h>=o?h+o:r))},c),name:u,dbName:n})})))}return await a.dbPutItem({store:t,data:s,name:e,dbName:n})}async removeItem(t,e,s){let{clear:n,dbName:r}=s||{},a=this,i=a.I,o=a.F;if(n){let n=await o.dbGetItem(i.assign({store:t,name:e},s));if(n&&n.filesize)return await i.Async(Array(Math.ceil(n.filesize/a.maxsize)).fill(e.split(a.part)[0]).map((async(e,s)=>{let n=e;return s>0&&(n+=a.part+s),await o.dbRemoveItem({store:t,name:n})+"\n"})))}return await o.dbRemoveItem({store:t,name:e,dbName:r})}async getAllData(t,e,s){return t?await this.F.dbGetAll(this.I.assign({store:t,only:e},s)):{}}async getContent(t,e,s,n){let r=await this.getItem(t,e,s,n);return r&&r.contents||r}async setContent(t,e,s,n,r){let a=this.I.assign(n||{},{contents:s,timestamp:this.date});return await this.setItem(t,e,a,r)}async getAllKeys(t,e,s){return await this.F.dbGetKeys(this.I.assign({store:t,dbName:e},s||{}))}async getAllCursor(t,e,s,n){return await this.F.dbGetCursor(this.I.assign({store:t,index:e,only:s},n))}async clearDB(t,e){let s=this.F;if(t)return s.I.str(t)&&(t=[t]),await s.dbRemoveTable(t,e)}async deleteDB(t,e){let s=this.F;return s.I.str(t)&&(t=[t]),await s.deleteDatabase(t,e)}getStore(t,e){if(!t)return;let s=this;if(t instanceof s.F.StoreDatabase)return t;e=e||s.DB_NAME,s.StoreData[e]||(s.StoreData[e]={});let n=s.F,r=s.StoreData[e];return r[t]||(r[t]=new n.StoreDatabase(s,t,e)),r[t]}async FetchItem(t){let e=this,s=e.F,n=e.I;t&&!n.str(t)||(t={url:t||"/"});let r,a,i="arrayBuffer",o=s.getname(t.url),l=t.key||o||"index.php",c=t.key==s.LibKey?l+o:l,d=t.version,u={},h=t.store&&e.getStore(t.store),p=(e,r)=>s.unFile(e,n.assign(t,{password:r})),m=async t=>(t&&t.contents&&("unpack"==t.type?(t=await p(t.contents,t.password)).password&&delete t.password:t=t.contents),b(t),t),b=e=>e&&t.success&&t.success(e,u);if(t.filename||(t.filename=o),t.onLine&&(t.unset=navigator.onLine),h&&(r=await h.get(c,d,t),r&&!t.unset&&!t.checksize))return m(r);if(a=await s.FetchStart(t).catch((e=>t.error&&t.error(e.message))),!a)return m(r);u=s.FetchHeader(a,t),n.exends(u,a,["url","status","statusText"]);let g=u.password||t.password||void 0;if(200!=a.status)return a.body&&(a.body.cancel(),t.error&&t.error(a.statusText,u)),"head"==t.type&&b(u),m(r);if(r&&r.filesize&&u.byteLength>0){if(r.filesize==u.byteLength)return a.body.cancel(),m(r);r=null}else if("head"==t.type)return a.body.cancel(),b(u);let y=n.func(t.process)?await s.StreamResponse(a,t,u):a;t.unpack&&(t.type=i),t.type=t.type||i;let f=await y[t.type](),w=u.type,v=u.byteLength||0,j=u["content-type"];if(t.type==i&&n.arrBuff(f)&&(f=new n.O[11](f),t.Filter&&(f=t.Filter(f)),w=n.N(11),v=f.byteLength,t.autounpack&&v<.3*e.maxsize&&(t.unpack=!0)),t.dataOption=t.dataOption||{},h&&t.unpack&&l===c&&v>e.maxsize&&(w="unpack",await h.put(c,e.I.assign({contents:f,timestamp:new Date,filesize:v,filetype:j,version:d,type:w,password:g},t.dataOption)),h=null),t.unpack&&n.u8obj(f)&&(f=await p(f,g),f.byteLength||(f.password&&(g=f.password,delete f.password),w="datalist")),h&&l!==c){if(n.u8obj(f))f=s.getFileText(f,t.decode,t.mime||u["content-type"]||s.gettype(""),o),w="File";else if(n.str(f))w=u["content-type"]||"String";else if("datalist"==w){let r;await n.Async(n.toArr(f).map((async a=>{let[i,o]=a,l=s.getname(i),c=s.gettype(l),d=s.getFileText(o,t.decode,c,l);return h.put(t.key+l,n.assign({contents:d,timestamp:e.date,filesize:o.byteLength,version:e.version,filetype:c,type:n.blob(d)?"File":"String"},t.dataOption)),t.filename==l&&(r=d),!0}))),r&&(f=r),r=null,h=null}}else t.decode&&(f=s.getFileText(f,t.decode,w),n.str(f)&&(w="String"));return h&&await h.put(c,n.assign({contents:f,filesize:v,filetype:j,version:d,type:w,password:g,timestamp:e.date},t.dataOption)),t.success&&t.success(f,u),f}ajax(t){let e=this,s=e.I;e.F;return s.str(t)&&(t={url:t}),s.Async((n=>{const r=new XMLHttpRequest(t.paramsDictionary);e.on(r,"error",(e=>{t.error&&t.error("net::ERR_FAILED"),n(null)})),e.on(r,"readystatechange",(e=>{switch(r.readyState){case r.LOADING:case r.OPENED:case r.UNSENT:break;case r.HEADERS_RECEIVED:if(s.defines(r,{headers:s.toObj((r.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((t=>{let e=t.split(": ");return[e.shift(),e.join(": ")]})).concat([["status",r.status],["statusText",r.statusText],["url",o]]))},1,1),"head"==t.type)return r.abort(),t.success&&t.success(r.headers),void n(r.headers);break;case r.DONE:200==r.status?(t.success&&t.success(r.response,r.headers,r),n(r.response)):r.status>0&&(t.error&&t.error(r.statusText,r.headers,r),n(null));break}})),t.process&&e.on(r,"progress",(e=>t.process(Math.ceil(100*e.loaded/e.total)+"%",e.total,e.loaded,0,r))),t.postProcess&&e.on(r.upload,"progress",(e=>t.postProcess(Math.ceil(100*e.loaded/e.total)+"%",e.total,e.loaded,e)));let a=["abort","load","loadend","loadstart","progress","readystatechange","timeout"];a.forEach((s=>t[s]&&e.on(r,s,(e=>t[s](e,r))))),r.upload&&t.upload&&a.forEach((s=>t.upload[s]&&e.on(r.upload,s,(e=>t.upload[s](e,r)))));let i,o,l=t.type||"";t.get={},o=s.get(t.url,t.get),t.json?(i=JSON.stringify(t.json),t.headers=Object.assign({accept:"application/json, text/plain, */*"},t.headers)):t.post&&(i=s.post(t.post)),t.overType&&r.overrideMimeType(t.overType),"head"!=l&&(r.responseType=l),r.open(i?"POST":"GET",o),t.headers&&s.toArr(t.headers,(t=>r.setRequestHeader(t[0],t[1]))),r.send(i)}))}runaction(t,e){let s=this;if(s.action)return s.action[t]instanceof Function?void 0===e||null==e?s.action[t].call(s):"string"!=typeof e&&e.length?s.action[t].apply(s,e||[]):s.action[t].call(s,e):void 0}callaction(t){let e=this;if(!e.action||!t)return;let s=Array.from(arguments),n=e.action[s.shift()];return n&&n instanceof Function?n.apply(e,s):void 0}bindaction(t){let e=this;if(e.action&&t&&e.action[t])return e.action[t].bind(e)}addJS(t,e,s,n){let r=this,a=r.F;if(r.I.blob(t)&&(n=a.getKeyName(t.name),"text/css"==t.type&&(s=!0)),n&&r.$("#link_"+n))return;let i=!1,o=r.$ce(s?"link":"script"),l=e=>{/^(blob:)?https?:\/\//.test(t)||/(\.js$|\.css$)/.test(t)||(i=!0,t=a.URL(t,a.gettype(s?"css":"js"))),s?(o.type=a.gettype("css"),o.href=t,o.rel="stylesheet"):(o.type=a.gettype("js"),o.src=t),n&&o.setAttribute("id","link_"+n),o.onload=n=>{e&&e(n),i&&a.removeURL(t),t=null,s||o.remove()},document[s?"head":"body"].appendChild(o)};return e?(l(e),o):r.I.Async(((t,e)=>l(t)))}async loadScript(t,e,s,n){e=e||{};let r=this,a=r.F;e.url=a.getpath(t),s?e.type="text":(e.store||(e.store=r.LibStore),e.key||(e.key=a.LibKey)),e.version=e.version||r.version;let i=await r.FetchItem(e);return s?i:await r.addJS(i)}async getScript(t,e){return this.loadScript(t,e,!0)}async addScript(t,e){return await T.addJS(await T.getScript(t,e))}async loadLibjs(t,e){let s=this.F;return await this.addJS(await s.getLibjs(t,e),null,"css"==s.getExt(t))}unFile(t,e,s){return this.F.unFile(t,this.I.assign({process:e},s||{}))}async toZip(t,e,s){let n=this;n.F;return n.I.Async((async r=>{let a=new Worker(n.JSpath+"zip.js?"+n.time);n.on(a,"message",(t=>{let s=t.data;1==s.t?(r(s.contents),t.target.terminate()):2==s.t&&e&&e(Math.ceil(100*s.current/s.total)+"%")})),n.on(a,"error",(t=>{r(null),a.terminate()})),a.postMessage(Object({contents:t},s||{})),t=null}))}I=new class{O=[Array,Object,HTMLFormElement,DOMStringMap,FormData,NamedNodeMap,Function,Blob,File,Promise,URLSearchParams,Uint8Array,HTMLFormElement,Element,CSSStyleDeclaration,String,void 0,null,Reflect,ArrayBuffer,Boolean,Headers];N(t){return this.O[t].name}assign(){return this.O[1].assign.apply(null,arguments)}exends(t,e,s){return s?this.toArr(s,(s=>t[s]=e[s])):t=this.assign(t,e),t}Async(t,e){return this.array(t)?this.O[9].all(t):new this.O[9](t,e)}formdata=t=>new this.O[4](t||void 0);formget(t){return new this.O[10](t)}get mobile(){return"ontouchend"in document}post(t){let e=this,s=e.T,n=e.postobj(t)?t:e.formdata(e.formelm(t)?t:e.str(t)?s.$(t):void 0);return e.objArr(t)&&e.toArr(t,(t=>n.append(t[0],t[1]))),n}get(t,e){let s=this,n="",r="",a=t.split("?");a[1]&&(n=s.formget(a[1])),e&&(r=s.formget(e));let i=s.formget(n+"&"+r).toString().replace(/^(.+?)=&/,"$1&");return a[0]+(i?"?"+i:"")}toObj(t){let e=this,s=e.O;return e.objArr(t)?t:s[1].fromEntries(e.toArr(t))}toArr(t,e){if(!t)return[];let s,n=this,r=n.O;return n.DOMmap(t)&&(t=r[1].assign({},t)),(n.postobj(t)||n.header(t))&&(s={},t.forEach(((t,e)=>{s[e]?(n.array(s[e])||(s[e]=[s[e]]),s[e].push(t)):s[e]=t})),t=r[1].entries(s)),n.nodemap(t)&&(t=r[0].from(t).map((t=>[t.nodeName,t.nodeValue]))),s=n.array(t)?t:t.length?r[0].from(t):r[1].entries(t),n.func(e)?s.forEach(e):s}define(t,e,s,n,r){let a=!!r;return this.O[1].defineProperty(t,e,n?{get:()=>s,configurable:a}:s),t}defines(t,e,s,n){return s?this.toArr(e,(e=>this.define(t,e[0],e[1],1,n))):this.O[1].defineProperties(t,e),t}textdecode(t,e){return new TextDecoder(e||"utf8").decode(t)}Json(t){let e=this,s=e.O;return e.u8obj(t)&&(t=e.textdecode(t)),"string"==typeof t?new s[6]("return "+t)():t}toJson(t){return JSON.stringify(this.Json(t))}empty(t){return!t||!this.toArr(t).length}constructor(t){let e=this,s=e.O,n="var O = I.O;";e.define(e,"T",{get:()=>t}),s[1].entries({array:0,obj:1,objArr:1,DOMmap:3,postobj:4,nodemap:5,blob:7,file:8,await:9,getobj:10,elm:13,func:6,u8obj:11,formelm:12,styleobj:14,str:15,undefined:17,arrBuff:19,bool:20,header:21}).forEach((t=>{n+=`I.define(I,'${t[0]}',{value(obj){`+(17==t[1]?`return obj ==  O[${t[1]}];`:["objArr","str"].includes(t[0])?`return obj!=O[16]&&obj!=O[17]&&obj.constructor.name == I.N(${t[1]});`:`return obj instanceof O[${t[1]}];`)+"}});"})),new s[6]("I",n)(e)}}(this);F=new class{Libjs={};LibKey="script-";async StreamResponse(t,e,s){let n=t=>Number(t),r=n(s["content-length"]||0),a=e.downtext?e.downtext:"",i=0,o={done:!1,value:!1},l=t.body.getReader();return new Response(new ReadableStream({async start(t){for(;!o.done;){let s=0,c="";o.value&&(s=n(o.value.length),i+=s,t.enqueue(o.value)),c=r&&i<r?a+Math.floor(i/r*100)+"%":a+Math.floor(10*i/1024)/10+"KB",e.process((e.filename?e.filename+" ":"")+c,r,i,s),o=await l.read()}t.close()}}))}FetchHeader(t,e){let s=this.I,n=s.toObj(t.headers)||{};return(n["content-type"]||this.gettype(e.url.split("/").pop()||"html")).split(";").forEach(((t,e)=>{if(t=t.trim().toLowerCase(),0==e)n["content-type"]=t;else if(-1!=t.search(/=/)){let e=t.split("=");n[e[0].trim()]=e[1].trim()}})),s.assign(n,{byteLength:Number(n["content-length"])||0,password:n.password||n["content-password"],type:n.type||n["content-type"].split("/")[1].split("+")[0]})}async FetchStart(t){let e=this.I,{url:s,get:n,post:r}=t||{},a={};if(s=e.get(t.url,n),a.headers={},["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"].forEach((e=>{null!=t[e]&&(a[e]=t[e])})),t.json)a.body=JSON.stringify(t.json),delete t.json,a.headers.Accept="application/json",a.method="POST";else if(r){a.method="POST";let s=(a.headers.accept||a.headers.Accept||"").toLowerCase();/(\+|\/)json/.test(s)?a.body=e.toJson(r):t.accept?(a.headers.Accept=t.accept,a.body=r):a.body=e.post(r)}return fetch(s,a)}THEN=t=>this.I.Async(t);zipJs="zip.min.js";async ZipCreate(t,e){let s=this.T;return window.zip||await s.loadScript(this.zipJs,{process:e}),new zip.ZipWriter(new zip.Uint8ArrayWriter,{password:t})}async ZipAddFile(t,e,s,n,r){let a=this.I;return s||(s=await this.ZipCreate(e)),a.file(t)?await s.add(t.name,new zip.BlobReader(t),n):await a.Async(a.toArr(t).map((async t=>await s.add(t.name,new zip.BlobReader(t),n)))),await s.close(r)}mime_preg={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};CheckExt(t){let e=this.I,s=t.slice(0,16),n=this.bindaction("textext"),r=e.blob(s)?s.arrayBuffer():e.str(s)?(new TextEncoder).encode(s):s;return e.await(r)?e.Async((async t=>t(n(await r)))):n(r)}action={textext(t){let e=this.I,s=e.toArr(e.arrBuff(t)?new e.O[11](t):t).map((t=>t.toString(16).padStart(2,0).toLocaleUpperCase())).join(""),n=e.toArr(this.mime_preg).filter((t=>t[1].test(s)));return n[0]?n[0][0]:""},async rar(t,e,s){let n,r=this,a=r.I;a.blob(t)&&!e.filename&&t.name&&(e.filename=t.name),s=s||"libunrar.min.zip",r.Libjs[s]||await r.getLibjs(s,n);let i,o=r.Libjs[s];return e.process&&(i=e.filename?r.T.getLang("Decompress:"):r.T.getLang("Decompress:")+i+"=&gt;",n=t=>e.process(i+(t.file?r.getname(t.file):e.filename||"")+" "+Math.floor(Number(t.current)/Number(t.total)*100)+"%",t.total,t.current)),a.Async((s=>{let i,l=new Worker(o),c=t=>a.u8obj(t)?s(t):t.arrayBuffer().then((t=>s(new a.O[11](t))));l.onmessage=a=>{let o=a.data,d=o.t;if(1===d)i?s(i):c(t),a.target.terminate();else if(2===d)i||(i={}),i[o.file]=o.data;else if(4===d&&o.total>0&&o.total>=o.current)n&&n(o);else if(-1==d){let t=prompt(r.T.getLang(o.message),e.password||"");if(!t)return s(i),a.target.terminate();e.unpack&&(i.password=t),e.password=t,l.postMessage({password:t})}},l.onerror=async e=>{c(t),l.terminate()},l.postMessage({contents:t,password:e.password})}))},"7z":function(t,e){return this.callaction("rar",t,e,"extract7z.zip")},async zip(t,e={}){return this.callaction("rar",t,e,this.T.Libzip)}};async unFile(t,e={}){let s=this,n=s.I;n.await(t)&&(t=await t),n.array(t)&&(t=new n.O[11](t));let r=await s.CheckExt(t);return!s.action[r]||e.PassExt&&e.PassExt.includes(zip)?(n.blob(t)&&(t=new n.O[11](await t.arrayBuffer())),t):await s.callaction(r,t,e)}async getLibjs(t,e){let s=this,n=s.T,r=s.I,a=s.getname(t),i=a.replace(/\.zip$/,".js");if(s.Libjs[a])return s.Libjs[a];if(s.Libjs[i])return s.Libjs[i];let o=await n.getStore(n.LibStore).data(s.LibKey+i,n.version);return o||(/\.zip$/.test(a)&&await s.getLibjs(n.Libzip,e),o=await n.FetchItem({url:s.getpath(t)+"?"+n.time,store:n.LibStore,key:s.LibKey,unpack:!0,filename:i,version:n.version,process:e})),o&&(r.objArr(o)?s.I.toArr(o,(t=>s.Libjs[t[0]]=t[1]&&s.URL(t[1]))):s.Libjs[a]=s.URL(o)),o=null,s.Libjs[a]}getname(t){return(t||"").split("/").pop().split("?")[0].split("#")[0]}getpath(t){let e=this.T;e.I;return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:)/.test(t)?t:e.JSpath+t}getFileText(t,e,s,n){let r=this,a=r.T.I;if(n&&!e||!/(text|javascript)/.test(s))return new File([t],n,{type:s});if(!e)return t;if("datalist"==s)a.toArr(t,(s=>{/(text|javascript)/.test(r.gettype(s[0]))&&(t[s[0]]=e(s[1]))}));else if(a.u8obj(t))return e(t);return t}getExt(t){return this.getname(t).split(".").pop().toLowerCase()}getKeyName(t){let e=this.getname(t).split(".");return e.pop(),e.join(".")}gettype(t){let e=this;return(t=e.getExt(t))&&!e.mime_list&&(e.mime_list={},e.I.toArr(e.mime_map,(t=>t[1].forEach((s=>e.mime_list[s]=t[0]+(t[0].includes("/")?"":"/"+s)))))),e.mime_list[t]||"application/octet-stream"}mime_map={"text/javascript":["js"],"text/css":["css","style"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml","svg"],image:["jpg","jpeg","png","gif","webp"],application:["pdf"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};checkBuffer(t,e){let s=this.I.toArr(t.slice(0,8)).map((t=>t.toString(16).padStart(2,0).toLocaleUpperCase())).join("");if(s){let t=this.I.toArr(this.mime_preg).filter((t=>t[1].test(s)))[0];if(t)return t[0]}return e||!1}URL(t,e){let s=this,n=s.I;if(n.u8obj(t))e||(e=s.gettype(s.CheckExt(t)));else if(n.str(t)){if(/^(blob|http)/.test(t)||/^\/?[\w\-_\u4e00-\u9FA5:\/\.\?\^\+ =%&@#~]+$/.test(t))return t;e||(e=s.gettype("js"))}return window.URL.createObjectURL(n.blob(t)?t:new Blob([t],{type:e}))}removeURL(t){return window.URL.revokeObjectURL(t)}download(t,e,s){let n;this.I.blob(t)?(n=this.URL(t),t=t.name||"unknowfile"):n=this.URL(e,s);let r=document.createElement("a");r.href=n,r.download=t,r.click(),r.remove()}StoreList={};get idb(){return window.indexedDB||window.webkitindexedDB}dbSetMap(t){let e=this,s=e.I,n=e.T,r=e.dbMap||{};r&&!r[e.dbname]&&(r[e.dbname]=n.DB_STORE_MAP);let a=t.store;if(a){let n=t.dbName||e.dbname;if(n&&!r[n]&&(r[n]={}),a&&!r[n][a]){r[n][a]={};let e=t.dbIndex;e&&(s.str(e)?r[n][a][e]=!1:s.assign(r[n][a],e))}}return e.dbMap||(e.dbMap=r),r}async dbLoad(t){let e=this,s=(t=t||{}).dbName||e.dbname,n=t.store,r=e.StoreList[s];return n&&e.dbCheckTable(n,r)||!n&&r?r:(t.dbName=s,await e.dbInstall(e.dbSetMap(t)),e.StoreList[s])}async dbInstall(t){let e=this,s=e.I;return await s.Async(s.toArr(t).map((async t=>{let n,[r,a]=t,i=e.StoreList[r];if(i){if(!s.toArr(a).filter((t=>!e.dbCheckTable(t[0],i))).length)return"ok";n=i.version+1,i.close(),delete e.StoreList[r]}let o=Object.keys(a);return e.StoreList[r]=await e.dbOpen(r,a,n,{success:async(t,s)=>e.dbCheckTable(o,t)!=o.length?(n=e.dbClose(t),s(await e.dbOpen(r,a,n))):s(t)}),r})))}async dbOpen(t,e,s,n){let r=this;return r.I.Async(((a,i)=>{let o=r.idb.open(t,s);o.addEventListener("error",(async t=>{i(t)})),o.addEventListener("upgradeneeded",(async t=>{let s=o.result;n&&n.upgradeneeded?await n.upgradeneeded.apply(o,[s]):e&&await r.dbCreateObject(e,s)})),o.addEventListener("success",(async t=>{let e=o.result;if(n&&n.success)return await n.success(e,a);a(e)}))}))}async dbCreateObject(t,e){if(!t||!e)return;let s=this,n=s.I;await n.Async(n.toArr(t).map((async t=>{let[r,a]=t;if(!s.dbCheckTable(r,e)){let t=await e.createObjectStore(r);a&&n.toArr(a,(e=>t.createIndex(e[0],e[1]&&e[1].key||e[0],e[1]&&e[1].options||e[1]||{unique:!1})))}})))}dbCheckTable(t,e,s){return e?(this.I.str(t)&&(t=[t]),t=t?t.filter((t=>e.objectStoreNames.contains(t))):[],s?t:t.length):0}async contentsSize(t,e){let s=this.I;s.await(t)&&(t=await t);let n=t.contents||t,r={};return s.str(n)&&n.length>e?(n=(new TextEncoder).encode(n),s.assign(r,{contents:n,filesize:n.byteLength,type:"String"})):s.blob(n)&&n.size>e?s.assign(r,{contents:new s.O[11](await n.arrayBuffer()),filetype:n.type,filesize:n.size,filename:n.name,type:"File"}):n.byteLength&&n.byteLength>e&&(n.__proto__.constructor!=s.O[11]&&(n=new s.O[11](n.buffer||n)),s.assign(r,{contents:n,filesize:n.byteLength,type:s.N(11)})),r.contents&&(t.type||r.type||(r.type=s.N(11)),t.contents?(delete t.contents,s.assign(t,r)):t=r),t.contents&&["version","password"].forEach((e=>!t[e]&&delete t[e])),t}async dbSelect(t,e){let s=this;s.T;s.I.str(t)&&(t={store:t}),t.store instanceof s.StoreDatabase&&(t.store=t.store.table);let n=t.store,r=await s.dbLoad(t);e=e?"readonly":"readwrite",n||(n=r.objectStoreNames[0]);let a=r.transaction([n],e);return a.onerror=t=>{throw t.preventDefault(),a.error},a.objectStore(n)}async dbGetItem(t){let e=this.I;e.str(t)&&(t={name:t});let s=t.name,n=await this.dbSelect(t,!0);if(s)return e.Async((t=>{n.get(s).onsuccess=e=>t(e.target.result)}))}async dbPutItem(t){let e=this.I,{data:s,name:n}=t||{},r=await this.dbSelect(t);return e.Async((t=>{r.put(s,n).onsuccess=e=>t(e.target.result)}))}async dbRemoveItem(t){let e=this.I;e.str(t)&&(t={name:t});let s=t.name,n=await this.dbSelect(t);if(s)return e.Async(((t,e)=>{n.delete(s).onsuccess=e=>t(`delete:${s}`)}))}async dbGetAll(t){let e=this,s=e.I,n=e.T,r=await e.dbSelect(t,!0);return s.Async((a=>{let i={};t.index&&(r=r.index(t.index)),r.openCursor(t.Range).onsuccess=r=>{let o=r.target.result;if(o){if(t.only&&n.part&&n.maxsize&&s.u8obj(o.value.contents)&&o.value.filesize>n.maxsize){let t=o.primaryKey.split(n.part),r=t[0],a=t[1]||0;if(i[r])i[r].contents.set(o.value.contents,a*n.maxsize);else{let t=new s.O[11](o.value.filesize);t.set(o.value.contents,a*n.maxsize),delete o.value.contents,i[r]=e.assign(o.value,{contents:t})}}else i[o.primaryKey]=o.value;o.continue()}else a(i)}}))}async dbGetKeys(t){let e=this,s=e.I;s.str(t)&&(t={dbName:t});let n=await e.dbSelect(t,!0);return s.Async((r=>t.index&&n.indexNames.contains(t.index)?n.index(t.index).getAllKeys(t.Range).onsuccess=n=>{r(t.only?s.toArr(n.target.result).filter((t=>!t.includes(e.T.part))):n.target.result)}:n.getAllKeys().onsuccess=n=>{r(t.only?s.toArr(n.target.result).filter((t=>!t.includes(e.T.part))):n.target.result)}))}async dbGetCursor(t){let e=this,s=e.I;s.str(t)&&(t={index:t});let n=t.index,r=e.T,a=await e.dbSelect(t,!0),i=a.indexNames.length;if(i&&!n)n=a.indexNames[0];else if(!i)return e.dbGetKeys(t);return s.Async((e=>{let s={};a.index(n).openKeyCursor(t.Range).onsuccess=a=>{let i=a.target.result;i?((!t.only||r.part&&!i.primaryKey.includes(r.part))&&(s[i.primaryKey]=Object.fromEntries([[n,i.key]])),i.continue()):e(s)}}))}async dbRemoveTable(t,e){let s=this,n=s.I;return n.str(t)&&(t=[t]),await n.Async(t.map((async t=>{(await s.dbSelect({store:t,dbName:e})).clear()})))}dbClose(t){let e=this,s=e.I.str(t),n=s?e.StoreList[t]:t;if(n){let r=n.version+1;return n.close(),s&&delete e.StoreList[t],r}}async deleteDatabase(t,e){let s=this;if(e=e||s.dbname,!t)return s.idb.deleteDatabase(e||s.dbname);let n=s.StoreList[e]||await s.dbOpen(e);if(n&&!s.dbCheckTable(t,n))return"ok";let r=s.dbClose(n);return delete s.StoreList[e],await s.dbOpen(e,null,r,{upgradeneeded(e){e.deleteObjectStore(t)},success(t,e){s.close(t),e("ok")}})}StoreDatabase=class{constructor(t,e,s){s=s||t.DB_NAME;let n=t.I,r=`var I = T.I;I.defines(S, { T,I,table:'${e}',dbName:'${s}' }, 1,1);`;n.toArr(["getItem","setItem","removeItem","getAllData","getContent","setContent","getAllKeys","getAllCursor","clearDB","deleteDB"],(t=>{r+=`I.define(S, '${t}', {value:function(){let arr = ['${e}'].concat(I.toArr(arguments));return T.${t}.apply(T, arr);}});`})),new Function("S","T",r)(this,t)}setName(t){let e=this.I;return t&&"boolean"!=typeof t?e.str(t)&&(t={dbName:t}):t={dbName:this.dbName},t}get(t,e,s){return s=this.setName(s),this.getItem(t,e,s)}put(t,e){return this.setItem(t,e,this.dbName)}remove(t,e){return e=this.setName(e),this.removeItem(t,e)}data(t,e,s){return this.getData(t,e,s)}getData(t,e,s){return s=this.setName(s),this.getContent(t,e,s)}setData(t,e,s){return this.setContent(t,e,s,this.dbName)}keys(t){return this.getAllKeys(this.dbName,t||{})}cursor(t,e,s){return s=this.setName(s),this.getAllCursor(t,e,s)}all(t,e){return e=this.setName(e),this.getAllData(t,e)}clear(){return this.clearDB(this.dbName)}delete(){return this.deleteDB(this.dbName)}async getBatch(t,e){let s=await this.I.Async(t.map((async t=>await this.get(t))));return e?e(s):s}};get dbname(){return this.T.DB_NAME}constructor(t){let e=this,s=t.I;t.Libzip||(t.Libzip=e.zipJs),s.defines(e,{I:s,T:t},1),e.callaction=t.callaction,e.bindaction=t.bindaction}}(this);on(t,e,s,n,r){(t=this.$(t))&&t.addEventListener(e,s,!1===n?{passive:!1}:n,r)}un(t,e,s,n,r){this.$(t).removeEventListener(e,s,!1===n?{passive:!1}:n,r)}once(t,e,s,n){return this.on(t,e,s,{passive:!1,once:!0},n)}docload(t){let e=document;return this.I.Async((s=>{if("loading"==e.readyState)return this.once(e,"DOMContentLoaded",(()=>{t&&t.call(this),s(!0)}));t&&t.call(this),s(!0)}))}$(t,e){let s=this.I,n=e||document;return t?s.str(t)?n.querySelector(t):s.func(t)?this.docload(t):t:void 0}$$(t,e){return(e||document).querySelectorAll(t)}$ce(t){return document.createElement(t)}$ct(t,e){let s=this.$ce(t);return s.innerHTML=e,s}$ca(t,e){let s=this.I,n=this.$ce(t);return e&&s.toArr(e,(t=>{n.setAttribute(t[0],t[1])})),n}$append(t,e){return t.appendChild(e),e}$add(t,e){return t.classList.add(e),t}customElement(t){let e=this;window.customElements.define(t,class extends HTMLElement{constructor(){super(),e.callaction("TAG-"+this.tagName,this,"init")}connectedCallback(){e.callaction("TAG-"+this.tagName,this,"connect")}attributeChangedCallback(t,s,n){e.callaction("TAG-"+this.tagName,this,"attribute",{name:t,oldValue:s,newValue:n})}disconnectedCallback(){e.callaction("TAG-"+this.tagName,this,"disconnect")}})}attr(t,e){if(this.$(t))return this.$(t).getAttribute(e)}docElm(t,e){return(new DOMParser).parseFromString(t,e||"text/html")}HTMLToTxt(t){return this.I.str(t)&&(t=this.docElm(t)),t instanceof Document?t.body.textContent:""}fragment(){return new DocumentFragment}Err(t){return new Error(t)}triger(t,e,s){let n=this;return n.I.str(t)&&(t=n.$(t)),s?s.detail||(s.detail=t):s={},s.hasOwnProperty("cancelable")||(s.cancelable=!0),n.dispatch(t,new CustomEvent(e,s))}dispatch(t,e){return t?t.dispatchEvent(e):e}down(t,e,s){return this.F.download(t,e,s)}stopEvent=t=>{t.preventDefault()};stopProp=t=>{t.preventDefault(),t.stopPropagation()};stopGesture(t){let e=this;["gesturestart","gesturechange","gestureend"].forEach((s=>e.on(t,s,(t=>e.stopEvent(t)))))}async battery(t){const e=await navigator.getBattery();["chargingchange","levelchange","chargingtimechange","dischargingtimechange"].forEach((s=>t.val&&this.on(e,s,(s=>this.callaction(t.val,s,e)))))}getLang(t,e){let s=this.lang&&this.lang[t]||t;return this.lang[t],e&&s&&T.I.toArr(e,(t=>{s=s.replace(new RegExp("/{"+t[0]+"}/","g"),t[1])})),s}THEN(t){return this.I.Async(t)}Nttr=class{constructor(t,e){let s=(e=e||Nenge).I;if(s.defines(this,{T:e,I:s},1,1),s.str(t)&&(t=e.$(t)),s.elm(t)?(this.obj=t,t.Nttr?this.resetNttr(t.Nttr):this.obj=t):this.resetNttr(t),!this.obj)throw"Nttr error";s.defines(this.obj,{Nttr:this},1,!0)}resetNttr(t){let e=this,s=e.I;t instanceof this.constructor&&(e.eventList=s.assign({},t.eventList),e.obj=t.obj,O[18].deleteProperty(t.obj,"Nttr"))}eventList={};get cList(){return this.obj.classList}get active(){return this.contains("active")}set active(t){this.cList[t?"add":"remove"]("active")}get show(){return this.contains("show")}set show(t){this.cList[t?"add":"remove"]("show")}get hidden(){return this.obj.hidden}set hidden(t){return this.obj.hidden=t,this}get css(){return this.obj.style.cssText}set css(t){this.obj.style.cssText=t}get style(){return this.I.toObj(this.obj.style)}set style(t){if(this.I.str(t))return this.css=t;this.I.assign(this.obj.style,t)}html(t){return null!=t?(this.obj.innerHTML=t,this):this.obj.innerHTML}$(t){return this.obj.querySelector(t)}$$(t){return this.obj.querySelectorAll(t)}contains(t){return this.cList.contains(t)}get attrs(){return this.T.I.toObj(this.obj.attributes)}set attrs(t){this.T.I.toArr(t,(t=>this.setAttr(t[0],t[1])))}attr(t,e){return void 0===e?this.obj.getAttribute(t):null==e?this.obj.removeAttribute(t):(this.obj.setAttribute(t,e),this)}getAttrs(t){return t?this.attr(t):this.attrs}setAttrs(t,e){return e||"string"==typeof t?(this.attr(t,e),this):this.attrs=t}addClass(t){return this.cList.add(t),this}removeClass(t){return this.cList.remove(t),this}addChild(t){return this.obj.appendChild(t),this}appendTo(t){return(t=t||document.body).appendChild(this.obj),this}on(t,e,s){let n=this;return n.eventList[t]||(n.eventList[t]=[]),n.eventList[t].push({func:e,opt:s}),n.T.on(n.obj,t,e,s),n}un(t,e){let s=this;if(s.eventList[t]){let n=[];s.eventList[t].forEach((r=>{let{func:a,opt:i}=r;e&&e!=a?n.push(r):s.removeEvent(t,a,i)})),s.eventList[t]=[],n.length>0&&(s.eventList[t]=n)}else t||s.I.toArr(s.eventList,(t=>{t[1].forEach((e=>{let{func:n,opt:r}=e;s.removeEvent(t[0],n,r)})),delete s.eventList[t[0]]}));return s}once(t,e,s){return this.T.once(this.obj,t,e,s),N}removeEvent(t,e,s){return this.T.un(this.obj,t,e,s)}triger(t,e){let s=this,n=this.I.assign({},e||{},{target:s.obj});s.eventList[t]?s.eventList[t].forEach((t=>t.func.call(s.obj,n))):s.T.triger(s.obj,t,n)}dispatch(t){this.obj.dispatchEvent(t)}bind(t,e){let s=this,n=s.T,r=s.I;e||(e=s.I.mobile?"touchend":"click"),r.toArr(t,(t=>n.on(s.$(t[0],this.obj),e,t[1])))}click(t,e,s){let n=this;return e||(e=n.I.mobile?"touchend":"click"),n.I.func(t)?(n.un(e),n.on(e,t,s||!1)):n.triger(e,t),n}getBoundingClientRect(){return this.obj.getBoundingClientRect()}remove(){this.un(),this.obj.remove()}get children(){return this.I.toArr(this.obj.children)}get parentNode(){return this.obj.parentNode}get rect(){return this.getBoundingClientRect()}};nWindow=class extends this.Nttr{action={close(){this.hidden=!0},show(){this.hidden=!1},installWindow(){this.addClass("ajaxWindow"),this.html('<div class="container">\n                    <div class="a-header">\n                        <div class="title"><span class="loading">&#61712;</span></div>\n                        <div class="menu">\n                            <button type="button" class="close" data-naction="close">&#61453;</button>\n                        </div>\n                    </div>\n                    <div class="a-body">\n                        <p class="loading">&#61473;</p>\n                    </div>\n                    <div class="a-footer" hidden></div>\n                </div>')},installHeaderEvent(){let t,e=this,s=e.T;t=s.I.mobile?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup","mouseout"],t.forEach((t=>s.on(e.$(".a-header"),t,(t=>{if(("mousedown"==t.type||"touchstart"==t.type)&&t){let{clientX:s,clientY:n}="mousedown"==t.type?t:t.touches[0];e.HeaderPointPos={clientX:s,clientY:n}}if("mouseup"!=t.type&&"mouseout"!=t.type&&"touchend"!=t.type||(e.HeaderPointPos=!1),("mousemove"==t.type||"touchmove"==t.type)&&e.HeaderPointPos){let{clientX:s,clientY:n}="mousemove"==t.type?t:t.touches[0],r=e.$(".container"),a=r.getBoundingClientRect(),i="",o="",l=e.HeaderPointPos.clientX-s,c=e.HeaderPointPos.clientY-n;o=a.top-c,o="top:"+o+"px;bottom:unset;",l=l||0,i=a.left-l,(i<10||i&&a.width+i+15>window.innerWidth)&&(i=parseFloat(r.style.left),i<=10?i=10:i+10>window.innerWidth&&(i-=10)),i="left:"+i+"px;right:unset;width:"+a.width+"px;",e.$(".container").style.cssText=i+o,e.HeaderPointPos={clientX:s,clientY:n}}}))),{passive:!1})},installEvent(){let t=this,e=t.T,s=t.obj;e.on(s,"pointerup",(n=>{let r=n.target;if(r==s)return t.callaction("close",r,n);let a=r&&e.attr(r,"data-naction");return a?(e.stopEvent(n),t.callaction(a,r,n)):void 0}))},initConfig(t){let e=this,s=e.T;t&&s.I.toArr(t,(t=>{"function"==typeof e[t[0]]&&e[t[0]](t[1])}))}};constructor(t,e,s){if(super(t,e),!this.obj)return;const n=this;n.callaction=e.callaction,n.$(".container")||n.callaction("installWindow"),n.callaction("installEvent"),n.callaction("installHeaderEvent"),n.callaction("initConfig",s)}title(t){this.$(".a-header .title").innerHTML=t}body(t){this.$(".a-body").innerHTML=t}footer(t){this.$(".a-footer").innerHTML=t}hiddenFooter(){this.$(".a-footer").hidden=!0}hiddenPath(t,e){this.$(".a-"+t).hidden=e||!1}}},Nttr=t=>{let e=Nenge,s=e.$(t);return t instanceof e.Nttr?t:s?s.Nttr?s.Nttr:new e.Nttr(s,e):void 0},nWindow=(t,e)=>{let s,n=Nenge;return t?(s=n.$(t),!s||s.Nttr instanceof n.nWindow||new n.nWindow(s,n,e),s&&s.Nttr):new n.nWindow(n.$ce("div"),n,e).appendTo()};Nenge.triger(document,"NengeLoad",{detail:Nenge});